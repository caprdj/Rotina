<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Invent√°rio da Casa ‚Äî Fibro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#4b7bec" />

  <style>
    :root {
      --primary: #4b7bec;
      --pill-bg: #eef2ff;
--bg: #f5f5fa;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: var(--bg);
      color: #222;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1rem 1.2rem 0.5rem;
      background: #ffffff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      position: sticky;
      top: 0;
      z-index: 10;
      border-radius: 0 0 10px 10px;
    }

    header h1 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 700;
    }

    header .subtitle {
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.25rem;
    }

/* Header layout (t√≠tulo + bot√µes em ‚Äúpill‚Äù) */
header.top-header {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 0.75rem;
}
header.top-header .header-left {
  min-width: 0;
}
header.top-header .header-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.55rem;
  align-items: center;
  justify-content: center;
}

    /* Tabs (Invent√°rio / Lista de compras) ‚Äì estilo ‚Äúsegmented‚Äù */
.tabs {
  display: flex;
  flex-wrap: nowrap;
  gap: 0.6rem;
  margin-top: 0.75rem;
  padding: 0.6rem;
  background: #eef2ff;
  border-radius: 18px;
}

.tab-btn {
  flex: 1;
  min-width: 0;
  padding: 0.55rem 0.7rem;
  border-radius: 999px;
  border: 1px solid transparent;
  background: transparent;
  font-size: 0.9rem;
  font-weight: 600;
  text-align: center;
  cursor: pointer;
  color: #4b4b4b;
  white-space: nowrap; /* mant√©m ‚ÄúLista de compras‚Äù em uma linha */
}

.tab-btn.active {
  background: #ffffff;
  color: var(--primary);
  border-color: #dfe6ff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
}

@media (max-width: 360px) {
  .tab-btn { font-size: 0.82rem; padding: 0.5rem 0.6rem; }
}
    main {
      flex: 1;
      padding: 0.8rem 1.2rem 1.2rem;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    /* Chips (ambientes / modos) ‚Äì estilo igual ao do Card√°pio */
.chip-row {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin: 0.75rem 0 0.2rem;
  padding: 0.55rem;
  background: #eef2ff;
  border-radius: 18px;
}

.chip {
  padding: 0.5rem 0.85rem;
  border-radius: 999px;
  border: 1px solid transparent;
  background: transparent;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  color: #4b4b4b;
  white-space: nowrap;
}

.chip.active {
  background: #ffffff;
  color: var(--primary);
  border-color: #dfe6ff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
}

@media (max-width: 360px) {
  .chip { font-size: 0.82rem; padding: 0.45rem 0.75rem; }
}
    .summary-bar {
      font-size: 0.75rem;
      color: #555;
      margin-bottom: 0.75rem;
      background: #ffffff;
      border-radius: 0.5rem;
      padding: 0.4rem 0.6rem;
      border: 1px solid #eee;
    }

    .summary-food-legend {
      font-size: 0.72rem;
      color: #777;
    }

    .group-title {
      margin-top: 0.8rem;
      margin-bottom: 0.4rem;
      font-size: 0.85rem;
      font-weight: 600;
      color: #444;
    }

    .item-card {
      background: #ffffff;
      border-radius: 0.6rem;
      padding: 0.6rem 0.7rem;
      margin-bottom: 0.5rem;
      border: 1px solid #eee;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
    }

    .item-name-wrapper {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      flex: 1;
    }

    .item-name {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .item-header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.25rem;
    }

    .qty-row {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.8rem;
    }

    .qty-btn {
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #f5f5f5;
      font-size: 0.9rem;
      line-height: 1;
      padding: 0;
      cursor: pointer;
    }

    .qty-label {
      font-size: 0.8rem;
      color: #555;
      min-width: 4.5rem;
      text-align: center;
    }

    .item-actions {
      display: flex;
      gap: 0.25rem;
      justify-content: flex-end;
    }

    .icon-btn {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0.1rem 0.2rem;
    }

    .status-row {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      flex-wrap: wrap;
      font-size: 0.75rem;
    }

    .status-sep {
      font-size: 0.75rem;
      color: #aaa;
    }

    .status-pill {
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #f7f7f7;
      cursor: pointer;
    }

    .status-pill.ok {
      border-color: #20bf6b;
    }

    .status-pill.low {
      border-color: #f7b731;
    }

    .status-pill.out {
      border-color: #eb3b5a;
    }

    .status-pill.active {
      background: #e7f0ff;
      font-weight: 600;
    }

    .shopping-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      background: #ffffff;
      border-radius: 0.5rem;
      padding: 0.5rem 0.6rem;
      margin-bottom: 0.4rem;
      border: 1px solid #eee;
    }

    .shopping-item label {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .shopping-item .hint {
      font-size: 0.75rem;
      color: #777;
    }

    .btn-add {
      width: 100%;
      margin-top: 0.7rem;
      padding: 0.6rem;
      border-radius: 0.6rem;
      border: 1px dashed #aaa;
      background: #f7f7fc;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      background: #ffffff;
      border-radius: 0.75rem;
      padding: 1rem;
      width: 90%;
      max-width: 360px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .modal h2 {
      margin: 0 0 0.6rem;
      font-size: 1rem;
    }

    .modal-field {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      margin-bottom: 0.6rem;
      font-size: 0.8rem;
    }

    .modal-field span {
      color: #555;
    }

    .modal input,
    .modal select {
      padding: 0.4rem 0.5rem;
      border-radius: 0.4rem;
      border: 1px solid #ddd;
      font-size: 0.85rem;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .modal-actions button {
      padding: 0.4rem 0.7rem;
      border-radius: 0.4rem;
      border: 1px solid #ccc;
      background: #f5f5f5;
      font-size: 0.8rem;
      cursor: pointer;
    }

    #addItemSave {
      background: #4b7bec;
      color: #fff;
      border-color: #4b7bec;
    }

.btn-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.45rem;
  padding: 0.55rem 1.05rem;
  border-radius: 999px;
  border: 2px solid var(--primary);
  background: #ffffff;
  color: var(--primary);
  font-size: 0.95rem;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 2px 10px rgba(0,0,0,0.06);
  width: fit-content;
}

.btn-pill .icon {
  font-size: 1rem;
  line-height: 1;
}

.btn-pill:active {
  background: var(--pill-bg);
}
  </style>
</head>
<body>
  <div class="app">
    <header class="top-header">
  <div class="header-left">
    <h1>Lista Dom√©stica</h1>
    <div class="subtitle">
    </div>
  </div>

  <div class="header-actions">
    <button type="button" class="btn-pill" id="btnHome" title="Ir para a tela inicial">
      <span class="icon">üè†</span></button>
<button type="button" class="btn-pill" id="btnBackup" title="Baixar backup (JSON)">
      <span class="icon">üì§</span> Backup
    </button>
    <button type="button" class="btn-pill" id="btnRestore" title="Restaurar backup (JSON)">
      <span class="icon">üì•</span> Restaurar
    </button>
      

    <input type="file" id="restoreFile" accept="application/json" style="display:none" />
  </div>

  <div class="tabs" id="mainTabs">
    <button class="tab-btn active" data-tab="inventario">üì¶ Invent√°rio</button>
    <button class="tab-btn" data-tab="compras">üóíÔ∏è Lista de compras</button>
  </div>

<div class="chip-row" id="envRow">
          <button class="chip" data-env="hortifruti">ü•ó Hortifruti</button>
          <button class="chip" data-env="laticinios">üßÄ Latic√≠nios & ovos</button>
          <button class="chip" data-env="freezer">‚ùÑÔ∏è Freezer</button>
          <button class="chip active" data-env="despensa">üì¶ Despensa</button>
          <button class="chip" data-env="cozinha">üçΩÔ∏è Cozinha</button>
          <button class="chip" data-env="banheiro">üöΩ Banheiro</button>
          <button class="chip" data-env="area">üß∫ √Årea de servi√ßo</button>
          <button class="chip" data-env="farmacia">üíä Farm√°cia</button>
        </div>

<div class="chip-row" id="shoppingModeRow" style="display:none">
          <button class="chip active" data-shop="geral">üìù Lista geral</button>
          <button class="chip" data-shop="dia">üõí Compra do dia</button>
        </div>

</header>

    <main>
      <!-- TAB INVENT√ÅRIO -->
      <section id="tab-inventario" class="tab-panel active">
        

        <!-- Resumo do ambiente -->
        <div class="summary-bar">
          Itens: 0 ‚Ä¢ üü¢ OK: 0 ‚Ä¢ üü° Acabando: 0 ‚Ä¢ üî¥ Acabou: 0
        </div>

        <!-- Lista din√¢mica de itens -->
        <div id="inventoryList"></div>

        <button class="btn-add">+ Adicionar item neste ambiente</button>
      </section>

      <!-- TAB LISTA DE COMPRAS -->
      <section id="tab-compras" class="tab-panel">
        
        <div id="shoppingList"></div>
      </section>
    </main>
  </div>

  <!-- MODAL ADICIONAR / EDITAR ITEM -->
  <div class="modal-backdrop" id="addItemModal">
    <div class="modal">
      <h2 id="addItemTitle">Novo item</h2>
      <label class="modal-field">
        <span>Nome do item*</span>
        <input type="text" id="addItemName" />
      </label>
      <label class="modal-field">
        <span>Grupo (subcategoria, opcional)</span>
        <input type="text" id="addItemGroup" placeholder="Ex.: Frutas, Legumes, Prote√≠nas congeladas..." />
      </label>
      <label class="modal-field">
        <span>Quantidade</span>
        <input type="number" id="addItemQty" min="0" step="1" value="0" />
      </label>
      <label class="modal-field">
        <span>Unidade</span>
        <select id="addItemUnit">
          <option value="UN">UN</option>
          <option value="L">L</option>
          <option value="g">g</option>
          <option value="Kg">Kg</option>
        </select>
      </label>
      <div class="modal-actions">
        <button type="button" id="addItemCancel">Cancelar</button>
        <button type="button" id="addItemSave">Salvar</button>
      </div>
    </div>
  </div>

  

<script>
(() => {
  const LS_KEY = "inventario_mae_v3";

  const $ = (id) => document.getElementById(id);

  const tabButtons = Array.from(document.querySelectorAll(".tab-btn"));
  const panelInv = $("tab-inventario");
  const panelBuy = $("tab-compras");

  const envRow = $("envRow");
  const envButtons = Array.from(envRow.querySelectorAll("button[data-env]"));

  const inventoryList = $("inventoryList");
  const shoppingList = $("shoppingList");
  const shoppingModeRow = $("shoppingModeRow");

  const btnBackup = $("btnBackup");
  const btnRestore = $("btnRestore");
  const restoreFile = $("restoreFile");

  const modalBackdrop = $("addItemModal");
  const addItemTitle = $("addItemTitle");
  const addItemName = $("addItemName");
  const addItemGroup = $("addItemGroup");
  const addItemQty = $("addItemQty");
  const addItemUnit = $("addItemUnit");
  const addItemSave = $("addItemSave");
  const addItemCancel = $("addItemCancel");

  const DEFAULT_ENVS = ["hortifruti","laticinios","freezer","despensa","cozinha","banheiro","area","farmacia"];
  const STATUS_NEXT = { ok: "low", low: "out", out: "ok" };
  const STATUS_CLASS = { ok: "ok", low: "low", out: "out" };
  const STATUS_TEXT = { ok: "üü¢ OK", low: "üü° Acabando", out: "üî¥ Acabou" };

  const uid = () => Math.random().toString(16).slice(2) + Date.now().toString(16);
  const esc = (s) => String(s ?? "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

  const state = loadState() ?? {
    activeTab: "inventario",
    activeEnv: "despensa",
    shoppingMode: "geral", // geral | por-ambiente
    data: Object.fromEntries(DEFAULT_ENVS.map(e => [e, []]))
  };

  DEFAULT_ENVS.forEach(e => { if (!state.data[e]) state.data[e] = []; });

  let editing = { env:null, id:null };

  function saveState(){ try{ localStorage.setItem(LS_KEY, JSON.stringify(state)); }catch(e){} }
  function loadState(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return null;
      const parsed = JSON.parse(raw);
      if(!parsed || typeof parsed !== "object") return null;
      return parsed;
    }catch(e){ return null; }
  }

  function envLabel(env){
    const b = envButtons.find(x => x.dataset.env === env);
    return b ? b.textContent.trim() : env;
  }

  // ---------- Tabs ----------
  function setActiveTab(tab){
    state.activeTab = (tab === "compras") ? "compras" : "inventario";
    tabButtons.forEach(b => b.classList.toggle("active", b.dataset.tab === state.activeTab));
    panelInv.classList.toggle("active", state.activeTab === "inventario");
    panelBuy.classList.toggle("active", state.activeTab === "compras");
    saveState();
    renderInventory();
    renderShopping();
  }

  tabButtons.forEach(b => b.addEventListener("click", () => setActiveTab(b.dataset.tab)));

  // ---------- Envs ----------
  function setActiveEnv(env){
    if(!DEFAULT_ENVS.includes(env)) env = "despensa";
    state.activeEnv = env;
    envButtons.forEach(b => b.classList.toggle("active", b.dataset.env === env));
    saveState();
    renderInventory();
  }
  envButtons.forEach(b => b.addEventListener("click", () => setActiveEnv(b.dataset.env)));

  // ---------- Modal ----------
  function openModalNew(){
    editing = { env:null, id:null };
    addItemTitle.textContent = "‚ûï Novo item";
    addItemName.value = "";
    addItemGroup.value = "";
    addItemQty.value = "1";
    addItemUnit.value = "UN";
    modalBackdrop.classList.add("active");
    addItemName.focus();
  }
  function openModalEdit(env, item){
    editing = { env, id:item.id };
    addItemTitle.textContent = "‚úèÔ∏è Editar item";
    addItemName.value = item.name || "";
    addItemGroup.value = item.group || "";
    addItemQty.value = String(item.qty ?? 1);
    addItemUnit.value = item.unit || "UN";
    modalBackdrop.classList.add("active");
    addItemName.focus();
  }
  function closeModal(){ modalBackdrop.classList.remove("active"); }

  // Hook any existing "+ Adicionar" button if present
  const btnAdd = document.querySelector(".btn-add, [data-action='add']");
  if(btnAdd) btnAdd.addEventListener("click", openModalNew);

  addItemCancel?.addEventListener("click", closeModal);
  modalBackdrop?.addEventListener("click", (e) => { if(e.target === modalBackdrop) closeModal(); });

  addItemSave?.addEventListener("click", () => {
    const name = (addItemName.value || "").trim();
    if(!name){ alert("Informe o nome do item üôÇ"); addItemName.focus(); return; }
    const group = (addItemGroup.value || "").trim();
    let qty = parseInt(addItemQty.value, 10);
    if(isNaN(qty) || qty < 0) qty = 0;
    const unit = (addItemUnit.value || "UN").trim() || "UN";

    if(editing.env && editing.id){
      const arr = state.data[editing.env] || [];
      const it = arr.find(x => x.id === editing.id);
      if(it){
        it.name = name;
        it.group = group;
        it.qty = qty;
        it.unit = unit;
      }
    }else{
      state.data[state.activeEnv].push({
        id: uid(),
        name,
        group,
        qty,
        unit,
        status: "ok",
        createdAt: Date.now()
      });
    }

    saveState();
    closeModal();
    renderInventory();
    renderShopping();
  });

  // ---------- Inventory ----------
  function statusText(s){ return STATUS_TEXT[s] || STATUS_TEXT.ok; }
  function statusClass(s){ return STATUS_CLASS[s] || "ok"; }
  function needsBuy(it){ return it.status === "low" || it.status === "out"; }

  function renderInventory(){
    const env = state.activeEnv;
    const items = (state.data[env] || []).slice().sort((a,b)=> (a.name||"").localeCompare(b.name||""));

    inventoryList.innerHTML = "";
    if(!items.length){
      inventoryList.innerHTML = `<div class="hint">Sem itens em <b>${esc(envLabel(env))}</b> ainda üôÇ<br>Use o bot√£o <b>Adicionar</b>.</div>`;
      return;
    }

    for(const it of items){
      const card = document.createElement("div");
      card.className = "item-card";

      const groupHtml = it.group ? `<div class="item-name-wrapper"><span class="item-name">${esc(it.group)}</span></div>` : "";
      card.innerHTML = `
        <div class="item-header">
          <div>
            <div class="item-name">${esc(it.name)}</div>
            ${groupHtml}
          </div>
          <div class="item-actions">
            <button class="btn-pill icon" data-act="edit" type="button" title="Editar">‚úèÔ∏è</button>
            <button class="btn-pill icon" data-act="del" type="button" title="Excluir">üóëÔ∏è</button>
          </div>
        </div>

        <div class="qty-row">
          <span>Qtd: <b>${esc(it.qty)}</b> ${esc(it.unit)}</span>
        </div>

        <div class="status-row">
          <button class="status-pill ${statusClass(it.status)}" data-act="status" type="button">
            ${esc(statusText(it.status))}
          </button>
        </div>
      `;

      card.querySelector('[data-act="status"]').addEventListener("click", () => {
        it.status = STATUS_NEXT[it.status] || "ok";
        saveState();
        renderInventory();
        renderShopping();
      });

      card.querySelector('[data-act="edit"]').addEventListener("click", () => openModalEdit(env, it));

      card.querySelector('[data-act="del"]').addEventListener("click", () => {
        if(!confirm(`Excluir "${it.name}"?`)) return;
        state.data[env] = (state.data[env] || []).filter(x => x.id !== it.id);
        saveState();
        renderInventory();
        renderShopping();
      });

      inventoryList.appendChild(card);
    }
  }

  // ---------- Shopping ----------
  function collectShopping(){
    const all = [];
    for(const env of DEFAULT_ENVS){
      for(const it of (state.data[env] || [])){
        if(needsBuy(it)) all.push({ env, ...it });
      }
    }
    return all;
  }

  function renderShopping(){
    const items = collectShopping();
    shoppingList.innerHTML = "";

    // mode toggles (if exist)
    if(shoppingModeRow){
      const modeButtons = Array.from(shoppingModeRow.querySelectorAll("button[data-mode]"));
      modeButtons.forEach(b => b.classList.toggle("active", b.dataset.mode === state.shoppingMode));
    }

    if(!items.length){
      shoppingList.innerHTML = `<div class="hint">Lista vazia üôÇ<br>Marque um item como <b>üü° Acabando</b> ou <b>üî¥ Acabou</b> no invent√°rio.</div>`;
      return;
    }

    const makeLine = (it) => {
      const line = document.createElement("div");
      line.className = "shopping-item";
      line.innerHTML = `
        <label style="display:flex; gap:.6rem; align-items:center; flex:1;">
          <input type="checkbox" class="shop-check" />
          <span>${esc(it.name)}</span>
        </label>
        <span style="opacity:.75; font-size:.9rem;">${esc(envLabel(it.env))}</span>
        <button class="btn-pill icon" data-act="ok" type="button" title="Marcar como comprado">‚úÖ</button>
      `;
      line.querySelector('[data-act="ok"]').addEventListener("click", () => {
        const arr = state.data[it.env] || [];
        const ref = arr.find(x => x.id === it.id);
        if(ref){
          ref.status = "ok";
          saveState();
          renderInventory();
          renderShopping();
        }
      });
      return line;
    };

    if(state.shoppingMode === "por-ambiente"){
      for(const env of DEFAULT_ENVS){
        const group = items.filter(x => x.env === env);
        if(!group.length) continue;

        const title = document.createElement("div");
        title.className = "hint";
        title.style.margin = "10px 0 6px";
        title.innerHTML = `<b>${esc(envLabel(env))}</b>`;
        shoppingList.appendChild(title);

        group.sort((a,b)=> (a.name||"").localeCompare(b.name||""));
        group.forEach(it => shoppingList.appendChild(makeLine(it)));
      }
    }else{
      items.sort((a,b)=> (a.name||"").localeCompare(b.name||""));
      items.forEach(it => shoppingList.appendChild(makeLine(it)));
    }
  }

  if(shoppingModeRow){
    shoppingModeRow.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-mode]");
      if(!btn) return;
      state.shoppingMode = (btn.dataset.mode === "por-ambiente") ? "por-ambiente" : "geral";
      saveState();
      renderShopping();
    });
  }

  // ---------- Backup / Restore ----------
  btnBackup?.addEventListener("click", () => {
    const blob = new Blob([JSON.stringify(state, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "inventario-mae-backup.json";
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(a.href);
    a.remove();
  });

  btnRestore?.addEventListener("click", () => restoreFile?.click());

  restoreFile?.addEventListener("change", () => {
    const file = restoreFile.files && restoreFile.files[0];
    if(!file) return;

    const r = new FileReader();
    r.onload = () => {
      try{
        const parsed = JSON.parse(r.result);
        if(!parsed || typeof parsed !== "object" || !parsed.data) throw new Error("bad");
        if(!confirm("Restaurar backup? Isso substitui os dados atuais.")) return;

        state.activeTab = parsed.activeTab === "compras" ? "compras" : "inventario";
        state.activeEnv = DEFAULT_ENVS.includes(parsed.activeEnv) ? parsed.activeEnv : "despensa";
        state.shoppingMode = parsed.shoppingMode === "por-ambiente" ? "por-ambiente" : "geral";
        state.data = Object.fromEntries(DEFAULT_ENVS.map(e => [e, Array.isArray(parsed.data[e]) ? parsed.data[e] : []]));

        saveState();
        setActiveEnv(state.activeEnv);
        setActiveTab(state.activeTab);
      }catch(err){
        alert("Arquivo inv√°lido üòï");
      }finally{
        restoreFile.value = "";
      }
    };
    r.readAsText(file);
  });

  // ---------- Init ----------
  setActiveEnv(DEFAULT_ENVS.includes(state.activeEnv) ? state.activeEnv : "despensa");
  setActiveTab(state.activeTab === "compras" ? "compras" : "inventario");
})();
</script>



<script>
(() => {
  // Service Worker (mesmo do app unificado)
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js?v=1").catch(()=>{});
    });
  }

  // üè† In√≠cio (volta para o menu do app)
  const btnHome = document.getElementById("btnHome");
  if (btnHome) btnHome.addEventListener("click", () => {
    window.location.href = "./index.html";
  });
})();
</script>

</body>
</html>
