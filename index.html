<head>
  <meta charset="UTF-8" />
  <title>Rotina 14 Dias ‚Äî Fibro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#4b7bec" />
  <style>
    :root {
      --bg: #f5f5fa;
      --card-bg: #ffffff;
      --primary: #4b7bec;
      --secondary: #20bf6b;
      --accent: #f7b731;
      --text: #222;
      --muted: #666;
      --border: #ddd;
      --danger: #eb3b5a;
      --pill-bg: #eef2ff2;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 960px;
      margin: 0 auto;
      padding: 1rem 0.75rem 3rem;
      background: var(--bg);
      color: var(--text);
    }
    h1 { font-size: 1.0rem; margin-bottom: 0.1rem; }
    .subtitle { font-size: 0.85rem; color: var(--muted); margin-bottom: 0.4rem; }

    .card {
      background: var(--card-bg);
      border-radius: 14px;
      padding: 0.9rem 0.9rem 1rem;
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.08);
      margin-bottom: 0.85rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.35rem;
      gap: 0.5rem;
    }
    .card-header h2 {
      font-size: 0.95rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .badge {
      font-size: 0.8rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      background: #f9fafb;
    }
    .badge.primary {
      border-color: rgba(59, 130, 246, 0.6);
      background: rgba(59, 130, 246, 0.07);
      color: #1d4ed8;
    }
    .badge.orange {
      border-color: rgba(249, 115, 22, 0.6);
      background: rgba(249, 115, 22, 0.07);
      color: #c2410c;
    }
    .badge.gray {
      border-color: rgba(148, 163, 184, 0.6);
      background: rgba(148, 163, 184, 0.07);
      color: #4b5563;
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-bottom: 0.6rem;
      align-items: center;
    }
    select, button { font-family: inherit; font-size: 0.85rem; }
    select {
      padding: 0.3rem 0.5rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #FFF;
      color: var(--text);
    }
    .btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      padding: 0.25rem 0.6rem;
      font-size: 0.75rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      cursor: pointer;
    }
    .btn-outline { background: transparent; }
    .btn-small {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      padding: 0.2rem 0.6rem;
      font-size: 0.75rem;
      cursor: pointer;
    }
    .btn-icon {
      border-radius: 999px;
      border: none;
      background: transparent;
      padding: 0.1rem 0.2rem;
      font-size: 0.9rem;
      cursor: pointer;
      color: var(--muted);
    }
    .btn-icon:hover { color: var(--text); }

    .section-title {
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--muted);
      margin: 0.4rem 0 0.2rem;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    .section-title span.icon { font-size: 0.9rem; }

    .tasks-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0.22rem;
      margin-bottom: 0.25rem;
    }
    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 0.35rem;
      padding: 0.2rem 0.15rem;
      border-radius: 10px;
    }
    .task-main {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.1rem;
      flex: 1;
    }
    .task-label-main { font-size: 0.9rem; }
    .task-details {
      font-size: 0.9rem;
      color: var(--muted);
      margin-top: 0.18rem;
      display: none;
    }
    input[type="checkbox"] {
      width: 15px;
      height: 15px;
      accent-color: var(--primary);
      margin-top: 0.1rem;
    }
    .empty-message {
      font-size: 0.85rem;
      color: var(--muted);
      padding: 0.6rem 0.3rem;
      line-height: 1.4;
    }
    .stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      font-size: 0.78rem;
      margin-top: 0.2rem;
    }
    .stats-chip {
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      background: #f3f4f6;
      color: #374151;
    }
    .bar-group { margin-top: 0.4rem; display: flex; flex-direction: column; gap: 0.3rem; }
    .bar-label { font-size: 0.75rem; color: var(--muted); margin-bottom: 0.05rem; }
    .bar {
      width: 100%; height: 6px; border-radius: 999px;
      background: #e5e7eb; overflow: hidden;
    }
    .bar-fill {
      height: 100%; width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg,#60a5fa,#22c55e);
      transition: width 0.2s ease-out;
    }
    .mini-text {
      font-size: 0.72rem;
      color: var(--muted);
      margin-top: 0.3rem;
      line-height: 1.4;
    }
    .flex-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
    }
    .mt-4 { margin-top: 0.8rem; }

    @media (min-width: 720px) {
      .grid-2 { display: grid; gap: 0.9rem; grid-template-columns: minmax(0,1.1fr) minmax(0,1fr); }
    }

    /* CABE√áALHO P√çLULA */
    .header-main-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }
    .header-main-top-right {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .pill-group {
      display: inline-flex;
      width: auto;
      padding: 0.35rem 0.5rem;
      border-radius: 999px;
      background: var(--pill-bg);
      justify-content: center;
      align-items: center;
      gap: 0.3rem;
      margin: 0 auto;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      border: 1px solid rgba(0,0,0,0.05);
    }
    .tabs-header { display: flex; justify-content: center; }
    .header-controls > div { display: flex; justify-content: center; }

    .tab-button {
      flex: 1;
      min-width: 0;
      border-radius: 999px;
      border: none;
      background: transparent;
      font-size: 0.85rem;
      padding: 0.35rem 0.55rem;
      cursor: pointer;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 0.25rem;
      color: #4b5563;
    }
    .tab-button.active {
      background: #F0F8FF;
      color: #2563eb;
      font-weight: 600;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    .chip-group { display: inline-flex; gap: 0.2rem; }
    .chip {
      border-radius: 999px;
      border: none;
      background: transparent;
      padding: 0.32rem 0.7rem;
      font-size: 0.83rem;
      cursor: pointer;
      color: #4b5563;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      min-width: 0;
    }
    .chip.active {
      background: #F0F8FF;
      color: #2563eb;
      font-weight: 600;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }
    .chip.danger.active { color: #b91c1c; }

    .header-controls {
      margin-top: 0.7rem;
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
    }
    .cycle-row {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.85rem;
    }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* ALIMENTA√á√ÉO */
    .meal-card {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 0.6rem 0.6rem 0.5rem;
      margin-bottom: 0.5rem;
      background: #f9fafb;
    }
    .meal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.35rem;
    }
    .meal-title {
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .meal-header-actions {
      display: flex;
      gap: 0.25rem;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .meal-toggle-btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #ffffff;
      padding: 0.18rem 0.5rem;
      font-size: 0.7rem;
      cursor: pointer;
    }
    .meal-toggle-btn.skip-active {
      background: rgba(148,163,184,0.16);
      color: #4b5563;
    }
    .meal-toggle-btn.off-active {
      background: rgba(248,113,113,0.12);
      border-color: rgba(248,113,113,0.7);
      color: #b91c1c;
    }
    .meal-options-list {
      margin-top: 0.3rem;
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }
    .meal-option-row {
      display: flex;
      align-items: flex-start;
      gap: 0.35rem;
      padding: 0.18rem 0;
    }
    .meal-option-main {
      flex: 1;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .meal-option-buttons {
      display: flex;
      gap: 0.15rem;
      align-items: center;
    }
    .meal-adjust-btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #ffffff;
      padding: 0.15rem 0.45rem;
      font-size: 0.7rem;
      cursor: pointer;
    }
    .meal-note-block {
      margin-left: 1.6rem;
      margin-top: 0.15rem;
    }
    .meal-note {
      width: 100%;
      font-size: 0.78rem;
      font-family: inherit;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      padding: 0.3rem;
      resize: vertical;
      min-height: 36px;
    }
    .meal-recipe {
      margin-left: 1.6rem;
      margin-top: 0.15rem;
      font-size: 0.9rem;
      color: var(--muted);
      padding: 0.25rem 0.3rem;
      border-left: 2px solid #d1d5db;
      display: none;
    }
    .meal-add-area {
      margin-top: 0.6rem;
      border-top: 1px dashed #e5e7eb;
      padding-top: 0.35rem;
    }
    .meal-add-area label {
      font-size: 0.75rem;
      color: var(--muted);
      display: block;
      margin-bottom: 0.15rem;
    }
    .meal-add-area input,
    .meal-add-area textarea,
    .meal-add-area select {
      width: 100%;
      font-size: 0.78rem;
      font-family: inherit;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      padding: 0.3rem;
      margin-bottom: 0.25rem;
    }

    /* EXERC√çCIOS */
    .exercise-block {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 0.6rem;
      margin-bottom: 0.5rem;
      background: #f9fafb;
    }
    .exercise-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.2rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .exercise-meta {
      font-size: 0.75rem;
      color: var(--muted);
      margin-bottom: 0.35rem;
    }
    .exercise-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }
    .exercise-item {
      display: flex;
      align-items: flex-start;
      gap: 0.3rem;
      font-size: 0.85rem;
    }
    .exercise-item label { flex: 1; }
    .exercise-note {
      font-size: 0.9rem;
      color: var(--muted);
      margin-left: 1.1rem;
      display: none;
    }
    /* ===== MODAL ===== */

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.45);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 500;
  padding: 1rem;
}

.modal-card {
  background: #fff;
  border-radius: 12px;
  padding: 1rem;
  width: 100%;
  max-width: 360px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.18);
  animation: modalIn .18s ease-out;
}

@keyframes modalIn {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}

.modal-card h3 {
  margin-bottom: 0.6rem;
  font-size: 1.05rem;
}

.modal-card label {
  font-size: 0.78rem;
  margin-top: 0.5rem;
  display: block;
}

.modal-card input,
.modal-card textarea,
.modal-card select {
  width: 100%;
  padding: 0.35rem;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  margin-top: 0.15rem;
  font-size: 0.85rem;
}

.modal-card textarea {
  height: 70px;
  resize: vertical;
}

.modal-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 0.4rem;
  margin-top: 0.8rem;
}



  </style>
</head>
<body>
  <!-- CABE√áALHO -->
 <header class="card">
    <div class="header-main-top">
      <div>
        <h1>Rotina Fibro - Caroline Peixoto</h1>
        <div class="subtitle">Alimenta√ß√£o ¬∑ Exerc√≠cios ¬∑ Casa</div>
      </div>
      <div class="header-main-top-right">
        <span class="badge primary">üå∏</span>
      </div>
    </div>
 
     <div class="header-main-top-right">
    
</div>

 <header class="card">
    <!-- Abas -->
    <div class="tabs-header pill-group">
      <button type="button" class="tab-button active" data-tab="tabAlimentacao">
        üçΩÔ∏è <span>Alimenta√ß√£o</span>
      </button>
      <button type="button" class="tab-button" data-tab="tabExercicio">
        üèÉ‚Äç‚ôÄÔ∏è <span>Exerc√≠cios</span>
      </button>
      <button type="button" class="tab-button" data-tab="tabCasa">
        üè° <span>Casa</span>
      </button>
    </div>

    <!-- Dia, energia e contexto -->
    <div class="header-controls">
      <div class="cycle-row">
        <span>Dia do ciclo:</span>
        <select id="daySelect"></select>
      </div>

      <div class="pill-group chip-group" id="energyChips">
        <button type="button" class="chip active" data-energy="alta">üîã Alta</button>
        <button type="button" class="chip" data-energy="baixa">üíß Baixa</button>
      </div>

      <div class="pill-group chip-group" id="contextChips">
        <button type="button" class="chip active" data-context="casa">üè° Casa</button>
        <button type="button" class="chip" data-context="viagem">üß≥ Viagem</button>
        <button type="button" class="chip" data-context="pais">üë®‚Äçüë©‚Äçüëß Pais</button>
        <button type="button" class="chip danger" data-context="pausa">‚è∏ Pausa</button>
      </div>
    </div>
  </header>

  <!-- ALIMENTA√á√ÉO -->
  <section id="tabAlimentacao" class="tab-panel active">
    <section class="card">
      <div class="card-header flex-between">
        <h2>
          üçΩÔ∏è Plano de alimenta√ß√£o do dia
          <span class="badge gray" id="badgeFoodDia"></span>
        </h2>
      </div>
      <div id="foodContent"></div>

      <div class="card mt-4">
  <div class="card-header flex-between">
    <h2>üìä Resumo (ciclo 14 dias)</h2>
    <span class="badge orange" id="badgeFoodResumo"></span>
  </div>
  <div id="foodStats"></div>
</div>

    </section>
  </section>

  <!-- EXERC√çCIOS -->
  <section id="tabExercicio" class="tab-panel">
    <section class="card">
      <div class="card-header flex-between">
        <h2>
          üßò‚Äç‚ôÄÔ∏è Exerc√≠cios do Dia
          <span class="badge gray" id="badgeExDia"></span>
        </h2>
        <span class="mini-text" id="exContextLabel"></span>
      </div>
      <div id="exerciseContent"></div>

      <div class="card-header flex-between">
        <h2>üìä Resumo (ciclo 14 dias)</h2>
        <span class="badge orange" id="badgeExResumo"></span>
      </div>
      <div class="toolbar">
        <button type="button" class="btn btn-outline" id="btnDownloadExResumo">
          ‚¨áÔ∏è Baixar resumo (14 dias)
        </button>
      </div>
      <div id="exerciseStats"></div>
    </section>
  </section>

  <!-- CASA -->
  <section id="tabCasa" class="tab-panel">
    <section class="card">
      <div class="card-header flex-between">
        <h2>
          üè° Casa ‚Äî Tarefas do Dia
          <span class="badge gray" id="badgeCasaDia"></span>
        </h2>
        <span class="mini-text" id="casaContextLabel"></span>
      </div>
      <div id="domesticContent"></div>
      <div class="mini-text">
        [ ] ‚Üí marcar como feito ‚Ä¢ + ‚Üí instru√ß√µes ‚Ä¢ ‚äò ‚Üí n√£o faz sentido hoje
        ‚Ä¢ ‚Ü∫ ‚Üí reagendar para Tarefas reagendadas.
      </div>
    </section>

    <section class="card" id="cardFlex">
      <div class="card-header flex-between">
        <h2>
          üóÇ Tarefas reagendadas
          <span class="badge gray" id="badgeFlexCount">0 tarefa(s)</span>
        </h2>
      </div>
      <div id="flexContent"></div>
    </section>

       <!-- Estat√≠sticas Casa -->
    <section class="card" id="cardStats">
      <div class="card-header flex-between">
        <h2>üìä Resumo (ciclo 14 dias)</h2>
        <span class="badge orange" id="badgeStatsPeriodo">Base: ciclo 14 dias</span>
      </div>
      <div id="statsContent"></div>
    </section>

    <!-- üëá ADICIONE ESTE BLOCO AQUI -->
    <section class="card" id="cardCycleHistory">
  <div class="card-header flex-between">
    <h2>üìö Hist√≥rico de ciclos</h2>
    <div class="flex" style="gap: .4rem;">
      <button type="button" class="btn-small btn-outline" id="btnRestartCycle">
        üåÄ Reiniciar ciclo
      </button>
      <button type="button" class="btn-small" id="btnDownloadCycleHistory">
        ‚¨áÔ∏è Baixar hist√≥rico
      </button>
    </div>
  </div>

  <div id="cycleHistoryContent"></div>
</section>

 
  </section>
      <!-- üëÜ AT√â AQUI -->


<!-- ===== MODAL DE EDI√á√ÉO DE TAREFA ===== -->
<div id="editTaskModal" class="modal-overlay" style="display:none;">
  <div class="modal-card">
    <h3>Editar tarefa</h3>

    <label for="editTaskName">Nome da tarefa:</label>
    <input type="text" id="editTaskName" />

    <label for="editTaskInstr">Instru√ß√µes (opcional):</label>
    <textarea id="editTaskInstr"></textarea>

    <label for="editTaskTipo">Categoria:</label>
    <select id="editTaskTipo">
      <option value="indispensavel">Indispens√°vel</option>
      <option value="desejavel">Desej√°vel</option>
    </select>

    <div class="modal-buttons">
      <button id="editTaskSaveBtn" class="btn-small">Salvar</button>
      <button id="editTaskCancelBtn" class="btn-small btn-outline">Cancelar</button>
    </div>
  </div>
</div>

<!-- ===== MODAL DE EDI√á√ÉO DE OP√á√ÉO DE REFEI√á√ÉO ===== -->
<div id="editFoodModal" class="modal-overlay" style="display:none;">
  <div class="modal-card">
    <h3>Editar op√ß√£o de refei√ß√£o</h3>

    <label for="editFoodMeal">Tipo de refei√ß√£o:</label>
    <select id="editFoodMeal">
      <option value="cafe">Caf√© da manh√£</option>
      <option value="lancheManha">Lanche da manh√£</option>
      <option value="almoco">Almo√ßo</option>
      <option value="lancheTarde">Lanche da tarde</option>
      <option value="jantar">Jantar</option>
      <option value="ceia">Ceia</option>
    </select>

    <label for="editFoodName">Nome da prepara√ß√£o:</label>
    <input type="text" id="editFoodName" />

    <label for="editFoodInstr">Instru√ß√µes / modo de preparo (opcional):</label>
    <textarea id="editFoodInstr"></textarea>

    <div class="modal-buttons">
      <button id="editFoodSaveBtn" class="btn-small">Salvar</button>
      <button id="editFoodCancelBtn" class="btn-small btn-outline">Cancelar</button>
    </div>
  </div>
</div>

<!-- ===== MODAL DE EDI√á√ÉO DE EXERC√çCIO ===== -->
<div id="editExerciseModal" class="modal-overlay" style="display:none;">
  <div class="modal-card">
    <h3>Editar exerc√≠cio</h3>

    <label for="editExName">Nome do exerc√≠cio:</label>
    <input type="text" id="editExName" />

    <label for="editExInstr">Instru√ß√µes (opcional):</label>
    <textarea id="editExInstr"></textarea>

    <label for="editExEquip">Equipamento:</label>
    <input type="text" id="editExEquip" placeholder="Esteira, bola, sem equipamento..." />

    <label for="editExEnergia">N√≠vel de energia:</label>
    <select id="editExEnergia">
      <option value="alta">Energia alta (vers√£o completa)</option>
      <option value="baixa">Energia baixa (vers√£o leve)</option>
    </select>

    <label for="editExContexto">Local:</label>
    <select id="editExContexto">
      <option value="casa">Casa</option>
      <option value="pais">Casa dos pais</option>
      <option value="viagem">Viagem</option>
      <option value="pausa">Pausa</option>
    </select>

    <label for="editExCategoria">Categoria:</label>
    <select id="editExCategoria">
      <option value="forca">For√ßa</option>
      <option value="mobilidade">Mobilidade</option>
      <option value="cardio">Cardio</option>
      <option value="respiracao">Respira√ß√£o</option>
      <option value="alongamento">Alongamento</option>
      <option value="equilibrio">Equil√≠brio</option>
      <option value="recuperacao">Recupera√ß√£o</option>
      <option value="estabilidade">Estabilidade</option>
      <option value="outros">Outros</option>
    </select>

    <div class="modal-buttons">
      <button id="editExSaveBtn" class="btn-small">Salvar</button>
      <button id="editExCancelBtn" class="btn-small btn-outline">Cancelar</button>
    </div>
  </div>
</div>


  <script>
    /* TABS */
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabPanels = document.querySelectorAll(".tab-panel");
    tabButtons.forEach(btn=>{
      btn.addEventListener("click",()=>{
        const targetId = btn.getAttribute("data-tab");
        tabButtons.forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        tabPanels.forEach(p=>p.classList.toggle("active",p.id===targetId));
      });
    });
    


    /* ELEMENTOS GLOBAIS */
   // ===== ELEMENTOS DO CABE√áALHO =====
const daySelect = document.getElementById("daySelect");
const energyChips = document.getElementById("energyChips");
const contextChips = document.getElementById("contextChips");
const btnRestartCycle = document.getElementById("btnRestartCycle"); // üëà AQUI



/* ‚≠ê‚≠ê‚≠ê AQUI ENTRA O SEU TRECHO ‚≠ê‚≠ê‚≠ê */
if (btnRestartCycle) {
  btnRestartCycle.addEventListener("click", restartCycle);
}




    // Alimenta√ß√£o
    const foodContent = document.getElementById("foodContent");
    const foodStats = document.getElementById("foodStats");
    const badgeFoodDia = document.getElementById("badgeFoodDia");
    const badgeFoodResumo = document.getElementById("badgeFoodResumo");

    // Exerc√≠cios
    const exerciseContent = document.getElementById("exerciseContent");
    const exerciseStats = document.getElementById("exerciseStats");
    const badgeExDia = document.getElementById("badgeExDia");
    const badgeExResumo = document.getElementById("badgeExResumo");
    const exContextLabel = document.getElementById("exContextLabel");
    const btnDownloadExResumo = document.getElementById("btnDownloadExResumo");

    // Casa
    const domesticContent = document.getElementById("domesticContent");
    const flexContent = document.getElementById("flexContent");
    const badgeCasaDia = document.getElementById("badgeCasaDia");
    const badgeFlexCount = document.getElementById("badgeFlexCount");
    const statsContent = document.getElementById("statsContent");
    const btnResetCasa = document.getElementById("btnResetCasa");
    const badgeCasaResumo = document.getElementById("badgeStatsPeriodo");
    const casaContextLabel = document.getElementById("casaContextLabel");
    const cycleHistoryContent = document.getElementById("cycleHistoryContent");
const btnDownloadCycleHistory = document.getElementById("btnDownloadCycleHistory");

    
    /* MODAL DE EDI√á√ÉO */
let editTaskModal = document.getElementById("editTaskModal");
let editTaskName = document.getElementById("editTaskName");
let editTaskInstr = document.getElementById("editTaskInstr");
let editTaskTipo = document.getElementById("editTaskTipo");
let editTaskSaveBtn = document.getElementById("editTaskSaveBtn");
let editTaskCancelBtn = document.getElementById("editTaskCancelBtn");

let currentEdit = null; // guarda info tempor√°ria da tarefa

// Modal de edi√ß√£o de op√ß√£o de refei√ß√£o (Alimenta√ß√£o)
let editFoodModal = document.getElementById("editFoodModal");
let editFoodMeal = document.getElementById("editFoodMeal");
let editFoodName = document.getElementById("editFoodName");
let editFoodInstr = document.getElementById("editFoodInstr");
let editFoodSaveBtn = document.getElementById("editFoodSaveBtn");
let editFoodCancelBtn = document.getElementById("editFoodCancelBtn");
let currentFoodEdit = null; // { mealKey, optionId }

// Modal de edi√ß√£o de exerc√≠cio
let editExerciseModal = document.getElementById("editExerciseModal");
let editExName = document.getElementById("editExName");
let editExInstr = document.getElementById("editExInstr");
let editExEquip = document.getElementById("editExEquip");
let editExEnergia = document.getElementById("editExEnergia");
let editExContexto = document.getElementById("editExContexto");
let editExCategoria = document.getElementById("editExCategoria");
let editExSaveBtn = document.getElementById("editExSaveBtn");
let editExCancelBtn = document.getElementById("editExCancelBtn");
let currentExEdit = null; // { day, exId }



    /* ESTADO */
    const STORAGE_KEY = "app_fibro_estado_v4";
    let state = {
  dayMeta: {},
  energyMeta: {},
  foodState: {},
  foodOptionsState: null,
  exState: {},
  exOptionsState: null,
  domesticDone: {},
  domesticIgnored: {},
  domesticReagendado: {},
  domesticCustom: {},
  domesticDeleted: {},   // üëà NOVO
  flexList: [],
  flexHistory: [],
  cycleHistory: []
};


  function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;

    const parsed = JSON.parse(raw) || {};

    // mescla o que j√° existe com o salvo
    state = Object.assign(state, parsed);

    // garantias de campos
    state.cycleHistory    = parsed.cycleHistory    || [];
    state.domesticDeleted = parsed.domesticDeleted || {};

    // üëá campos dos exerc√≠cios
    state.exState         = parsed.exState         || {};
    state.exOptionsState  = parsed.exOptionsState  || null; 
    //            ^^^^^ deixa null se n√£o existir, pra ensureExOptionsState() poder montar

  } catch (e) {
    console.warn("Erro ao carregar estado:", e);
  }
}


    
    function persistState(){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }catch(e){ console.warn("Erro ao salvar estado:",e); }
    }
   function restartCycle() {
  const ok = confirm(
    "Reiniciar ciclo de 14 dias?\n\n" +
    "‚Ä¢ O ciclo atual ser√° arquivado no hist√≥rico.\n" +
    "‚Ä¢ As marca√ß√µes de alimenta√ß√£o, exerc√≠cios e casa ser√£o limpas.\n" +
    "‚Ä¢ As op√ß√µes de comida, exerc√≠cios e tarefas personalizadas ser√£o mantidas."
  );
  if (!ok) return;

  if (!state.cycleHistory) state.cycleHistory = [];

  const snapshot = {
  timestamp: new Date().toISOString(),
  dayMeta: state.dayMeta,
  energyMeta: state.energyMeta,
  foodState: state.foodState,
  exState: state.exState,               // üëà corrige aqui
  domesticDone: state.domesticDone,
  domesticIgnored: state.domesticIgnored,
  domesticReagendado: state.domesticReagendado,
  flexHistory: state.flexHistory
};

state.cycleHistory.push(snapshot);

// limpa dados ‚Äúdo ciclo‚Äù
state.dayMeta = {};
state.energyMeta = {};
state.foodState = {};
state.exState = {};                     // üëà e aqui
state.domesticDone = {};
state.domesticIgnored = {};
state.domesticReagendado = {};
state.flexList = [];
state.flexHistory = [];

  // volta para Dia 1, Alta, Casa
  daySelect.value = "1";

  Array.from(energyChips.querySelectorAll(".chip")).forEach((c) => {
    c.classList.toggle("active", c.getAttribute("data-energy") === "alta");
  });

  Array.from(contextChips.querySelectorAll(".chip")).forEach((c) => {
    c.classList.toggle("active", c.getAttribute("data-context") === "casa");
  });

  persistState();
  renderAll && renderAll();
}


    /* DIA / ENERGIA / CONTEXTO */
    function getWeekdayLabel(day){
      const labels=["5¬™","6¬™","S","D","2¬™","3¬™","4¬™"];
      return labels[(day-1)%7];
    }
    function getSelectedDay(){ return parseInt(daySelect.value,10)||1; }
    function getDayEnergy(day){ return state.energyMeta[day] || "alta"; }
    function setDayEnergy(day,val){ state.energyMeta[day]=val; persistState(); }
    function getDayContext(day){ return state.dayMeta[day] || "casa"; }
    function setDayContext(day,val){ state.dayMeta[day]=val; persistState(); }

    for(let i=1;i<=14;i++){
      const opt=document.createElement("option");
      opt.value=i;
      opt.textContent=`Dia ${i} (${getWeekdayLabel(i)})`;
      daySelect.appendChild(opt);
    }
    daySelect.addEventListener("change",()=>renderAll());

    energyChips.addEventListener("click",e=>{
      const btn=e.target.closest(".chip"); if(!btn) return;
      const energy=btn.getAttribute("data-energy");
      const day=getSelectedDay();
      setDayEnergy(day,energy);
      energyChips.querySelectorAll(".chip").forEach(c=>c.classList.toggle("active",c===btn));
      renderAll();
    });

    contextChips.addEventListener("click",e=>{
      const btn=e.target.closest(".chip"); if(!btn) return;
      const ctx=btn.getAttribute("data-context");
      const day=getSelectedDay();
      setDayContext(day,ctx);
      contextChips.querySelectorAll(".chip").forEach(c=>c.classList.toggle("active",c===btn));
      renderAll();
    });

    if(btnResetCasa){
      btnResetCasa.addEventListener("click",()=>{
        if(!confirm("Resetar TODOS os dados de CASA?")) return;
        state.domesticDone={};
        state.domesticIgnored={};
        state.domesticReagendado={};
        state.domesticCustom={};
        state.flexList=[];
        state.flexHistory=[];
        persistState();
        renderAll();
      });
    }

    /* ================= ALIMENTA√á√ÉO ================= */

    const baseFoodOptions = {
      cafe:{ label:"Caf√© da manh√£", icon:"‚òï",
        options:[
          {id:"cafe1",nome:"ü´ìTapioca + queijo + tahine (vers√£o base)",instrucao:"‚ö†Ô∏è RI: manter por√ß√£o pequena. ‚óè Receita: 1 fatia de queijo (minas | mu√ßarela | minas padr√£o), 1 c. ch√° de tahine, or√©gano ou p√°prica. ‚û°Ô∏è R√°pida + est√°vel + n√£o inflama."},
         {id:"cafe2",nome:"ü´ìTapioca + ovo + c√∫rcuma",instrucao:"‚ö†Ô∏è RI: manter por√ß√£o pequena (2 colheres de sopa de goma). ‚óè Receita: Hidrate 2 colheres de tapioca na frigideira, acrescente 1 ovo batido com c√∫rcuma e sal. Feche. ‚óè Dica RI: coloque 1 colher de chia por dentro ‚Üí reduz pico glic√™mico."}, {id:"cafe2",nome:"ü´ìP√£o de frigideira de polvilho",instrucao:"Ovo + polvilho + queijo, dourar dos dois lados."},
         {id:"cafe3",nome:"ü´ì Tapioca Proteica",instrucao:"‚ö†Ô∏è RI: manter por√ß√£o pequena. ‚óè Receita: 1 ovo mexido rapidinho dentro, queijo, tahine. ‚û°Ô∏è Muito saciante e evita qualquer pico glic√™mico. "},
           {id:"cafe4",nome:"ü´ì Tapioca Salgada tipo ‚Äúbruschetta‚Äù ",instrucao:"‚ö†Ô∏è RI: manter por√ß√£o pequena. ‚óè Receita: queijo, tahine, tomate picado, or√©gano, 1 fio de azeite (opcional). ‚û°Ô∏è Super gostosa e sofisticada."},
            {id:"cafe5",nome:"ü´ì Tapioca com tahine + frango desfiado",instrucao:"‚ö†Ô∏è RI: manter por√ß√£o pequena. ‚óè Receita: frango prontinho da dieta, tahine, queijo opcional. ‚û°Ô∏è Refei√ß√£o completa."},
         {id:"cafe6",nome:"ü´ì Tapioca + hummus",instrucao:"‚ö†Ô∏è RI: manter por√ß√£o pequena. ‚óè Receita: Tapioca fininha + 2 colheres de hummus + lim√£o."},
         {id:"cafe7",nome:"üçû P√£o de frigideira (farinha de gr√£o-de-bico)",instrucao:"‚úîÔ∏è Excelente para RI: rico em prote√≠na e fibra. ‚óè Receita: 2 colheres de farinha de gr√£o-de-bico + 1 ovo + √°gua at√© massa grossa. Frite em frigideira antiaderente."},
        {id:"cafe8",nome:"üåΩ P√£ozinho de Milharina",instrucao:"Ingredientes: 1 ovo; 2 colheres de sopa de milharina; 1 colher de sopa de √°gua (para hidratar); 1 colher de ch√° de chia OU linha√ßa (fundamental para RI); pitada de sal; temperos: c√∫rcuma, p√°prica, or√©gano ‚óè Modo de preparo (r√°pido): Misture tudo em uma caneca ou potinho. Mexa at√© virar uma massa homog√™nea. Leve na frigideira untada (2‚Äì3 min), virando para dourar.‚óè Opcional: adicionar 1 colher de requeij√£o light OU 1 fatia fina de queijo (gordura desacelera a glicose).üü¶ Vers√£o Proteica: Adicionar 1 colher de iogurte natural na massa. üü© Vers√£o Antiinflamat√≥ria: Adicionar c√∫rcuma + pimenta-do-reino + azeite. üüß Vers√£o Doce: Adicionar canela + ¬Ω banana pequena amassada (ok para RI se for pequena). üü• Vers√£o Crocante: Adicionar gergelim por cima antes de virar. üü™ Vers√£o 100% Baixa Energia: Misturar milharina + ovo direto na frigideira ‚Üí mexer ‚Üí virar ‚Üí pronto."}, 
        {id:"cafe9",nome:"ü•û Panqueca de banana + canela",instrucao:"‚ö†Ô∏è RI: usar ¬Ω banana ou banana verde.Receita: Amasse ¬Ω banana, misture 1 ovo + 2 colheres de aveia + canela. Frite em fogo baixo.Dica: adicione 1 colher de pasta de amendoim sem a√ß√∫car para prote√≠na/fibra."},
          
          {id:"cafe10",nome:"ü•ö Ovos mexidos + fruta",instrucao:"‚úîÔ∏è Perfeito para RI. ‚óè  Receita: Mexa 2 ovos com sal; sirva com 1 fruta de baixo IG (kiwi, morango, ma√ß√£)."},
          
          {id:"cafe11",nome:"ü•û Aveioca (aveia + ovo)",instrucao:"‚úîÔ∏è Boa para RI. ‚óè  Receita: 1 ovo + 2 colheres de aveia + pitada de sal. Frite como uma crepioca. ‚óè Dica: adicione c√∫rcuma para anti-inflamat√≥rio."},
          
          {id:"cafe12",nome:"üçå Banana + castanhas (baixa energia)",instrucao:"‚úîÔ∏è Ok para RI se usar banana pequena. ‚óè Receita: Corte a banana, coloque castanhas por cima. ‚óè Dica: adicione chia ‚Üí baixa IG."},
          
          
        ]
      },
      lancheManha:{ label:"Lanche da manh√£", icon:"ü•ê",
        options:[
          {id:"lm1",nome:"ü•• Fruta ao natural",instrucao:"‚úîÔ∏è Prefira: kiwi, ma√ß√£, morango, p√™ra. ‚óè Dica: combine com 1 castanha ‚Üí controla a√ß√∫car."},
          {id:"lm2",nome:"ü•ú Castanha-do-par√° / nozes",instrucao:"‚úîÔ∏è √ìtimo para RI. ‚óè  Receita: 2 unidades, n√£o mais (muita gordura = inflama√ß√£o)."},
          {id:"lm3",nome:"ü•ë Creme de abacate",instrucao:"‚úîÔ∏è Perfeito para RI e anti-inflamat√≥rio. ‚óè Receita: amasse ¬Ω abacate + lim√£o + canela."},
          {id:"lm4",nome:"üçì Vitamina de frutas vermelhas + leite vegetal",instrucao:"‚úîÔ∏è Excelente para RI. ‚óè Receita: ¬Ω x√≠cara de morangos congelados + leite vegetal + 1 colher chia."},
                  {id:"lm3",nome:"üçå Banana + cacau 100%",instrucao:"‚úîÔ∏è Usar banana pequena. ‚óè Receita: amasse banana, misture cacau e canela."}
        ]
      },
      almoco:{ label:"Almo√ßo", icon:"üçõ",
        options:[
          {id:"al1",nome:"üçõ Arroz + feij√£o + carne mo√≠da + salada + legumes",instrucao:"üçΩÔ∏è Montagem ideal (propor√ß√£o perfeita):¬Ω prato de legumes/salad, ¬º arroz (melhor branco do que integral para digest√£o), ¬º feij√£o + carne mo√≠da. ‚óè Dicas anti-inflamat√≥rias: Use c√∫rcuma + pimenta na carne. Salada com lim√£o + azeite. Feij√£o engrossado ‚Üí mais fibras. ‚óè Vantagem RI: feij√£o reduz o pico de glicemia do arroz."},
         {id:"al2",nome:"üçõ Arroz + Feij√£o + Prote√≠na + Salada",instrucao:"(cl√°ssico brasileiro aprovado para RI) ‚óè Comece o prato pela salada ‚óè Dica RI: coloque 1 colher de linha√ßa no feij√£o."},
          {id:"al3",nome:"üéÉ Feij√£o + Carne Mo√≠da + Ab√≥bora",instrucao:"Dica: finalize com c√∫rcuma fria + azeite."},
          {id:"al4",nome:"ü•£ Feij√£o + Ovo (baixa energia)",instrucao:"(uma das melhores op√ß√µes para dias cansados) ‚óè Aque√ßa 1 concha de feij√£o. Fa√ßa 2 ovos mexidos e adicione por cima. ‚óè Dica: tomate picado para fibra extra."},  {id:"al2",nome:"üçõ Arroz + carne mo√≠da + legumes + salada",instrucao:"Receita: monte prato com arroz integral + carne + legumes refogados. ‚óè Dica RI: colocar salada primeiro ‚Üí reduz absor√ß√£o da glicose."},
          {id:"al5",nome:"üçó Arroz + frango + salada",instrucao:"Receita: descongele frango em tiras; aque√ßa. ‚óè Sirva com salada + lim√£o."},
          {id:"al6",nome:"ü•£ Arroz + lentilha + legumes + salada",instrucao:"‚úîÔ∏è Excelente para RI (lenta digest√£o). Receita: misture tudo no prato; finalize com c√∫rcuma fria + azeite."},
          {id:"al7",nome:"üç≥ Arroz + ovo + tomate (baixa energia)",instrucao:"Receita: 2 ovos mexidos + arroz + tomate picado. ‚óèDica: coloque gergelim por cima."},
         {id:"al8",nome:"üçñ Picanha su√≠na assada + arroz + salada",instrucao:"Montagem: 1 por√ß√£o pequena de picanha su√≠na, ¬º prato de arroz, ¬Ω prato de salada/legumes ‚óè Receita r√°pida da picanha su√≠na: Tempere com sal, alho, p√°prica e lim√£o. Leve ao forno ou airfryer at√© dourar. Corte em fatias finas. ‚óè Dicas anti-inflamat√≥rias: Use lim√£o + cheiro-verde para finalizar. Priorize por√ß√£o pequena. ‚óè Vantagem RI: a gordura desacelera a absor√ß√£o do arroz, equilibrando a glicemia."},
         {id:"al9",nome:" üçÑ Quinoa + cogumelos + legumes",instrucao:"‚úîÔ∏è Refei√ß√£o anti-inflamat√≥ria cl√°ssica. ‚óè Receita: refogue cogumelos na manteiga ou azeite; misture com quinoa."},
          {id:"al10",nome:"üéÉ Pur√™ de ab√≥bora + frango",instrucao:"‚úîÔ∏è Baixo IG, leve e calmante. ‚óè Receita: ab√≥bora cozida + azeite + sal. Frango desfiado por cima."},
          {id:"al11",nome:"üç† Pur√™ de batata-doce + carne mo√≠da",instrucao:"‚úîÔ∏è Bom para RI se por√ß√£o pequena (4 colheres)."},
          {id:"al2",nome:"üßÜ Gr√£o-de-bico + arroz + abobrinha",instrucao:"‚úîÔ∏è Riqu√≠ssimo em fibra. ‚óè Receita: junte na panela e aque√ßa com c√∫rcuma + lim√£o."},
          {id:"al13",nome:"ü•ó Legumes Assados + Frango + Salada",instrucao:"Receita r√°pida dos legumes: Misture: abobrinha + cenoura + br√≥colis + cebola. Tempere com azeite, sal, p√°prica e alecrim. 20‚Äì25 min no forno ou airfryer (pr√©-assado e congelado). ‚óè Frango rapidinho: Tempere com sal, alho, lim√£o e p√°prica. 3‚Äì4 min de cada lado na frigideira. ‚óè Dicas anti-inflamat√≥rias: Use c√∫rcuma no frango. Adicione gergelim por cima. Vantagem RI: baixo √≠ndice glic√™mico, muita fibra e prote√≠na."},
          {id:"al14",nome:"üåø Finaliza√ß√µes anti-inflamat√≥rias: C√∫rcuma fria. Gergelim. Cebolinha. Azeite extravirgem. ‚úîÔ∏è Todas compat√≠veis com RI.",instrucao:""}
         
         
          
          
        ]
      },
      lancheTarde:{ label:"Lanche da tarde", icon:"üçé",
        options:[
          {id:"lt1",nome:"Repetir caf√© da manh√£",instrucao:""},
          {id:"lt2",nome:"üçø Pipoca Cl√°ssica",instrucao:"Ingredientes: 1 colher de sopa de azeite OU √≥leo de girassol, 2‚Äì3 colheres de milho para pipoca, Sal a gosto. ‚óè Opcional: c√∫rcuma + pimenta-do-reino + p√°prica. ‚óè Tempere ainda quente. ‚óè Por que √© boa? ‚úîÔ∏è Pouco √≥leo = glicemia est√°vel ‚úîÔ∏è Azeite aumenta a a√ß√£o anti-inflamat√≥ria ‚úîÔ∏è Muito sabor com pouco esfor√ßo. üçø Por√ß√£o Ideal:‚úîÔ∏è 1 tigela pequena (‚âà 3 x√≠caras de pipoca estourada)‚Ä¢ Mant√©m a glicemia est√°vel e evita exageros."},
          {id:"lt3",nome:"üçø Pipoca na √Ågua",instrucao:"Ingredientes: 2‚Äì3 colheres de milho, 1 colher de sopa de √°gua, Sal e temperos a gosto. ‚óè Tempere depois ‚óè Por que √© boa? ‚úîÔ∏è Quase sem calorias ‚úîÔ∏è Sem gordura inflamat√≥ria ‚úîÔ∏è √ìtima para comer √† noite. üçø Por√ß√£o Ideal:‚úîÔ∏è 1 tigela pequena (‚âà 3 x√≠caras de pipoca estourada)‚Ä¢ Mant√©m a glicemia est√°vel e evita exageros."},
          {id:"lt4",nome:"üçø Pipoca Turbinada Antioxidante",instrucao:"Para temperar depois de pronta: ¬Ω colher de ch√° de c√∫rcuma. Pitada de pimenta-do-reino. P√°prica. Fio fin√≠ssimo de azeite. Alecrim em p√≥ ‚óè Por que funciona: ‚úîÔ∏è Anti-inflamat√≥rio completo ‚úîÔ∏è Ajuda na dor m√∫sculo-esquel√©tica ‚úîÔ∏è D√° saciedade e controla glicemia. üçø Por√ß√£o Ideal:‚úîÔ∏è 1 tigela pequena (‚âà 3 x√≠caras de pipoca estourada)‚Ä¢ Mant√©m a glicemia est√°vel e evita exageros."},
          {id:"lt5",nome:"üçø Pipoca ‚ÄúSabor Queijo‚Äù sem lactose",instrucao:"Fa√ßa a pipoca (vers√£o leve ou cl√°ssica). Polvilhe nutritional yeast por cima. Misture com colher ou sacudindo o pote. ‚óè Sabor: üî∏ Fica com gosto de queijo parmes√£o! üî∏ 100% seguro para fibro + RI. üçø Por√ß√£o Ideal:‚úîÔ∏è 1 tigela pequena (‚âà 3 x√≠caras de pipoca estourada)‚Ä¢ Mant√©m a glicemia est√°vel e evita exageros."},
          {id:"lt6",nome:"üçø Pipoca Doce Leve (sem a√ß√∫car)",instrucao:"Canela, ¬Ω colher de cacau 100% ‚óè Opcional: 1 tiquinho de stevia se quiser doce ‚óè Modo: Polvilhe tudo por cima e mexa. ‚óè Por que √© boa? ‚úîÔ∏è N√£o usa a√ß√∫car ‚úîÔ∏è Sabor de ‚Äúpipoca doce‚Äù sem subir glicose.  üçø Por√ß√£o Ideal:‚úîÔ∏è 1 tigela pequena (‚âà 3 x√≠caras de pipoca estourada)‚Ä¢ Mant√©m a glicemia est√°vel e evita exageros."}
          
        ]
      },
      jantar:{ label:"Jantar", icon:"üçΩÔ∏è",
        options:[
           {id:"ja1",nome:"ü•™ Lanche leve (omelete ou sandu√≠che)",instrucao:"Evitar fritura pesada; preferir omelete com legumes."},
           {id:"ja2",nome:"üçö Arroz + Feij√£o + Ovo (super r√°pido)",instrucao:""},
        {id:"ja3",nome:"üçö Arroz + ovo",instrucao:"Dia de energia muito baixa. ‚óè Receita: ovo frito ou cozido + arroz. Acrescente salada crua para fibra."},  
        {id:"ja4",nome:"üçö Comida sem feij√£o",instrucao:"Arroz + prote√≠na + legumes."},
          {id:"ja5",nome:"ü´ò Sopa r√°pida de feij√£o",instrucao:"(ideal para noite: leve e estabiliza glicemia). ‚óè Receita: Bata 1 concha de feij√£o no mixer com √°gua quente. Aque√ßa e adicione c√∫rcuma + azeite. Coloque frango desfiado por cima se quiser. "},
         
          {id:"ja6",nome:"üç≥ Omelete r√°pida",instrucao:"Receita: 2 ovos + cebola + or√©gano. 3 minutos."},
          {id:"ja7",nome:"üçµ Holy Soop (variedades)",instrucao:"‚úîÔ∏è Escolher vers√µes com mais prote√≠na (frango, carne, legumes).‚óè Receita: s√≥ aquecer e servir com c√∫rcuma ou gergelim."},
          {id:"ja8",nome:"ü•£ Sopa caseira congelada",instrucao:"‚Üí finalize com azeite."},
          
          {id:"ja9",nome:"ü•ó Bowl r√°pido (arroz + prote√≠na + legumes)",instrucao:"Receita: misture tudo em uma tigela e finalize com lim√£o."},
          {id:"ja10",nome:"üéÉ Pur√™ + frango (Vers√£o conforto.)",instrucao:"Receita: pur√™ descongelado + frango desfiado."}
        ]
      },
      ceia:{ label:"Ceia", icon:"üåô",
        options:[
          {id:"ce1",nome:"üåº Ch√° de camomila",instrucao:"Camomila, erva-doce, cidreira. ‚úîÔ∏è relaxa para dor e sono. "},
          {id:"ce2",nome:"üçå Banana + cacau",instrucao:"‚úîÔ∏è pequena por√ß√£o."},
          {id:"ce3",nome:"ü•ù Kiwi",instrucao:"‚úîÔ∏è baixo IG."},
           {id:"ce4",nome:"üçé Fruta leve",instrucao:"ma√ß√£, morango, p√™ra."}
        ]
      }
    };

    function ensureFoodOptionsState(){
      if(!state.foodOptionsState){
        state.foodOptionsState = JSON.parse(JSON.stringify(baseFoodOptions));
        persistState();
      }
      return state.foodOptionsState;
    }
    function getFoodDayState(day){
      if(!state.foodState[day]) state.foodState[day]={meals:{}};
      return state.foodState[day];
    }
    function getMealState(day,mealKey){
      const dayState=getFoodDayState(day);
      if(!dayState.meals[mealKey]){
        dayState.meals[mealKey]={ skip:false,notFollow:false,notFollowNote:"",options:{} };
      }
      return dayState.meals[mealKey];
    }

    function toggleMealSkip(day,mealKey){
      const m=getMealState(day,mealKey);
      m.skip=!m.skip;
      if(m.skip){
        m.notFollow=false;
        m.notFollowNote="";
        m.options={};
      }
      persistState(); renderFood();
    }
    function toggleMealNotFollow(day,mealKey){
      const m=getMealState(day,mealKey);
      m.notFollow=!m.notFollow;
      if(m.notFollow){
        m.skip=false;
        m.options={};
      }else{
        m.notFollowNote="";
      }
      persistState(); renderFood();
    }
    function setMealNotFollowNote(day,mealKey,note){
      const m=getMealState(day,mealKey);
      m.notFollowNote=note; persistState();
    }
    function toggleFoodOptionChecked(day,mealKey,optionId){
      const m=getMealState(day,mealKey);
      if(!m.options[optionId]) m.options[optionId]={checked:false,note:""};
      m.options[optionId].checked=!m.options[optionId].checked;
      if(!m.options[optionId].checked) m.options[optionId].note="";
      m.skip=false; m.notFollow=false; m.notFollowNote="";
      persistState(); renderFood();
    }
    function setFoodOptionNote(day,mealKey,optionId,note){
      const m=getMealState(day,mealKey);
      if(!m.options[optionId]) m.options[optionId]={checked:true,note:""};
      m.options[optionId].note=note; persistState();
    }
    function addFoodOption(mealKey,nome,instrucao){
      const optState=ensureFoodOptionsState();
      const meal=optState[mealKey]; if(!meal) return;
      const id=mealKey+"_custom_"+Date.now();
      meal.options.push({id,nome,instrucao});
      persistState(); renderFood();
    }
  
  function editFoodOption(mealKey, optionId) {
  const optionsState = ensureFoodOptionsState();
  const meal = optionsState[mealKey];
  if (!meal) return;

  const opt = meal.options.find((o) => o.id === optionId);
  if (!opt) return;

  currentFoodEdit = { mealKey, optionId };

  // Preenche campos do modal
  editFoodMeal.value = mealKey;
  editFoodName.value = opt.nome || "";
  editFoodInstr.value = opt.instrucao || "";

  editFoodModal.style.display = "flex";
}

// Bot√µes do modal de Alimenta√ß√£o
if (editFoodCancelBtn) {
  editFoodCancelBtn.addEventListener("click", () => {
    editFoodModal.style.display = "none";
    currentFoodEdit = null;
  });
}

if (editFoodSaveBtn) {
  editFoodSaveBtn.addEventListener("click", () => {
    if (!currentFoodEdit) return;

    const { mealKey: oldMealKey, optionId } = currentFoodEdit;
    const optionsState = ensureFoodOptionsState();

    const newMealKey = editFoodMeal.value;
    const newName = editFoodName.value.trim();
    const newInstr = editFoodInstr.value.trim();

    if (!newName) {
      alert("Digite o nome da prepara√ß√£o.");
      return;
    }

    const oldMeal = optionsState[oldMealKey];
    if (!oldMeal) return;

    const idx = oldMeal.options.findIndex(o => o.id === optionId);
    if (idx === -1) return;

    const opt = oldMeal.options[idx];
    opt.nome = newName;
    opt.instrucao = newInstr;

    // Se mudou o tipo de refei√ß√£o, move a op√ß√£o para outro grupo
    if (newMealKey !== oldMealKey && optionsState[newMealKey]) {
      // remove da refei√ß√£o antiga
      oldMeal.options.splice(idx, 1);
      // adiciona na refei√ß√£o nova
      optionsState[newMealKey].options.push(opt);

      // Move tamb√©m os "checks" dos dias
      Object.keys(state.foodState || {}).forEach((dKey) => {
        const dayMeals = state.foodState[dKey];
        if (!dayMeals || !dayMeals.meals) return;

        const oldMealState = dayMeals.meals[oldMealKey];
        if (!oldMealState || !oldMealState.options) return;
        const optState = oldMealState.options[optionId];
        if (!optState) return;

        // garante estado no novo tipo de refei√ß√£o
        if (!dayMeals.meals[newMealKey]) {
          dayMeals.meals[newMealKey] = {
            skip: false,
            notFollow: false,
            notFollowNote: "",
            options: {}
          };
        }

        dayMeals.meals[newMealKey].options[optionId] = optState;
        delete oldMealState.options[optionId];
      });
    }

    persistState();
    editFoodModal.style.display = "none";
    currentFoodEdit = null;
    renderFood();
  });
}

// Fecha modal de alimenta√ß√£o clicando fora
if (editFoodModal) {
  editFoodModal.addEventListener("click", (e) => {
    if (e.target === editFoodModal) {
      editFoodModal.style.display = "none";
      currentFoodEdit = null;
    }
  });
}



    function deleteFoodOption(mealKey,optionId){
      const optState=ensureFoodOptionsState();
      const meal=optState[mealKey]; if(!meal) return;
      const idx=meal.options.findIndex(o=>o.id===optionId);
      if(idx===-1) return;
      if(!confirm("Deseja excluir essa op√ß√£o?")) return;
      meal.options.splice(idx,1);
      Object.keys(state.foodState||{}).forEach(d=>{
        const dayState=state.foodState[d];
        if(!dayState || !dayState.meals) return;
        const m=dayState.meals[mealKey];
        if(m && m.options && m.options[optionId]) delete m.options[optionId];
      });
      persistState(); renderFood();
    }

    function renderFood(){
      const day=getSelectedDay();
      const ctx=getDayContext(day);
      const weekday=getWeekdayLabel(day);
      const ctxLabel = ctx==="casa"?"Casa":ctx==="pais"?"Casa dos pais":ctx==="viagem"?"Viagem":"Pausa";
      badgeFoodDia.textContent=`${weekday} ‚Ä¢ Dia ${day} ‚Ä¢ ${ctxLabel}`;

      const optState=ensureFoodOptionsState();
      foodContent.innerHTML="";

      if(ctx==="pausa"){
        foodContent.innerHTML='<div class="empty-message">Dia de pausa: sem plano r√≠gido de alimenta√ß√£o. Se alimente como der, com gentileza. üíõ</div>';
        foodStats.innerHTML="";
        return;
      }

      const mealOrder=["cafe","lancheManha","almoco","lancheTarde","jantar","ceia"];
      mealOrder.forEach(mealKey=>{
        const mealCfg=optState[mealKey]; if(!mealCfg) return;
        const mState=getMealState(day,mealKey);

        const card=document.createElement("div");
        card.className="meal-card";

        const header=document.createElement("div");
        header.className="meal-header";

        const title=document.createElement("div");
        title.className="meal-title";
        title.innerHTML=`<span>${mealCfg.icon}</span><span>${mealCfg.label}</span>`;

        const actions=document.createElement("div");
        actions.className="meal-header-actions";

        const btnSkip=document.createElement("button");
        btnSkip.type="button";
        btnSkip.className="meal-toggle-btn";
        btnSkip.textContent="Pular";
        if(mState.skip) btnSkip.classList.add("skip-active");
        btnSkip.onclick=()=>toggleMealSkip(day,mealKey);

        const btnOff=document.createElement("button");
        btnOff.type="button";
        btnOff.className="meal-toggle-btn";
        btnOff.textContent="N√£o segui";
        if(mState.notFollow) btnOff.classList.add("off-active");
        btnOff.onclick=()=>toggleMealNotFollow(day,mealKey);

        actions.appendChild(btnSkip);
        actions.appendChild(btnOff);
        header.appendChild(title);
        header.appendChild(actions);
        card.appendChild(header);

        if(mState.notFollow){
          const block=document.createElement("div");
          block.className="meal-note-block";
          const ta=document.createElement("textarea");
          ta.className="meal-note";
          ta.placeholder="Motivo (ifood, amigos, anivers√°rio, etc.)";
          ta.value=mState.notFollowNote||"";
          ta.oninput=()=>setMealNotFollowNote(day,mealKey,ta.value);
          block.appendChild(ta);
          card.appendChild(block);
        }

        if(!mState.skip && !mState.notFollow){
          const listDiv=document.createElement("div");
          listDiv.className="meal-options-list";

          (mealCfg.options||[]).forEach(opt=>{
            const oState=mState.options[opt.id]||{checked:false,note:""};

            const row=document.createElement("div");
            row.className="meal-option-row";

            const cb=document.createElement("input");
            cb.type="checkbox";
            cb.checked=!!oState.checked;
            cb.onchange=()=>toggleFoodOptionChecked(day,mealKey,opt.id);

            const main=document.createElement("div");
            main.className="meal-option-main";
            const nameSpan=document.createElement("span");
            nameSpan.textContent=opt.nome;
            main.appendChild(nameSpan);

            const btns=document.createElement("div");
            btns.className="meal-option-buttons";

            const btnAdjust=document.createElement("button");
            btnAdjust.type="button";
            btnAdjust.className="meal-adjust-btn";
            btnAdjust.textContent="Ajuste/Obs";
            btnAdjust.style.display=oState.checked?"inline-flex":"none";

            const hasInstr=!!(opt.instrucao && opt.instrucao.trim()!=="");
            const btnRecipe=document.createElement("button");
            btnRecipe.type="button";
            btnRecipe.className="btn-icon";
            btnRecipe.textContent="+";
            btnRecipe.title="Ver receita";

            const btnEdit=document.createElement("button");
            btnEdit.type="button";
            btnEdit.className="btn-icon";
            btnEdit.textContent="‚úé";
            btnEdit.title="Editar";
            btnEdit.onclick=()=>editFoodOption(mealKey,opt.id);

            const btnDel=document.createElement("button");
            btnDel.type="button";
            btnDel.className="btn-icon";
            btnDel.textContent="üóë";
            btnDel.title="Excluir";
            btnDel.onclick=()=>deleteFoodOption(mealKey,opt.id);

            btns.appendChild(btnAdjust);
            if(hasInstr) btns.appendChild(btnRecipe);
            btns.appendChild(btnEdit);
            btns.appendChild(btnDel);

            row.appendChild(cb);
            row.appendChild(main);
            row.appendChild(btns);

            const noteBlock=document.createElement("div");
            noteBlock.className="meal-note-block";
            const noteArea=document.createElement("textarea");
            noteArea.className="meal-note";
            noteArea.placeholder="Descreva o ajuste (troquei prote√≠na, comi sobremesa, etc.)";
            noteArea.value=oState.note||"";
            noteArea.oninput=()=>setFoodOptionNote(day,mealKey,opt.id,noteArea.value);
            noteBlock.appendChild(noteArea);
            noteBlock.style.display=(oState.checked && oState.note)?"block":"none";

            const recipeBlock=document.createElement("div");
            recipeBlock.className="meal-recipe";
            recipeBlock.textContent=opt.instrucao||"";

            btnAdjust.onclick=()=>{
              const vis=noteBlock.style.display==="block";
              noteBlock.style.display=vis?"none":"block";
            };
            if(hasInstr){
              btnRecipe.onclick=()=>{
                const vis=recipeBlock.style.display==="block";
                recipeBlock.style.display=vis?"none":"block";
                btnRecipe.textContent=vis?"+":"‚àí";
              };
            }

            listDiv.appendChild(row);
            listDiv.appendChild(noteBlock);
            if(hasInstr) listDiv.appendChild(recipeBlock);
          });

          card.appendChild(listDiv);
        }

        foodContent.appendChild(card);
      });

      // √Årea √∫nica de adicionar op√ß√£o
      const addArea=document.createElement("div");
      addArea.className="meal-add-area";
      const btnToggle=document.createElement("button");
      btnToggle.type="button";
      btnToggle.textContent="‚ûï Adicionar op√ß√£o";
      const formDiv=document.createElement("div");
      formDiv.style.display="none";

      const lbl=document.createElement("label");
      lbl.textContent="Nova op√ß√£o de refei√ß√£o:";
      const selectMeal=document.createElement("select");
      [
        {key:"cafe",label:"Caf√© da manh√£"},
        {key:"lancheManha",label:"Lanche da manh√£"},
        {key:"almoco",label:"Almo√ßo"},
        {key:"lancheTarde",label:"Lanche da tarde"},
        {key:"jantar",label:"Jantar"},
        {key:"ceia",label:"Ceia"}
      ].forEach(m=>{
        if(!optState[m.key]) return;
        const o=document.createElement("option");
        o.value=m.key; o.textContent=m.label;
        selectMeal.appendChild(o);
      });
      const inputNome=document.createElement("input");
      inputNome.type="text";
      inputNome.placeholder="Nome da prepara√ß√£o";
      const textareaInstr=document.createElement("textarea");
      textareaInstr.placeholder="Instru√ß√µes/receita (opcional)";
      const btnAdd=document.createElement("button");
      btnAdd.type="button";
      btnAdd.textContent="Salvar op√ß√£o";

      btnToggle.onclick=()=>{
        const vis=formDiv.style.display==="block";
        formDiv.style.display=vis?"none":"block";
      };
      btnAdd.onclick=()=>{
        const nome=inputNome.value.trim();
        const instr=textareaInstr.value.trim();
        if(!nome){ alert("Digite o nome da op√ß√£o."); return; }
        addFoodOption(selectMeal.value,nome,instr);
        inputNome.value=""; textareaInstr.value="";
      };

      formDiv.appendChild(lbl);
      formDiv.appendChild(selectMeal);
      formDiv.appendChild(inputNome);
      formDiv.appendChild(textareaInstr);
      formDiv.appendChild(btnAdd);
      addArea.appendChild(btnToggle);
      addArea.appendChild(formDiv);
      foodContent.appendChild(addArea);

      renderFoodStats();
    }

    function renderFoodStats() {
  const optState = ensureFoodOptionsState();
  const mealOrder = ["cafe", "lancheManha", "almoco", "lancheTarde", "jantar", "ceia"];

  // --- 1) Contagem global do ciclo 14 dias ---
  let dentro = 0;
  let pulado = 0;
  let naoCumpri = 0;
  let total = 0;
  let ajustadas = 0;

  for (let d = 1; d <= 14; d++) {
    mealOrder.forEach((mealKey) => {
      const cfg = optState[mealKey];
      if (!cfg) return;

      const m = getMealState(d, mealKey);
      if (!m) return;

      // refei√ß√£o explicitamente pulada
      if (m.skip) {
        pulado++;
        total++;
        return;
      }

      // refei√ß√£o que voc√™ marcou como ‚Äún√£o segui‚Äù
      if (m.notFollow) {
        naoCumpri++;
        total++;
        return;
      }

      // refei√ß√£o realizada (pelo menos 1 op√ß√£o marcada)
      const opts = m.options || {};
      const checkedIds = Object.keys(opts).filter((id) => opts[id].checked);

      if (checkedIds.length === 0) return; // sem registro para essa refei√ß√£o

      dentro++;
      total++;

      // refei√ß√£o dentro do combinado, mas com ajuste anotado
      const teveAjuste = checkedIds.some((id) => {
        const note = (opts[id].note || "").trim();
        return note.length > 0;
      });
      if (teveAjuste) ajustadas++;
    });
  }

  const pDentro = total ? Math.round((dentro / total) * 100) : 0;
  const pPul = total ? Math.round((pulado / total) * 100) : 0;
  const pNao = total ? Math.round((naoCumpri / total) * 100) : 0;
  const pAjustTotal = total ? Math.round((ajustadas / total) * 100) : 0;
  const pAjustDentro = dentro ? Math.round((ajustadas / dentro) * 100) : 0;

  // Badge no cabe√ßalho
  if (total === 0) {
    badgeFoodResumo.textContent = "Ainda sem refei√ß√µes registradas no ciclo";
  } else {
    badgeFoodResumo.textContent =
      `${total} refei√ß√µes registradas ‚Ä¢ ` +
      `${pDentro}% dentro ‚Ä¢ ${pPul}% puladas ‚Ä¢ ${pNao}% fora`;
  }

  // Limpa √°rea
  foodStats.innerHTML = "";

  // --- 2) Texto + barras horizontais (sem duplicar info) ---
  const bars = document.createElement("div");
  bars.className = "bar-group";
  bars.innerHTML = `
    <div>
      <div class="bar-label">Dentro do combinado: ${pDentro}% (${dentro} de ${total})</div>
      <div class="bar"><div class="bar-fill" style="width:${pDentro}%;"></div></div>
    </div>
    <div>
      <div class="bar-label">Refei√ß√µes puladas: ${pPul}% (${pulado} de ${total})</div>
      <div class="bar"><div class="bar-fill" style="width:${pPul}%;"></div></div>
    </div>
    <div>
      <div class="bar-label">N√£o segui o combinado: ${pNao}% (${naoCumpri} de ${total})</div>
      <div class="bar"><div class="bar-fill" style="width:${pNao}%;"></div></div>
    </div>
  `;
  foodStats.appendChild(bars);

  // --- 3) Informa√ß√µes sobre refei√ß√µes ajustadas ---
  const ajustesInfo = document.createElement("div");
  ajustesInfo.className = "mini-text";
  if (total === 0) {
    ajustesInfo.textContent =
      "Assim que voc√™ come√ßar a registrar as refei√ß√µes, vou mostrar tamb√©m quantas foram ajustadas. üíô";
  } else {
    ajustesInfo.textContent =
      `Refei√ß√µes com ajuste anotado: ${ajustadas} ` +
      `(${pAjustTotal}% do total; ${pAjustDentro}% das refei√ß√µes dentro do combinado).`;
  }
  foodStats.appendChild(ajustesInfo);

  // --- 4) Panorama do ciclo (mantido) ---
  let bons = 0,
    parciais = 0,
    dificeis = 0,
    semReg = 0;

  for (let d = 1; d <= 14; d++) {
    let dDentro = 0,
      dPul = 0,
      dNao = 0,
      dTot = 0;

    mealOrder.forEach((mealKey) => {
      const cfg = optState[mealKey];
      if (!cfg) return;
      const m = getMealState(d, mealKey);
      if (!m) return;

      if (m.skip) {
        dPul++;
        dTot++;
        return;
      }
      if (m.notFollow) {
        dNao++;
        dTot++;
        return;
      }

      const vals = Object.values(m.options || {});
      const any = vals.some((v) => v.checked);
      if (!any) return;
      dDentro++;
      dTot++;
    });

    if (dTot === 0) {
      semReg++;
      continue;
    }
    const ratio = dDentro / dTot;
    if (ratio >= 0.7) bons++;
    else if (ratio >= 0.4) parciais++;
    else dificeis++;
  }

  const cardCiclo = document.createElement("div");
  cardCiclo.className = "mt-4";
  const titulo = document.createElement("div");
  titulo.className = "section-title";
  titulo.innerHTML =
    '<span class="icon">üìÜ</span><span>Panorama do ciclo (14 dias)</span>';
  cardCiclo.appendChild(titulo);

  const linha = document.createElement("div");
  linha.className = "stats-row";
  linha.innerHTML = `
    <span class="stats-chip">Bem alinhados (‚â• 70% dentro): ${bons}</span>
    <span class="stats-chip">Mistos (40‚Äì69%): ${parciais}</span>
    <span class="stats-chip">Dif√≠ceis (&lt; 40%): ${dificeis}</span>
    <span class="stats-chip">Sem registro: ${semReg}</span>
  `;
  cardCiclo.appendChild(linha);

  const mini2 = document.createElement("div");
  mini2.className = "mini-text";
  mini2.textContent =
    "√â uma vis√£o gentil do ciclo inteiro, para voc√™ enxergar tend√™ncias, n√£o para se culpar. üíô";
  cardCiclo.appendChild(mini2);

  // Bot√£o de download (mantido)
  const btnDownload = document.createElement("button");
  btnDownload.type = "button";
  btnDownload.className = "btn-small";
  btnDownload.style.marginTop = "0.5rem";
  btnDownload.textContent = "‚¨áÔ∏è Baixar resumo da alimenta√ß√£o (14 dias)";
  btnDownload.onclick = downloadFoodCycleSummary;
  cardCiclo.appendChild(btnDownload);

  foodStats.appendChild(cardCiclo);
}


    function downloadFoodCycleSummary(){
      const optState=ensureFoodOptionsState();
      const mealOrder=["cafe","lancheManha","almoco","lancheTarde","jantar","ceia"];
      const lines=[];
      const now=new Date();
      lines.push("Resumo da alimenta√ß√£o ‚Äì ciclo 14 dias");
      lines.push(`Gerado em: ${now.toLocaleDateString("pt-BR")} ${now.toLocaleTimeString("pt-BR")}`);
      lines.push("");
      let bons=0,parciais=0,dificeis=0,semReg=0;

      for(let d=1;d<=14;d++){
        let dentro=0,pulado=0,nao=0,total=0;
        mealOrder.forEach(mealKey=>{
          const cfg=optState[mealKey]; if(!cfg) return;
          const m=getMealState(d,mealKey);
          if(m.skip){pulado++;total++;return;}
          if(m.notFollow){nao++;total++;return;}
          const vals=Object.values(m.options||{});
          const any=vals.some(v=>v.checked);
          if(!any) return;
          dentro++;total++;
        });
        let perc=total?Math.round(dentro/total*100):0;
        let classe;
        if(total===0){classe="sem registro";semReg++;}
        else if(perc>=70){classe="bem alinhado";bons++;}
        else if(perc>=40){classe="misto";parciais++;}
        else{classe="dif√≠cil";dificeis++;}
        lines.push(`Dia ${d}: ${dentro} dentro, ${pulado} puladas, ${nao} fora (${perc}% dentro) ‚Üí ${classe}`);
      }
      lines.push("");
      lines.push("Panorama do ciclo:");
      lines.push(`Bem alinhados: ${bons}`);
      lines.push(`Mistos: ${parciais}`);
      lines.push(`Dif√≠ceis: ${dificeis}`);
      lines.push(`Sem registro: ${semReg}`);

      const blob=new Blob([lines.join("\n")],{type:"text/plain;charset=utf-8"});
      const url=URL.createObjectURL(blob);
      const a=document.createElement("a");
      a.href=url; a.download="resumo_alimentacao_14_dias.txt";
      document.body.appendChild(a); a.click();
      document.body.removeChild(a); URL.revokeObjectURL(url);
    }
    function computeCycleFoodStats(foodStateSnapshot) {
  const optionsState = ensureFoodOptionsState();
  const mealOrder = ["cafe", "lancheManha", "almoco", "lancheTarde", "jantar", "ceia"];

  let dentro = 0;
  let pulado = 0;
  let naoCumpri = 0;
  let total = 0;

  for (let d = 1; d <= 14; d++) {
    const dayMeals = foodStateSnapshot[d] || foodStateSnapshot[String(d)];
    if (!dayMeals || !dayMeals.meals) continue;

    mealOrder.forEach((mealKey) => {
      const cfg = optionsState[mealKey];
      if (!cfg) return;
      const mealState = dayMeals.meals[mealKey];
      if (!mealState) return;

      if (mealState.skip) {
        pulado++;
        total++;
        return;
      }
      if (mealState.notFollow) {
        naoCumpri++;
        total++;
        return;
      }

      const opts = mealState.options || {};
      const anyChecked = Object.values(opts).some((v) => v.checked);
      if (!anyChecked) return;

      dentro++;
      total++;
    });
  }

  const percDentro = total ? Math.round((dentro / total) * 100) : 0;
  const percPulado = total ? Math.round((pulado / total) * 100) : 0;
  const percNao = total ? Math.round((naoCumpri / total) * 100) : 0;

  return {
    dentro,
    pulado,
    naoCumpri,
    total,
    percDentro,
    percPulado,
    percNao
  };
}

function computeCycleExerciseStats(exDoneSnapshot) {
  let diasComMov = 0;
  const totalDias = 14;

  for (let d = 1; d <= 14; d++) {
    const dayEx = exDoneSnapshot[d] || exDoneSnapshot[String(d)];
    if (!dayEx) continue;
    const anyDone = Object.values(dayEx).some((v) => !!v);
    if (anyDone) diasComMov++;
  }

  const percDiasMov = totalDias ? Math.round((diasComMov / totalDias) * 100) : 0;

  return {
    diasComMov,
    totalDias,
    percDiasMov
  };
}


    /* ================= EXERC√çCIOS ================= */

    // base: s√≥ Dia 1 completo por enquanto; outros dias podem repetir esse padr√£o
    const baseExOptions = {
      1: [
        // Casa / alta
        {id:"d1_1",nome:"Esteira 10‚Äì15 min",instrucao:"Inicie em velocidade confort√°vel (sem esfor√ßo respirat√≥rio). Mantenha postura ereta, ombros baixos. Ritmo recomendado: esfor√ßo 3‚Äì4/10 ‚Ä¢ Se sentir peso nas pernas, reduza ou finalize antes. ‚Ä¢ Vers√£o leve: 5 minutos de caminhada MUITO leve (ou apenas alongar se estiver sem energia)",equipamento:"Esteira",energia:"alta",contexto:"casa",categoria:"cardio"},
        
        {id:"d1_3",nome:"Ponte",instrucao:"Deite-se de barriga para cima, joelhos dobrados e p√©s paralelos. Ative o abd√¥men levemente. Ao expirar, eleve o quadril articulando a coluna v√©rtebra por v√©rtebra. Segure 1‚Äì2 s no topo. Inspire descendo devagar. ‚Ä¢ 6‚Äì10 repeti√ß√µes. ‚Ä¢ Varia√ß√£o (boa energia): ponte com eleva√ß√£o de calcanhares ou eleva√ß√£o alternada de pernas. ‚Ä¢ Benef√≠cios: ativa gl√∫teos + core e reduz rigidez lombar.",equipamento:"Tapete",energia:"alta",contexto:"casa",categoria:"mobilidade"},
        
        {id:"d1_4",nome:"Agachamento com bola na parede.",instrucao:"SFique de costas para a parede com a bola entre a lombar e a parede. P√©s afastados √† frente do corpo. Ao expirar, des√ßa deslizando pela bola at√© um √¢ngulo confort√°vel (45¬∞‚Äì60¬∞). Suba inspirando. ‚Ä¢ 6‚Äì10 repeti√ß√µes ‚Ä¢ Benef√≠cios: fortalece quadr√≠ceps sem impacto",equipamento:"Bola",energia:"alta",contexto:"casa",categoria:"forca"},
        {id:"d1_5",nome:"Subida no step.",instrucao:"SFP√© direito no step ‚Üí suba pressionando o calcanhar ‚Üí traga o outro p√© ‚Üí des√ßa devagar. ‚Ä¢ 8 repeti√ß√µes cada lado. ‚Ä¢ Use apoio lateral se precisar. ‚Ä¢ Benef√≠cios: for√ßa funcional e equil√≠brio.",equipamento:"Step",energia:"alta",contexto:"casa",categoria:"forca"},
       
        // Casa / baixa
        {id:"d1_6",nome:"Esteira Leve",instrucao:"Vers√£o leve: 5 minutos de caminhada MUITO leve (ou apenas alongar se estiver sem energia)",equipamento:"Esteira",energia:"baixa",contexto:"casa",categoria:"cardio"},
        {id:"d1_7",nome:"Aquecimento e Respira√ß√£o",instrucao:"Sente-se ou deite-se confortavelmente. Inspire pelo nariz expandindo costelas e abd√¥men; expire pela boca esvaziando o abd√¥men. ‚Ä¢ Ombros: c√≠rculos lentos para frente e para tr√°s ‚Ä¢ Pesco√ßo: movimentos suaves de cima/baixo e direita/esquerda, sem for√ßar ‚Ä¢ Tornozelos: c√≠rculos para ativar circula√ß√£o ‚Ä¢ Benef√≠cio: reduz rigidez e prepara a musculatura",equipamento:"Sem equipamento ",energia:"baixa",contexto:"casa",categoria:"respira√ß√£o"},
        {id:"d1_8",nome:"Ponte Simples",instrucao:"Deite-se de barriga para cima, joelhos dobrados e p√©s paralelos. Ative o abd√¥men levemente. Ao expirar, eleve o quadril articulando a coluna v√©rtebra por v√©rtebra. Segure 1‚Äì2 s no topo. Inspire descendo devagar. ‚Ä¢ 6‚Äì10 repeti√ß√µes. ‚Ä¢ Benef√≠cios: ativa gl√∫teos + core e reduz rigidez lombar.",equipamento:"Tapete",energia:"baixa",contexto:"casa",categoria:"mobilidade"},
       
        // Casa dos pais
        {id:"d1_pais_1",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d1_pais_2",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d1_pais_3",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d1_viagem_1",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d1_viagem_2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
         {id:"d1_viagem_3",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d1_viagem_along_4",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        
        
     
      ],
      2: [
        // Casa / alta
        {id:"d2_1",nome:"Alongamento da coluna",instrucao:"Sente-se com pernas estendidas (ou flexionadas). Inspire crescendo a coluna; expire desenrolando v√©rtebra por v√©rtebra. ‚Ä¢ 3‚Äì5 repeti√ß√µes. ‚Ä¢ Benef√≠cios: solta cadeia posterior e reduz rigidez matinal",equipamento:"Tapete",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d2_2",nome:"Alongamento lateral - Sereia",instrucao:"Sente-se com pernas dobradas para um lado. Incline o tronco lateralmente. Eleve o bra√ßo oposto. Respire 15‚Äì20 s. ‚Ä¢ Benef√≠cios: alivia laterais do tronco e lombar.",equipamento:"Tapete",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d2_3",nome:"Gato‚ÄìVaca ",instrucao:"Em quatro apoios: inspire arqueando a lombar (Vaca); expire arredondando a coluna (Gato). ‚Ä¢ 8‚Äì10 ciclos. ‚Ä¢ Benef√≠cios: mobiliza coluna e alivia tens√£o.",equipamento:"Tapete",energia:"alta",contexto:"casa",categoria:"Mobilidade"},
        {id:"d2_4",nome:"Alongamento posterior com faixa",instrucao:"Deite-se e passe a faixa no p√©. Eleve a perna at√© sentir alongar. ‚Ä¢ 20‚Äì30 s cada lado. ‚Ä¢ Benef√≠cios: reduz tens√£o lombar e posterior.",equipamento:"Faixa",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d2_5",nome:"Relaxamento com bola",instrucao:"Op√ß√£o 1: pernas apoiadas na bola. Op√ß√£o 2: costas apoiadas na bola. ‚Ä¢ Respire profundamente por 1‚Äì2 min. ‚Ä¢ Libera tens√£o e abre o peito.",equipamento:"Bola",energia:"alta",contexto:"casa",categoria:"Recupera√ß√£o"},
        {id:"d2_9",nome:"Alongamento posterior com faixa",instrucao:"Deite-se e passe a faixa no p√©. Eleve a perna at√© sentir alongar. ‚Ä¢ 20‚Äì30 s cada lado. ‚Ä¢ Benef√≠cios: reduz tens√£o lombar e posterior.",equipamento:"2 alongamentos √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        
        // Casa / baixa
        {id:"d2_6",nome:"Respira√ß√£o",instrucao:"Foque em 2 minutos de respira√ß√£o tranquila.",equipamento:"",energia:"baixa",contexto:"casa",categoria:"Respira√ß√£o"},
        
        {id:"d2_7",nome:"Alongamento da coluna",instrucao:"Sente-se com pernas estendidas (ou flexionadas). Inspire crescendo a coluna; expire desenrolando v√©rtebra por v√©rtebra. ‚Ä¢ 3‚Äì5 repeti√ß√µes. ‚Ä¢ Benef√≠cios: solta cadeia posterior e reduz rigidez matinal",equipamento:"2 alongamentos √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d2_8",nome:"Alongamento lateral - Sereia",instrucao:"Sente-se com pernas dobradas para um lado. Incline o tronco lateralmente. Eleve o bra√ßo oposto. Respire 15‚Äì20 s. ‚Ä¢ Benef√≠cios: alivia laterais do tronco e lombar.",equipamento:"2 alongamentos √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d2_9",nome:"Alongamento posterior com faixa",instrucao:"Deite-se e passe a faixa no p√©. Eleve a perna at√© sentir alongar. ‚Ä¢ 20‚Äì30 s cada lado. ‚Ä¢ Benef√≠cios: reduz tens√£o lombar e posterior.",equipamento:"2 alongamentos √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
       
      // Casa dos pais
        {id:"d2_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d2_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d2_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d2_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d2_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
         {id:"d2_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d2_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        
        
      ],
      3: [
        // Casa / alta
        {id:"d3_1",nome:"Esteira 5‚Äì10 min",instrucao:"Caminhada leve, coluna ereta. Esfor√ßo 2‚Äì3/10. ‚Ä¢ Vers√£o leve: 3‚Äì5 min ou eliminar.",equipamento:"Esteira",energia:"alta",contexto:"casa",categoria:"cardio"},
        {id:"d3_2",nome:"Remada",instrucao:"Sente-se no ch√£o com as pernas estendidas (ou flexionadas se ficar mais confort√°vel). Passe a faixa el√°stica pela sola dos p√©s e segure as pontas com as m√£os ‚Ä¢ Alternativa: prenda a faixa em algo fixo √† altura do peito e fique sentada ou em p√©. Coluna ereta, ombros longe das orelhas. Inspire preparando. Ao expirar, puxe os cotovelos para tr√°s, rente ao corpo, como se quisesse juntar as esc√°pulas. Mantenha punhos neutros e bra√ßos paralelos ao ch√£o. Inspire retornando lentamente √† posi√ß√£o inicial ‚Ä¢ Repita 8‚Äì12 vezes em ritmo controlado ‚Ä¢ Erros comuns a evitar: Encolher os ombros. Arredondar as costas. Puxar com for√ßa excessiva ‚Ä¢ Benef√≠cios: fortalece parte superior das costas, melhora postura e estabilidade escapular.",equipamento:"Faixa",energia:"alta",contexto:"casa",categoria:"For√ßa"},
        {id:"d3_3",nome:"B√≠ceps com 1‚Äì2 kg",instrucao:"Sente-se ou fique em p√© com coluna ereta.Segure um halter em cada m√£o, bra√ßos ao lado do corpo, palmas voltadas para frente. Inspire. Ao expirar, flexione os cotovelos, trazendo os pesos em dire√ß√£o aos ombros sem mover a parte superior dos bra√ßos. Inspire descendo lentamente, mantendo controle ‚Ä¢ Repita 8‚Äì10 vezes ‚Ä¢ Dicas: Cotovelos sempre colados ao tronco. Punhos neutros (n√£o dobre para tr√°s). Movimentos lentos, sem balan√ßo do corpo ‚Ä¢ Benef√≠cios: ativa b√≠ceps sem sobrecarregar ombros, ajuda em atividades di√°rias como carregar objetos leves.",equipamento:"Halteres",energia:"alta",contexto:"casa",categoria:"For√ßa"},
        {id:"d3_4",nome:"Compress√£o de aro",instrucao:"Sente-se em postura ereta. Segure o aro entre as m√£os, bra√ßos estendidos √† frente na altura do peito. Cotovelos levemente flexionados. Inspire. Ao expirar, pressione o aro, ativando o peitoral e m√∫sculos dos ombros. Mantenha a press√£o por 1‚Äì2 segundos. Inspire relaxando lentamente ‚Ä¢ Repita 8‚Äì12 vezes ‚Ä¢ Erros comuns: Elevar os ombros. Pressionar com for√ßa excessiva (evite tremer). Empurrar o pesco√ßo para frente ‚Ä¢ Benef√≠cios: fortalece peito, estabiliza ombros e melhora consci√™ncia postural.",equipamento:"Aro",energia:"alta",contexto:"casa",categoria:"For√ßa"},
        {id:"d3_5",nome:"Disco de equil√≠brio",instrucao:"Coloque o disco no ch√£o pr√≥ximo a uma parede, mesa ou cadeira firme. Suba no disco com um p√© de cada vez, mantendo joelhos levemente flexionados. Segure no apoio at√© sentir seguran√ßa. Quando estiver est√°vel, solte o apoio somente se se sentir confiante. Mantendo abd√¥men levemente ativado, tente permanecer est√°vel por 20‚Äì30 segundos. Des√ßa devagar segurando no apoio ‚Ä¢ Varia√ß√£o mais leve: Fique apenas com um p√© no disco e outro no ch√£o. Ou sente-se sobre o disco para ativar o core de forma mais suave ‚Ä¢ Benef√≠cios: melhora equil√≠brio, propriocep√ß√£o e estabilidade das articula√ß√µes.",equipamento:"Disco de Equil√≠brio",energia:"alta",contexto:"casa",categoria:"Equil√≠brio"},
        
        // Casa / baixa
        {id:"d3_6",nome:"Caminhada leve 3‚Äì5 min",instrucao:"Caminhar 3‚Äì5 min OU eliminar a esteira se houver dor/tontura/fadiga forte.",equipamento:"Esteira",energia:"baixa",contexto:"casa",categoria:"cardio"},
        {id:"d3_7",nome:"Remada",instrucao:"Sente-se no ch√£o com as pernas estendidas (ou flexionadas se ficar mais confort√°vel). Passe a faixa el√°stica pela sola dos p√©s e segure as pontas com as m√£os ‚Ä¢ Alternativa: prenda a faixa em algo fixo √† altura do peito e fique sentada ou em p√©. Coluna ereta, ombros longe das orelhas. Inspire preparando. Ao expirar, puxe os cotovelos para tr√°s, rente ao corpo, como se quisesse juntar as esc√°pulas. Mantenha punhos neutros e bra√ßos paralelos ao ch√£o. Inspire retornando lentamente √† posi√ß√£o inicial ‚Ä¢ Repita 8‚Äì12 vezes em ritmo controlado ‚Ä¢ Erros comuns a evitar: Encolher os ombros. Arredondar as costas. Puxar com for√ßa excessiva ‚Ä¢ Benef√≠cios: fortalece parte superior das costas, melhora postura e estabilidade escapular.",equipamento:"Faixa",energia:"baixa",contexto:"casa",categoria:"For√ßa"},
        {id:"d3_8",nome:"Compress√£o de aro",instrucao:"Sente-se em postura ereta. Segure o aro entre as m√£os, bra√ßos estendidos √† frente na altura do peito. Cotovelos levemente flexionados. Inspire. Ao expirar, pressione o aro, ativando o peitoral e m√∫sculos dos ombros. Mantenha a press√£o por 1‚Äì2 segundos. Inspire relaxando lentamente ‚Ä¢ Repita 8‚Äì12 vezes ‚Ä¢ Erros comuns: Elevar os ombros. Pressionar com for√ßa excessiva (evite tremer). Empurrar o pesco√ßo para frente ‚Ä¢ Benef√≠cios: fortalece peito, estabiliza ombros e melhora consci√™ncia postural.",equipamento:"Aro",energia:"baixa",contexto:"casa",categoria:"For√ßa"},
       
        // Casa dos pais
        {id:"d3_pais_1",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d3_pais_2",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d3_pais_3",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d3_viagem_1",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d3_viagem_2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
         {id:"d3_viagem_3",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d3_viagem_4",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        
        
      ],
      4: [
        // Casa / alta
        {id:"d4_1",nome:"1. Alongamento da Coluna",instrucao:"Sente-se com pernas estendidas (ou levemente flexionadas). Inspire crescendo a coluna. Ao expirar, flexione o tronco para frente, desenrolando a coluna. Volte devagar inspirando. ‚Ä¢ Repita 3‚Äì5 vezes. ‚Ä¢ Objetivo: soltar toda a cadeia posterior e reduzir a rigidez da lombar.",equipamento:"Alongamentos completos (escolha 3 a 5)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d4_2",nome:"2. Alongamento Lateral ‚Äì Sereia",instrucao:"Sente-se com pernas dobradas para um lado. Eleve o bra√ßo oposto √†s pernas. Incline o tronco lateralmente at√© sentir alongar costelas e cintura. ‚Ä¢ Respire 15‚Äì20 segundos. Repita para o outro lado. ‚Ä¢ Objetivo: aliviar tens√£o de tronco, obl√≠quos e regi√£o costal.",equipamento:"Alongamentos completos (escolha 3 a 5)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d4_3",nome:"3. Alongamento do Posterior",instrucao:"Deite-se de barriga para cima ‚Ä¢ Passe a faixa no p√© direito ‚Ä¢ Estenda a perna para cima e puxe suavemente at√© sentir alongar ‚Ä¢ Segure 20‚Äì25 s ‚Ä¢ Repita com a outra perna ‚Ä¢ Objetivo: soltar posteriores e diminuir tens√£o lombar.",equipamento:"Alongamentos completos (escolha 3 a 5)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d4_4",nome:"4. Gato‚ÄìVaca",instrucao:"Em quatro apoios, m√£os sob ombros. Inspire arqueando lombar (vaca) ‚Ä¢ Expire arredondando coluna (gato). ‚Ä¢ Repita 8‚Äì10 ciclos lentos. ‚Ä¢ Objetivo: lubrificar articula√ß√µes da coluna e aliviar dores de tens√£o.",equipamento:"Alongamentos completos (escolha 3 a 5)",energia:"alta",contexto:"casa",categoria:"Mobilidade"},
        {id:"d4_5",nome:"5. Alongamento de Peitoral na Parede",instrucao:"Apoie a palma da m√£o na parede, bra√ßo estendido ‚Ä¢ Gire o tronco suavemente para longe da parede ‚Ä¢ Segure 15‚Äì20 s ‚Ä¢ Troque o lado.",equipamento:"Alongamentos completos (escolha 3 a 5)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d4_6",nome:"6. Alongamento de Pesco√ßo",instrucao:"Incline a cabe√ßa para o lado, aproximando a orelha do ombro ‚Ä¢ Respire 10‚Äì15 s ‚Ä¢ Troque o lado ‚Ä¢ Depois, leve o queixo ao peito por 10‚Äì15 s ‚Ä¢  Objetivo: aliviar dor cervical, muito comum em dias de fadiga.",equipamento:"Alongamentos completos (escolha 3 a 5)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
         {id:"d4_7",nome:"1. Pernas apoiadas na bola",instrucao:"Deite-se de barriga para cima ‚Ä¢ Apoie as panturrilhas sobre a bola ‚Ä¢ Bra√ßos ao lado do corpo, respira√ß√£o profunda ‚Ä¢ Benef√≠cio: relaxa a lombar e reduz press√£o nas pernas.",equipamento:"Relaxamento com bola escolha 1 op√ß√£o",energia:"alta",contexto:"casa",categoria:"Alongamento"},
         {id:"d4_8",nome:"2. Costas apoiadas sobre a bola",instrucao:"Sente-se na bola ‚Ä¢ Caminhe com os p√©s para frente at√© que a parte m√©dia das costas esteja apoiada ‚Ä¢ Abra os bra√ßos para os lados, relaxe a cabe√ßa ‚Ä¢ Respire lentamente ‚Ä¢ Benef√≠cio: alonga peitoral, solta ombros e relaxa toda a coluna anterior.",equipamento:"Relaxamento com bola escolha 1 op√ß√£o",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        
        // Casa / baixa
        {id:"d4_9",nome:"Respira√ß√£o",instrucao:"Sente-se ou deite-se confortavelmente. Inspire pelo nariz, expandindo abd√¥men e costelas. Expire pela boca lentamente, soltando ombros e pesco√ßo. ‚Ä¢ Repita em ritmo suave ‚Ä¢  Benef√≠cios: reduz cortisol, diminui tens√£o muscular e prepara o corpo para alongar.",equipamento:"Sem equipamento",energia:"baixa",contexto:"casa",categoria:"Respira√ß√£o"},
        {id:"d4_10",nome:"1. Alongamento da Coluna",instrucao:"Sente-se com pernas estendidas (ou levemente flexionadas). Inspire crescendo a coluna. Ao expirar, flexione o tronco para frente, desenrolando a coluna. Volte devagar inspirando. ‚Ä¢ Repita 3‚Äì5 vezes. ‚Ä¢ Objetivo: soltar toda a cadeia posterior e reduzir a rigidez da lombar.",equipamento:"2 alongamentos suaves √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d4_11",nome:"2. Alongamento Lateral ‚Äì Sereia",instrucao:"Sente-se com pernas dobradas para um lado. Eleve o bra√ßo oposto √†s pernas. Incline o tronco lateralmente at√© sentir alongar costelas e cintura. ‚Ä¢ Respire 15‚Äì20 segundos. Repita para o outro lado. ‚Ä¢ Objetivo: aliviar tens√£o de tronco, obl√≠quos e regi√£o costal.",equipamento:"2 alongamentos suaves √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d4_12",nome:"3. Alongamento do Posterior",instrucao:"Deite-se de barriga para cima ‚Ä¢ Passe a faixa no p√© direito ‚Ä¢ Estenda a perna para cima e puxe suavemente at√© sentir alongar ‚Ä¢ Segure 20‚Äì25 s ‚Ä¢ Repita com a outra perna ‚Ä¢ Objetivo: soltar posteriores e diminuir tens√£o lombar.",equipamento:"2 alongamentos suaves √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d4_13",nome:"4. Gato‚ÄìVaca",instrucao:"Em quatro apoios, m√£os sob ombros. Inspire arqueando lombar (vaca) ‚Ä¢ Expire arredondando coluna (gato). ‚Ä¢ Repita 8‚Äì10 ciclos lentos. ‚Ä¢ Objetivo: lubrificar articula√ß√µes da coluna e aliviar dores de tens√£o.",equipamento:"2 alongamentos suaves √† escolha",energia:"baixa",contexto:"casa",categoria:"Mobilidade"},
        {id:"d4_14",nome:"5. Alongamento de Peitoral na Parede",instrucao:"Apoie a palma da m√£o na parede, bra√ßo estendido ‚Ä¢ Gire o tronco suavemente para longe da parede ‚Ä¢ Segure 15‚Äì20 s ‚Ä¢ Troque o lado.",equipamento:"2 alongamentos suaves √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d4_15",nome:"6. Alongamento de Pesco√ßo",instrucao:"Incline a cabe√ßa para o lado, aproximando a orelha do ombro ‚Ä¢ Respire 10‚Äì15 s ‚Ä¢ Troque o lado ‚Ä¢ Depois, leve o queixo ao peito por 10‚Äì15 s ‚Ä¢  Objetivo: aliviar dor cervical, muito comum em dias de fadiga.",equipamento:"2 alongamentos suaves √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
       
       // Casa dos pais
        {id:"d4_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d4_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d4_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d4_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d4_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        {id:"d4_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d4_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
        
       
      ],
      5: [
        // Casa / alta
        {id:"d5_1",nome:"Esteira 10‚Äì15 min",instrucao:"Ritmo confort√°vel, sem esfor√ßo respirat√≥rio ‚Ä¢ Esfor√ßo recomendado: 3/10 ‚Ä¢ Mantenha passos curtos e postura ereta ‚Ä¢ Se sentir peso nas pernas, finalize antes. ‚úî Vers√£o leve: Caminhar 5 minutos OU Pular a esteira e fazer apenas alongamentos.",equipamento:"Esteira",energia:"alta",contexto:"casa",categoria:"cardio"},
        {id:"d5_2",nome:"Ponte",instrucao:"Deite-se de barriga para cima, joelhos dobrados e p√©s paralelos no ch√£o. Ative o abd√¥men levemente (umbigo ‚Äúpara dentro‚Äù). Inspire preparando. Ao expirar, eleve o quadril articulando a coluna v√©rtebra por v√©rtebra. Pare quando formar uma linha ombros‚Äìjoelhos. Segure 1‚Äì2 segundos ativando gl√∫teos. Inspire descendo devagar, reconstruindo a coluna no ch√£o ‚Ä¢ Repita 6‚Äì10 vezes ‚Ä¢ Varia√ß√£o opcional (se estiver com boa energia): Elevar uma perna por vez no topo da ponte. MANTER quadril est√°vel √© mais importante que subir alto. Se a lombar incomodar, volte para a ponte simples ‚Ä¢ Benef√≠cios: ativa gl√∫teos + core e reduz rigidez lombar.",equipamento:"Tapete",energia:"alta",contexto:"casa",categoria:"mobilidade"},
        {id:"d5_3",nome:"1. Abdu√ß√£o de quadril ",instrucao:"Mini band acima dos joelhos ‚Ä¢ Deitada de lado, pernas flexionadas. Ative o abd√¥men. Inspire. Ao expirar, abra o joelho superior contra a resist√™ncia da mini band. Mantenha os p√©s juntos. Des√ßa devagar ‚Ä¢ Repita 8‚Äì12 vezes cada lado ‚Ä¢ Se fizer em p√©: Mantenha-se apoiada na parede. Afaste a perna lateralmente devagar.",equipamento:"Mini Band escolha 1 ou 2",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d5_4",nome:"2. Marcha no lugar ",instrucao:"Mini band nos tornozelos ‚Ä¢ Fique em p√© com joelhos levemente flexionados. Puxe o abd√¥men para dentro. Eleve o p√© direito 10 cm do ch√£o e volte. Eleve o p√© esquerdo ‚Ä¢ Fa√ßa 10‚Äì20 marchas alternadas ‚Ä¢ Objetivo: ativar gl√∫teos e estabilizar quadris sem impacto.",equipamento:"Mini Band escolha 1 ou 2",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d5_5",nome:"3. Caminhada lateral ",instrucao:"Mini band acima dos joelhos OU tornozelos ‚Ä¢ Flexione levemente os joelhos (semi-agachamento). D√™ um passo curto para a direita, depois junte o outro p√©. Ande 6‚Äì8 passos para a direita, depois para a esquerda ‚Ä¢ Fa√ßa somente se estiver com energia m√©dia/alta.",equipamento:"Mini Band escolha 1 ou 2",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        
        
        // Casa / baixa
        {id:"d5_6",nome:"Respira√ß√£o",instrucao:"Sente-se ou deite-se confortavelmente. Inspire pelo nariz, expandindo abd√¥men e costelas. Expire pela boca lentamente, soltando ombros e pesco√ßo. ‚Ä¢ Repita em ritmo suave ‚Ä¢  Benef√≠cios: reduz cortisol, diminui tens√£o muscular e prepara o corpo para alongar.",equipamento:"Sem equipamento",energia:"baixa",contexto:"casa",categoria:"respira√ß√£o"},
        {id:"d5_7",nome:"Ponte Simples",instrucao:"Deite-se de barriga para cima, joelhos dobrados e p√©s paralelos no ch√£o. Ative o abd√¥men levemente (umbigo ‚Äúpara dentro‚Äù). Inspire preparando. Ao expirar, eleve o quadril articulando a coluna v√©rtebra por v√©rtebra. Pare quando formar uma linha ombros‚Äìjoelhos. Segure 1‚Äì2 segundos ativando gl√∫teos. Inspire descendo devagar, reconstruindo a coluna no ch√£o ‚Ä¢ Repita 6‚Äì10 vezes ‚Ä¢ Benef√≠cios: ativa gl√∫teos + core e reduz rigidez lombar.",equipamento:"Tapete",energia:"baixa",contexto:"casa",categoria:"mobilidade"},
        {id:"d5_8",nome:"Alongamento Posterior com fixa",instrucao:"Deite-se de barriga para cima ‚Ä¢ Passe a faixa no p√© direito ‚Ä¢ Estenda a perna para cima e puxe suavemente at√© sentir alongar ‚Ä¢ Segure 20‚Äì25 s ‚Ä¢ Repita com a outra perna ‚Ä¢ Objetivo: soltar posteriores e diminuir tens√£o lombar.",equipamento:"Alongamento leve (posterior ou coluna)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d5_9",nome:"Alongamento de Coluna",instrucao:"Sente-se com pernas estendidas (ou levemente flexionadas). Inspire crescendo a coluna. Ao expirar, flexione o tronco para frente, desenrolando a coluna. Volte devagar inspirando. ‚Ä¢ Repita 3‚Äì5 vezes. ‚Ä¢ Objetivo: soltar toda a cadeia posterior e reduzir a rigidez da lombar.",equipamento:"Alongamento leve (posterior ou coluna)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
       
        // Casa dos pais
        {id:"d5_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d5_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d5_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d5_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d5_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        {id:"d5_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d5_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
        
        
      ],
      6: [
        // Casa / alta
        {id:"d6_1",nome:"Esteira leve 5‚Äì10 min",instrucao:"Caminhada leve, ritmo calmo ‚Ä¢  Esfor√ßo m√°ximo recomendado: 2‚Äì3/10 ‚Ä¢ Respira√ß√£o tranquila.",equipamento:"Esteira",energia:"alta",contexto:"casa",categoria:"cardio"},
        {id:"d6_2",nome:"Remada",instrucao:"Sente-se com pernas estendidas OU flexionadas (como for mais confort√°vel) ‚Ä¢ Passe a faixa nos p√©s e segure as pontas ‚Ä¢ Coluna ereta, ombros abaixados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, puxe os cotovelos para tr√°s, aproximando as esc√°pulas ‚Ä¢ Mantenha os cotovelos pr√≥ximos ao corpo ‚Ä¢ Inspire retornando devagar ‚Ä¢ Repita 8‚Äì12 vezes ‚Ä¢ Erros a evitar: Ombros encolhidos ‚Ä¢ Tranco na faixa ‚Ä¢ Curvar as costas ‚Ä¢  Benef√≠cios: fortalece dorsais, melhora postura e reduz dor entre omoplatas.",equipamento:"Faixa",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d6_3",nome:"Eleva√ß√£o lateral leve",instrucao:"Em p√© ou sentada, coluna alinhada. Segure um halter em cada m√£o, bra√ßos ao lado do corpo. Inspire. Ao expirar, eleve os bra√ßos lateralmente at√© a altura dos ombros (ou menos, se houver desconforto). Cotovelos levemente flexionados. Inspire descendo devagar ‚Ä¢  Repita 6‚Äì10 vezes ‚Ä¢  Dicas: Mantenha ombros longe das orelhas. N√£o force amplitude ‚Äî pare onde for confort√°vel. Se estiver com dor nos ombros, reduza a carga ou elimine o exerc√≠cio ‚Ä¢  Benef√≠cios: fortalece deltoides, melhora estabilidade e ajuda em gestos di√°rios (pegar objetos, arrumar cabelo).",equipamento:"Halteres leves (1‚Äì2 kg)",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d6_4",nome:"Compress√£o de aro",instrucao:"Sente-se com coluna ereta ‚Ä¢ Segure o aro com as m√£os na altura do peito ‚Ä¢ Cotovelos suavemente flexionados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, pressione o aro com intensidade leve a moderada ‚Ä¢ Segure 1‚Äì2 segundos ‚Ä¢ Inspire relaxando devagar ‚Ä¢ Repita 8‚Äì10 vezes ‚Ä¢ Erros a evitar: For√ßa excessiva (tremor) ‚Ä¢ Empurrar a cabe√ßa para frente ‚Ä¢ Ombros elevados ‚Ä¢ Benef√≠cios: ativa peitoral, tr√≠ceps e estabilizadores dos ombros sem impacto.",equipamento:"Aro",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        
        // Casa / baixa
        {id:"d6_5",nome:"Alongamento de Pesco√ßo",instrucao:"Incline a cabe√ßa para a direita, relaxando o ombro esquerdo ‚Ä¢ Respire por 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Em seguida, leve o queixo ao peito por 15 s ‚Ä¢ Objetivo: reduzir tens√£o cervical ‚Äî muito comum em quem tem fibromialgia.",equipamento:"Alongamento de pesco√ßo ou peitoral ",energia:"baixa",contexto:"casa",categoria:"for√ßa"},
        {id:"d6_6",nome:"Alongamento de Peitoral",instrucao:"Fique ao lado de uma parede ‚Ä¢ Apoie a m√£o direita na parede, bra√ßo estendido na altura do ombro ‚Ä¢ Gire suavemente o tronco para a esquerda at√© sentir alongar ‚Ä¢ Segure 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: abrir peito, melhorar postura, aliviar ombros.",equipamento:"Alongamento de pesco√ßo ou peitoral ",energia:"baixa",contexto:"casa",categoria:"for√ßa"},
        {id:"d6_7",nome:"Ramada",instrucao:"Sente-se com pernas estendidas OU flexionadas (como for mais confort√°vel) ‚Ä¢ Passe a faixa nos p√©s e segure as pontas ‚Ä¢ Coluna ereta, ombros abaixados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, puxe os cotovelos para tr√°s, aproximando as esc√°pulas ‚Ä¢ Mantenha os cotovelos pr√≥ximos ao corpo ‚Ä¢Inspire retornando devagar ‚Ä¢ Repita 8‚Äì12 vezes ‚Ä¢ Erros a evitar: Ombros encolhidos ‚Ä¢ Tranco na faixa ‚Ä¢ Curvar as costas ‚Ä¢ Benef√≠cios: fortalece dorsais, melhora postura e reduz dor entre omoplatas.",equipamento:"Alongamento (remada ou aro)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
         {id:"d6_8",nome:"Compress√£o de Aro",instrucao:"Sente-se com coluna ereta ‚Ä¢ Segure o aro com as m√£os na altura do peito ‚Ä¢ Cotovelos suavemente flexionados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, pressione o aro com intensidade leve a moderada ‚Ä¢ Segure 1‚Äì2 segundos ‚Ä¢ Inspire relaxando devagar ‚Ä¢ Repita 8‚Äì10 vezes ‚Ä¢ Erros a evitar: For√ßa excessiva (tremor) ‚Ä¢ Empurrar a cabe√ßa para frente ‚Ä¢ Ombros elevados ‚Ä¢ Benef√≠cios: ativa peitoral, tr√≠ceps e estabilizadores dos ombros sem impacto.",equipamento:"Alongamento (remada ou aro)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
       
        // Casa dos pais
        {id:"d6_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d6_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d6_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d6_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d6_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        {id:"d6_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d6_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
        
       
      ],
      7: [
        // Casa / alta
        {id:"d7_1",nome:"1. Alongamento da Coluna",instrucao:"Sente-se com pernas estendidas ‚Ä¢ Inspire crescendo a coluna ‚Ä¢ Ao expirar, flexione o tronco para frente desenrolando a coluna ‚Ä¢ Volte devagar inspirando ‚Ä¢ Repita 3‚Äì5 vezes ‚Ä¢ Objetivo: soltar coluna, lombar e cadeia posterior.",equipamento:"Sess√£o de alongamentos (escolha 4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d7_2",nome:"2. Alongamento Lateral",instrucao:"Sente-se com pernas dobradas para um lado ‚Ä¢ Eleve o bra√ßo oposto ‚Ä¢ Incline o tronco suavemente para o lado das pernas ‚Ä¢ Respire 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: aliviar tens√£o de tronco, cintura e regi√£o intercostal.",equipamento:"Sess√£o de alongamentos (escolha 4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d7_3",nome:"3. Alongamento do Posterior com Faixa",instrucao:"(Opcional ‚Äî voc√™ pode fazer sem faixa tamb√©m) ‚Ä¢ Deite-se de barriga para cima ‚Ä¢ Passe a faixa no p√© direito ‚Ä¢ Estenda a perna para cima ‚Ä¢ Puxe suavemente at√© sentir alongar ‚Ä¢ Segure 20‚Äì25 s ‚Ä¢ Troque a perna ‚Ä¢ Objetivo: reduzir rigidez dos posteriores e aliviar lombar.",equipamento:"Sess√£o de alongamentos (escolha 4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d7_4",nome:"4. Gato‚ÄìVaca",instrucao:"Em quatro apoios ‚Ä¢ Inspire arqueando lombar (vaca) ‚Ä¢ Expire arredondando coluna (gato) ‚Ä¢ Repita 8‚Äì10 ciclos bem lentos ‚Ä¢ Objetivo: liberar coluna, aliviar tens√µes e melhorar mobilidade di√°ria.",equipamento:"Sess√£o de alongamentos (escolha 4 a 6)",energia:"alta",contexto:"casa",categoria:"Mobilidade"},
        {id:"d7_5",nome:"5. Alongamento de Peitoral",instrucao:"Bra√ßo estendido na parede ‚Ä¢ Gire o tronco suavemente para longe ‚Ä¢ Segure 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: abrir peito, reduzir tens√£o cervical e dorsal.",equipamento:"Sess√£o de alongamentos (escolha 4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d7_6",nome:"6. Alongamento de Pesco√ßo ",instrucao:"Incline a cabe√ßa para a direita, segurando 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Em seguida, traga o queixo ao peito por 15 s ‚Ä¢ Objetivo: aliviar dores cervicais e tens√£o acumulada.",equipamento:"Sess√£o de alongamentos (escolha 4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
         {id:"d7_7",nome:"7. Alongamento de Quadril",instrucao:"Ajoelhe-se e sente nos calcanhares ‚Ä¢ Estenda bra√ßos √† frente e deite o tronco entre as coxas ‚Ä¢ Respire 20‚Äì30 s ‚Ä¢ Volte devagar ‚Ä¢ Objetivo: alongar lombar, quadris e soltar parte superior do corpo.",equipamento:"Sess√£o de alongamentos (escolha 4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
         {id:"d7_8",nome:"1. Rota√ß√µes de ombros",instrucao:"Em p√© ou sentada, coluna ereta, p√©s apoiados no ch√£o ‚Ä¢ Bra√ßos relaxados ao lado do corpo ‚Ä¢ Queixo paralelo ao ch√£o, olhar √† frente ‚Ä¢ Inspire pelo nariz ‚Ä¢ Ao expirar, leve os ombros suavemente para frente ‚Üí para cima ‚Üí para tr√°s ‚Üí para baixo, desenhando um c√≠rculo. ‚Ä¢ Inverta o sentido ‚Ä¢ 5 a 8 c√≠rculos para tr√°s + 5 a 8 para frente ‚Ä¢ Cuidados: Movimento lento, sem ‚Äútrancos‚Äù.",equipamento:"Mobilidade Leve (Inclua 1 ou 2)",energia:"alta",contexto:"casa",categoria:"Mobilidade"},
         {id:"d7_9",nome:"2. C√≠rculos de quadril",instrucao:"Em p√©, p√©s afastados na largura do quadril ‚Ä¢ Joelhos levemente destravados (n√£o deixe totalmente esticados) ‚Ä¢ M√£os apoiadas na cintura ou em uma cadeira/mesa √† frente, se precisar de apoio ‚Ä¢ Leve o quadril devagar: para a direita ‚Üí para frente ‚Üí para a esquerda ‚Üí para tr√°s, fechando o c√≠rculo ‚Ä¢ Mantenha o tronco relativamente est√°vel, sem jogar o peso para os joelhos ‚Ä¢ mude o sentido  ‚Ä¢ 5 a 8 c√≠rculos em um sentido + 5 a 8 no outro.",equipamento:"Mobilidade Leve (Inclua 1 ou 2)",energia:"alta",contexto:"casa",categoria:"Mobilidade"},
         {id:"d7_10",nome:"3. Mobilidade de tornozelos",instrucao:"‚úî Op√ß√£o 1: Sentada na cadeira, coluna ereta ‚Ä¢ P√©s apoiados no ch√£o ‚Ä¢ Eleve a ponta dos p√©s, mantendo os calcanhares no ch√£o ‚Ä¢ Volte a apoiar o p√© todo ‚Ä¢ Depois, eleve os calcanhares, deixando a ponta dos p√©s no ch√£o ‚Ä¢ Alterne ‚Äúponta sobe / calcanhar sobe‚Äù como se estivesse simulando uma marcha parada. ‚úî Op√ß√£o 2: Estenda uma perna √† frente (pode manter o calcanhar apoiado no ch√£o ou suspenso, conforme conforto) ‚Ä¢ Desenhe c√≠rculos com a ponta do p√©: devagar, em um sentido e depois no outro ‚Ä¢ Repita com a outra perna ‚Ä¢ 10 a 15 repeti√ß√µes.",equipamento:"Mobilidade Leve (Inclua 1 ou 2)",energia:"alta",contexto:"casa",categoria:"Mobilidade"},
         {id:"d7_11",nome:"4. Tor√ß√£o suave da coluna sentado",instrucao:"Sentada na cadeira, coluna ereta, p√©s bem apoiados no ch√£o ‚Ä¢ Mantenha o peso distribu√≠do igualmente nos dois lados do quadril. ‚Ä¢ Inspire crescendo a coluna (como se quisesse ‚Äúalongar‚Äù o topo da cabe√ßa para o teto) ‚Ä¢ Ao expirar, gire suavemente o tronco para a direita ‚Ä¢ Leve a m√£o esquerda em dire√ß√£o √† coxa direita ou √† lateral da cadeira ‚Ä¢ A m√£o direita pode apoiar no encosto ou na lateral da cadeira, sem ‚Äúpuxar‚Äù com for√ßa ‚Ä¢ Mantenha os ombros relaxados, longe das orelhas ‚Ä¢ Segure a posi√ß√£o por 3 a 5 respira√ß√µes suaves ‚Ä¢ Volte devagar ao centro ao inspirar ‚Ä¢ Repita para o outro lado ‚Ä¢ 1 a 2 repeti√ß√µes para cada lado ‚Ä¢ Sustentar 20 a 30 segundos (ou 3 a 5 respira√ß√µes) em cada lado, conforme toler√¢ncia ‚Ä¢ Objetivo: ‚Äúlubrificar‚Äù articula√ß√µes sem esfor√ßo.",equipamento:"Mobilidade Leve (Inclua 1 ou 2)",energia:"alta",contexto:"casa",categoria:"Mobilidade"},
         {id:"d7_12",nome:"Relaxamento Final (opcional)",instrucao:"Deite-se e apoie as pernas na bola OU Deite as costas sobre a bola com apoio dos p√©s ‚Ä¢ Respire profundamente 1‚Äì2 minutos.",equipamento:"Bola",energia:"alta",contexto:"casa",categoria:"Recupera√ß√£o"},
        
        // Casa / baixa
        {id:"d7_13",nome:"Respira√ß√£o suave",instrucao:"Sente-se ou deite-se em posi√ß√£o confort√°vel ‚Ä¢ Inspire pelo nariz por 3‚Äì4 segundos‚Ä¢ Expire pela boca devagar por 4‚Äì6 segundos ‚Ä¢ Deixe ombros, mand√≠bula e pesco√ßo relaxarem‚Ä¢ Continue at√© perceber o corpo ‚Äúdesligando‚Äù ‚Ä¢ Benef√≠cios: regula o sistema nervoso, reduz dor e rigidez t√≠pica da fibromialgia.",equipamento:"Sem equipamento",energia:"baixa",contexto:"casa",categoria:"respira√ß√£o"},
       
         {id:"d7_14",nome:"1. Alongamento da Coluna",instrucao:"Sente-se com pernas estendidas ‚Ä¢ Inspire crescendo a coluna ‚Ä¢ Ao expirar, flexione o tronco para frente desenrolando a coluna ‚Ä¢ Volte devagar inspirando ‚Ä¢ Repita 3‚Äì5 vezes ‚Ä¢ Objetivo: soltar coluna, lombar e cadeia posterior.",equipamento:"1 alongamento confort√°vel (√† escolha)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d7_15",nome:"2. Alongamento Lateral",instrucao:"Sente-se com pernas dobradas para um lado ‚Ä¢ Eleve o bra√ßo oposto ‚Ä¢ Incline o tronco suavemente para o lado das pernas ‚Ä¢ Respire 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: aliviar tens√£o de tronco, cintura e regi√£o intercostal.",equipamento:"1 alongamento confort√°vel (√† escolha)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d7_16",nome:"3. Alongamento do Posterior com Faixa",instrucao:"(Opcional ‚Äî voc√™ pode fazer sem faixa tamb√©m) ‚Ä¢ Deite-se de barriga para cima ‚Ä¢ Passe a faixa no p√© direito ‚Ä¢ Estenda a perna para cima ‚Ä¢ Puxe suavemente at√© sentir alongar ‚Ä¢ Segure 20‚Äì25 s ‚Ä¢ Troque a perna ‚Ä¢ Objetivo: reduzir rigidez dos posteriores e aliviar lombar.",equipamento:"1 alongamento confort√°vel (√† escolha)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d7_17",nome:"4. Gato‚ÄìVaca",instrucao:"Em quatro apoios ‚Ä¢ Inspire arqueando lombar (vaca) ‚Ä¢ Expire arredondando coluna (gato) ‚Ä¢ Repita 8‚Äì10 ciclos bem lentos ‚Ä¢ Objetivo: liberar coluna, aliviar tens√µes e melhorar mobilidade di√°ria.",equipamento:"1 alongamento confort√°vel (√† escolha)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d7_18",nome:"5. Alongamento de Peitoral",instrucao:"Bra√ßo estendido na parede ‚Ä¢ Gire o tronco suavemente para longe ‚Ä¢ Segure 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: abrir peito, reduzir tens√£o cervical e dorsal.",equipamento:"1 alongamento confort√°vel (√† escolha)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d7_19",nome:"6. Alongamento de Pesco√ßo ",instrucao:"Incline a cabe√ßa para a direita, segurando 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Em seguida, traga o queixo ao peito por 15 s ‚Ä¢ Objetivo: aliviar dores cervicais e tens√£o acumulada.",equipamento:"1 alongamento confort√°vel (√† escolha)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
         {id:"d7_20",nome:"7. Alongamento de Quadril",instrucao:"Ajoelhe-se e sente nos calcanhares ‚Ä¢ Estenda bra√ßos √† frente e deite o tronco entre as coxas ‚Ä¢ Respire 20‚Äì30 s ‚Ä¢ Volte devagar ‚Ä¢ Objetivo: alongar lombar, quadris e soltar parte superior do corpo.",equipamento:"1 alongamento confort√°vel (√† escolha)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        
       
        // Casa dos pais
        {id:"d7_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d7_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d7_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d7_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d7_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        {id:"d7_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d7_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
        
      ],
      8: [
        // Casa / alta
        {id:"d8_1",nome:"Esteira 10‚Äì15 min ",instrucao:"Ritmo confort√°vel, sem esfor√ßo respirat√≥rio ‚Ä¢ Coluna ereta, olhar √† frente ‚Ä¢ Esfor√ßo recomendado: 3‚Äì4/10 ‚Ä¢ Se cansar, reduza velocidade ‚úî Vers√£o leve: Caminhar 5 minutos OU  eliminar e fazer apenas alongamento final.",equipamento:"Esteira",energia:"alta",contexto:"casa",categoria:"cardio"},
        {id:"d8_2",nome:"Step-up",instrucao:"Apoie o p√© direito inteiro no step ‚Ä¢ Pressione o calcanhar para elevar o corpo, subindo totalmente ‚Ä¢ Junte o p√© esquerdo no step ‚Ä¢ Des√ßa devagar com o p√© direito, depois o esquerdo ‚Ä¢ Repita 8 vezes cada perna iniciando alternadamente ‚Ä¢ Use a parede ou cadeira ao lado para seguran√ßa. ‚Ä¢ Dicas importantes:Mantenha coluna ereta ‚Ä¢ N√£o deixe o joelho entrar para dentro ‚Ä¢ Evite subir r√°pido ‚Äî movimento deve ser suave ‚Ä¢ Benef√≠cios: for√ßa de pernas, equil√≠brio e funcionalidade (escadas, inclina√ß√µes).",equipamento:"Step",energia:"alta",contexto:"casa",categoria:"Equilibrio"},
        {id:"d8_3",nome:"Ponte",instrucao:"Deite-se de barriga para cima com joelhos dobrados ‚Ä¢ Ative o abd√¥men suavemente ‚Ä¢ Inspire ‚Ä¢ Ao expirar, eleve o quadril articulando a coluna ‚Ä¢ Segure 1‚Äì2 segundos no topo ‚Ä¢ Des√ßa devagar desenrolando v√©rtebra por v√©rtebra ‚Ä¢ Repita 8‚Äì12 vezes. ‚úî Varia√ß√£o para energia mais alta: Fa√ßa ponte com eleva√ß√£o de calcanhares ‚Ä¢ Ou mantenha a ponte por 5 segundos ativando gl√∫teos. ‚úî Para energia baixa: Fa√ßa uma ponte mais baixa ‚Ä¢ Aumente a √™nfase no alongamento, n√£o na for√ßa.  ‚Ä¢ Benef√≠cios: ativa gl√∫teos, solta lombar, melhora estabilidade p√©lvica.",equipamento:"Tapete",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d8_4",nome:"Agachamento com bola",instrucao:"Coloque a bola entre a lombar e a parede ‚Ä¢ P√©s afastados √† frente do corpo (30‚Äì40 cm) ‚Ä¢ Inspire ‚Ä¢ Ao expirar, des√ßa deslizando pela bola at√© um √¢ngulo confort√°vel ‚Ä¢ Pare entre 45¬∞ e 60¬∞ ‚Äî sem for√ßar ‚Ä¢ Inspire subindo devagar mantendo controle ‚Ä¢ Repita 6‚Äì10 vezes. ‚Ä¢  Dicas: Peso no calcanhar ‚Ä¢ Joelhos alinhados √† ponta dos p√©s ‚Ä¢ Coluna neutra, sem arquear.  ‚Ä¢ Benef√≠cios: fortalece quadr√≠ceps sem impacto e com suporte.",equipamento:"Bola",energia:"alta",contexto:"casa",categoria:"For√ßa"},
        
        // Casa / baixa
        {id:"d8_5",nome:"Esteira (5 min OU s√≥ alongar) ",instrucao:"Caminhar 5 minutos OU  eliminar e fazer apenas alongamento final.",equipamento:"Esteira",energia:"baixa",contexto:"casa",categoria:"cardio"},
        {id:"d8_6",nome:"Respira√ß√£o e Mobilidade",instrucao:"Inspire profundamente expandindo as costelas ‚Ä¢ Expire devagar relaxando ombros ‚Ä¢ Fa√ßa c√≠rculos de ombros (10x) ‚Ä¢ Pesco√ßo: inclina√ß√µes leves e giros suaves ‚Ä¢ Tornozelos: c√≠rculos para ativar circula√ß√£o.",equipamento:"Sem equipamento",energia:"baixa",contexto:"casa",categoria:"Respira√ß√£o"},
        {id:"d8_7",nome:"Ponte Simples",instrucao:"Fa√ßa uma ponte mais baixa ‚Ä¢ Aumente a √™nfase no alongamento, n√£o na for√ßa.  ‚Ä¢ Benef√≠cios: ativa gl√∫teos, solta lombar, melhora estabilidade p√©lvica.",equipamento:"Tapete",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d8_8",nome:"Alongamento posterior com faixa",instrucao:"(Opcional ‚Äî voc√™ pode fazer sem faixa tamb√©m) ‚Ä¢ Deite-se de barriga para cima ‚Ä¢ Passe a faixa no p√© direito ‚Ä¢ Estenda a perna para cima ‚Ä¢ Puxe suavemente at√© sentir alongar ‚Ä¢ Segure 20‚Äì25 s ‚Ä¢ Troque a perna ‚Ä¢ Objetivo: reduzir rigidez dos posteriores e aliviar lombar.",equipamento:"Alongamento final (opcional)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d8_9",nome:"Tor√ß√£o sentada",instrucao:"Sentada na cadeira, coluna ereta, p√©s bem apoiados no ch√£o ‚Ä¢ Mantenha o peso distribu√≠do igualmente nos dois lados do quadril. ‚Ä¢ Inspire crescendo a coluna (como se quisesse ‚Äúalongar‚Äù o topo da cabe√ßa para o teto) ‚Ä¢ Ao expirar, gire suavemente o tronco para a direita ‚Ä¢ Leve a m√£o esquerda em dire√ß√£o √† coxa direita ou √† lateral da cadeira ‚Ä¢ A m√£o direita pode apoiar no encosto ou na lateral da cadeira, sem ‚Äúpuxar‚Äù com for√ßa ‚Ä¢ Mantenha os ombros relaxados, longe das orelhas ‚Ä¢ Segure a posi√ß√£o por 3 a 5 respira√ß√µes suaves ‚Ä¢ Volte devagar ao centro ao inspirar ‚Ä¢ Repita para o outro lado ‚Ä¢ 1 a 2 repeti√ß√µes para cada lado ‚Ä¢ Sustentar 20 a 30 segundos (ou 3 a 5 respira√ß√µes) em cada lado, conforme toler√¢ncia ‚Ä¢ Objetivo: ‚Äúlubrificar‚Äù articula√ß√µes sem esfor√ßo.",equipamento:"Alongamento final (opcional)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d8_10",nome:"Alongamento Laterial",instrucao:"Sente-se com pernas dobradas para um lado ‚Ä¢ Eleve o bra√ßo oposto ‚Ä¢ Incline o tronco suavemente para o lado das pernas ‚Ä¢ Respire 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: aliviar tens√£o de tronco, cintura e regi√£o intercostal.",equipamento:"Alongamento final (opcional)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
       
       // Casa dos pais
        {id:"d8_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d8_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d8_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d8_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d8_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        {id:"d8_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d8_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
        
      ],
      9: [
        // Casa / alta
        {id:"d9_1",nome:"Alongamento da Coluna",instrucao:"Sente-se com pernas estendidas ‚Ä¢ Inspire crescendo a coluna ‚Ä¢ Ao expirar, flexione o tronco para frente desenrolando a coluna ‚Ä¢ Volte devagar inspirando ‚Ä¢ Repita 3‚Äì5 vezes ‚Ä¢ Objetivo: soltar coluna, lombar e cadeia posterior.",equipamento:"Sem equipamento",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d9_2",nome:"Alongamento Lateral",instrucao:"Sente-se com pernas dobradas para um lado ‚Ä¢ Eleve o bra√ßo oposto ‚Ä¢ Incline o tronco suavemente para o lado das pernas ‚Ä¢ Respire 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: aliviar tens√£o de tronco, cintura e regi√£o intercostal.",equipamento:"Sem equipamento",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d9_3",nome:"Alongamento Posterior com Faixa",instrucao:"Deite-se de barriga para cima ‚Ä¢ Passe a faixa no p√© direito ‚Ä¢ Estenda a perna para cima e puxe suavemente at√© sentir alongar ‚Ä¢ Segure 20‚Äì25 s ‚Ä¢ Repita com a outra perna ‚Ä¢ Objetivo: soltar posteriores e diminuir tens√£o lombar.",equipamento:"Faixa",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d9_4",nome:"Gato‚ÄìVaca",instrucao:"Em quatro apoios ‚Ä¢ Inspire arqueando lombar (vaca) ‚Ä¢ Expire arredondando coluna (gato) ‚Ä¢ Repita 8‚Äì10 ciclos bem lentos ‚Ä¢ Objetivo: liberar coluna, aliviar tens√µes e melhorar mobilidade di√°ria.",equipamento:"Tapete",energia:"alta",contexto:"casa",categoria:"Mobilidade"},
        
        // Casa / baixa
        {id:"d9_5",nome:"Respira√ß√£o suave",instrucao:"Sente-se ou deite-se em posi√ß√£o confort√°vel ‚Ä¢ Inspire pelo nariz por 3‚Äì4 segundos‚Ä¢ Expire pela boca devagar por 4‚Äì6 segundos ‚Ä¢ Deixe ombros, mand√≠bula e pesco√ßo relaxarem‚Ä¢ Continue at√© perceber o corpo ‚Äúdesligando‚Äù ‚Ä¢ Benef√≠cios: regula o sistema nervoso, reduz dor e rigidez t√≠pica da fibromialgia.",equipamento:"Sem equipamento",energia:"baixa",contexto:"casa",categoria:"respira√ß√£o"},
        {id:"d9_6",nome:"Alongamento da Coluna",instrucao:"Sente-se com pernas estendidas ‚Ä¢ Inspire crescendo a coluna ‚Ä¢ Ao expirar, flexione o tronco para frente desenrolando a coluna ‚Ä¢ Volte devagar inspirando ‚Ä¢ Repita 3‚Äì5 vezes ‚Ä¢ Objetivo: soltar coluna, lombar e cadeia posterior.",equipamento:"2 alongamentos √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d9_7",nome:"Alongamento Lateral",instrucao:"Sente-se com pernas dobradas para um lado ‚Ä¢ Eleve o bra√ßo oposto ‚Ä¢ Incline o tronco suavemente para o lado das pernas ‚Ä¢ Respire 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: aliviar tens√£o de tronco, cintura e regi√£o intercostal.",equipamento:"2 alongamentos √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d9_8",nome:"Alongamento Posterior com Faixa",instrucao:"Deite-se de barriga para cima ‚Ä¢ Passe a faixa no p√© direito ‚Ä¢ Estenda a perna para cima e puxe suavemente at√© sentir alongar ‚Ä¢ Segure 20‚Äì25 s ‚Ä¢ Repita com a outra perna ‚Ä¢ Objetivo: soltar posteriores e diminuir tens√£o lombar.",equipamento:"2 alongamentos √† escolha",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
       
        // Casa dos pais
        {id:"d9_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d9_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d9_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d9_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d9_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        {id:"d9_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d9_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
       
      ],
      10: [
        // Casa / alta
        {id:"d10_1",nome:"Esteira leve ",instrucao:"Caminhada leve, ritmo calmo ‚Ä¢  Esfor√ßo m√°ximo recomendado: 2‚Äì3/10 ‚Ä¢ Respira√ß√£o tranquila.",equipamento:"Esteira",energia:"alta",contexto:"casa",categoria:"cardio"},
        {id:"d10_2",nome:"Remada",instrucao:"Sente-se com pernas estendidas OU flexionadas (como for mais confort√°vel) ‚Ä¢ Passe a faixa nos p√©s e segure as pontas ‚Ä¢ Coluna ereta, ombros abaixados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, puxe os cotovelos para tr√°s, aproximando as esc√°pulas ‚Ä¢ Mantenha os cotovelos pr√≥ximos ao corpo ‚Ä¢ Inspire retornando devagar ‚Ä¢ Repita 8‚Äì12 vezes ‚Ä¢ Erros a evitar: Ombros encolhidos ‚Ä¢ Tranco na faixa ‚Ä¢ Curvar as costas ‚Ä¢  Benef√≠cios: fortalece dorsais, melhora postura e reduz dor entre omoplatas.",equipamento:"Faixa",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d10_3",nome:"B√≠ceps com 1‚Äì2 kg",instrucao:"Sente-se ou fique em p√© com coluna ereta.Segure um halter em cada m√£o, bra√ßos ao lado do corpo, palmas voltadas para frente. Inspire. Ao expirar, flexione os cotovelos, trazendo os pesos em dire√ß√£o aos ombros sem mover a parte superior dos bra√ßos. Inspire descendo lentamente, mantendo controle ‚Ä¢ Repita 8‚Äì10 vezes ‚Ä¢ Dicas: Cotovelos sempre colados ao tronco. Punhos neutros (n√£o dobre para tr√°s). Movimentos lentos, sem balan√ßo do corpo ‚Ä¢ Benef√≠cios: ativa b√≠ceps sem sobrecarregar ombros, ajuda em atividades di√°rias como carregar objetos leves.",equipamento:"B√≠ceps ou aro",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d10_4",nome:"Compress√£o de Aro",instrucao:"Sente-se com coluna ereta ‚Ä¢ Segure o aro com as m√£os na altura do peito ‚Ä¢ Cotovelos suavemente flexionados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, pressione o aro com intensidade leve a moderada ‚Ä¢ Segure 1‚Äì2 segundos ‚Ä¢ Inspire relaxando devagar ‚Ä¢ Repita 8‚Äì10 vezes ‚Ä¢ Erros a evitar: For√ßa excessiva (tremor) ‚Ä¢ Empurrar a cabe√ßa para frente ‚Ä¢ Ombros elevados ‚Ä¢ Benef√≠cios: ativa peitoral, tr√≠ceps e estabilizadores dos ombros sem impacto.",equipamento:"B√≠ceps ou aro",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d10_5",nome:"Disco de equil√≠brio",instrucao:"Coloque o disco no ch√£o pr√≥ximo a uma parede, mesa ou cadeira firme. Suba no disco com um p√© de cada vez, mantendo joelhos levemente flexionados. Segure no apoio at√© sentir seguran√ßa. Quando estiver est√°vel, solte o apoio somente se se sentir confiante. Mantendo abd√¥men levemente ativado, tente permanecer est√°vel por 20‚Äì30 segundos. Des√ßa devagar segurando no apoio ‚Ä¢ Varia√ß√£o mais leve: Fique apenas com um p√© no disco e outro no ch√£o. Ou sente-se sobre o disco para ativar o core de forma mais suave ‚Ä¢ Benef√≠cios: melhora equil√≠brio, propriocep√ß√£o e estabilidade das articula√ß√µes.",equipamento:"Disco de Equil√≠brio",energia:"alta",contexto:"casa",categoria:"Equil√≠brio"},
        
        // Casa / baixa
        {id:"d10_6",nome:"Esteira 3-5 min (opcional)",instrucao:"Caminhe 3 minutos OU elimine a esteira.",equipamento:"Esteira",energia:"baixa",contexto:"casa",categoria:"cardio"},
        {id:"d10_7",nome:"Remada",instrucao:"Sente-se com pernas estendidas OU flexionadas (como for mais confort√°vel) ‚Ä¢ Passe a faixa nos p√©s e segure as pontas ‚Ä¢ Coluna ereta, ombros abaixados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, puxe os cotovelos para tr√°s, aproximando as esc√°pulas ‚Ä¢ Mantenha os cotovelos pr√≥ximos ao corpo ‚Ä¢Inspire retornando devagar ‚Ä¢ Repita 8‚Äì12 vezes ‚Ä¢ Erros a evitar: Ombros encolhidos ‚Ä¢ Tranco na faixa ‚Ä¢ Curvar as costas ‚Ä¢ Benef√≠cios: fortalece dorsais, melhora postura e reduz dor entre omoplatas.",equipamento:"Faixa",energia:"baixa",contexto:"casa",categoria:""},
        {id:"d10_8",nome:"Compress√£o de aro",instrucao:"Compress√£o de Aro",instrucao:"Sente-se com coluna ereta ‚Ä¢ Segure o aro com as m√£os na altura do peito ‚Ä¢ Cotovelos suavemente flexionados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, pressione o aro com intensidade leve a moderada ‚Ä¢ Segure 1‚Äì2 segundos ‚Ä¢ Inspire relaxando devagar ‚Ä¢ Repita 8‚Äì10 vezes ‚Ä¢ Erros a evitar: For√ßa excessiva (tremor) ‚Ä¢ Empurrar a cabe√ßa para frente ‚Ä¢ Ombros elevados ‚Ä¢ Benef√≠cios: ativa peitoral, tr√≠ceps e estabilizadores dos ombros sem impacto.",equipamento:"Aro",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
       
        // Casa dos pais
        {id:"d10_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d10_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d10_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d10_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d10_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
         {id:"d10_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"balta",contexto:"viagem",categoria:"respiracao"},
        {id:"d10_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
        
      ],
      11: [
        // Casa / alta
        {id:"d11_1",nome:"Alongamento da Coluna",instrucao:"Sente-se com pernas estendidas ‚Ä¢ Inspire crescendo a coluna ‚Ä¢ Ao expirar, flexione o tronco para frente desenrolando a coluna ‚Ä¢ Volte devagar inspirando ‚Ä¢ Repita 3‚Äì5 vezes ‚Ä¢ Objetivo: soltar coluna, lombar e cadeia posterior.",equipamento:"Sess√£o de alongamentos (4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d11_2",nome:"Alongamento Lateral",instrucao:"Sente-se com pernas dobradas para um lado ‚Ä¢ Eleve o bra√ßo oposto ‚Ä¢ Incline o tronco suavemente para o lado das pernas ‚Ä¢ Respire 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: aliviar tens√£o de tronco, cintura e regi√£o intercostal.",equipamento:"Sess√£o de alongamentos (4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d11_3",nome:"Alongamento Posterior com Faixa",instrucao:"Deite-se de barriga para cima ‚Ä¢ Passe a faixa no p√© direito ‚Ä¢ Estenda a perna para cima e puxe suavemente at√© sentir alongar ‚Ä¢ Segure 20‚Äì25 s ‚Ä¢ Repita com a outra perna ‚Ä¢ Objetivo: soltar posteriores e diminuir tens√£o lombar.",equipamento:"Sess√£o de alongamentos (4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d11_4",nome:"Gato‚ÄìVaca",instrucao:"Em quatro apoios ‚Ä¢ Inspire arqueando lombar (vaca) ‚Ä¢ Expire arredondando coluna (gato) ‚Ä¢ Repita 8‚Äì10 ciclos bem lentos ‚Ä¢ Objetivo: liberar coluna, aliviar tens√µes e melhorar mobilidade di√°ria.",equipamento:"Sess√£o de alongamentos (4 a 6)",energia:"alta",contexto:"casa",categoria:"mobilidade"},
        {id:"d11_4",nome:"Alongamento de Pesco√ßo",instrucao:"Incline a cabe√ßa para a direita, segurando 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Em seguida, traga o queixo ao peito por 15 s ‚Ä¢ Objetivo: aliviar dores cervicais e tens√£o acumulada.",equipamento:"Sess√£o de alongamentos (4 a 6)",equipamento:"Sess√£o de alongamentos (4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d11_4",nome:"Alongamento de Peitoral na Parede",instrucao:"Bra√ßo estendido na parede ‚Ä¢ Gire o tronco suavemente para longe ‚Ä¢ Segure 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: abrir peito, reduzir tens√£o cervical e dorsal.",equipamento:"Sess√£o de alongamentos (escolha 4 a 6)",equipamento:"Sess√£o de alongamentos (4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d11_4",nome:"Crian√ßa",instrucao:"Ajoelhe-se e sente-se sobre os calcanhares ‚Ä¢ Alongue os bra√ßos √† frente e deite o tronco entre as coxas ‚Ä¢ Respire profundamente 20‚Äì30 s ‚Ä¢ Alivia: lombar, quadris e parte superior das costas.",equipamento:"Sess√£o de alongamentos (4 a 6)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        
        // Casa / baixa
        {id:"d11_5",nome:"Respira√ß√£o",instrucao:"Inspire pelo nariz por 3‚Äì4 segundos ‚Ä¢ Expire pela boca por 5‚Äì6 segundos, relaxando ombros e mand√≠bula ‚Ä¢ Sinta as costelas expandirem em 3D (frente, lados e costas) ‚Ä¢ Repita lentamente, deixando o corpo ‚Äúdesarmar‚Äù.",equipamento:"",energia:"baixa",contexto:"casa",categoria:""},
        {id:"d11_6",nome:"Rota√ß√£o espinhal",instrucao:"Deite-se de barriga para cima ‚Ä¢ Flexione os joelhos e coloque a bola sob as panturrilhas ‚Ä¢ Gire lentamente os quadris e as pernas para um dos lados, levando os joelhos em dire√ß√£o ao ch√£o ‚Ä¢ A bola rolar√° sob as panturrilhas.",equipamento:"Bola",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        
       
        // Casa dos pais
        {id:"d11_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d11_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d11_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d11_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d11_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
         {id:"d11_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d11_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
        
      ],
      12: [
        // Casa / alta
        {id:"d12_1",nome:"Esteira 10‚Äì15 min",instrucao:"Ritmo confort√°vel, sem esfor√ßo respirat√≥rio ‚Ä¢ Coluna ereta, olhar √† frente ‚Ä¢ Esfor√ßo recomendado: 3‚Äì4/10 ‚Ä¢ Se cansar, reduza velocidade ‚úî Vers√£o leve: Caminhar 5 minutos OU  eliminar e fazer apenas alongamento final.",equipamento:"Esteira",energia:"alta",contexto:"casa",categoria:"cardio"},
        {id:"d12_2",nome:"Ponte",instrucao:"Deite-se de barriga para cima com joelhos dobrados ‚Ä¢ Ative o abd√¥men suavemente ‚Ä¢ Inspire ‚Ä¢ Ao expirar, eleve o quadril articulando a coluna ‚Ä¢ Segure 1‚Äì2 segundos no topo ‚Ä¢ Des√ßa devagar desenrolando v√©rtebra por v√©rtebra ‚Ä¢ Repita 8‚Äì12 vezes. ‚úî Varia√ß√£o para energia mais alta: Fa√ßa ponte com eleva√ß√£o de calcanhares ‚Ä¢ Ou mantenha a ponte por 5 segundos ativando gl√∫teos. ‚úî Para energia baixa: Fa√ßa uma ponte mais baixa ‚Ä¢ Aumente a √™nfase no alongamento, n√£o na for√ßa.  ‚Ä¢ Benef√≠cios: ativa gl√∫teos, solta lombar, melhora estabilidade p√©lvica.",equipamento:"Tapete",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d12_3",nome:"1. Abdu√ß√£o Deitada ",instrucao:"Mini band acima dos joelhos ‚Ä¢ Deite-se de lado ‚Ä¢ Pernas flexionadas ‚Ä¢ Inspire ‚Ä¢ Ao expirar, abra o joelho de cima, mantendo os p√©s juntos ‚Ä¢ Des√ßa devagar ‚Ä¢ Repita 8‚Äì12 vezes cada lado ‚Ä¢ Foco: gl√∫teo m√©dio (estabilizador da p√©lvis).",equipamento:"Mini band escolha 1 ou 2",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d12_4",nome:"2. Marcha ",instrucao:"Mini band nos tornozelos ‚Ä¢ Em p√©, joelhos levemente flexionados ‚Ä¢ Eleve um p√© 5‚Äì10 cm e retorne ‚Ä¢ Repita alternando as pernas (10‚Äì20 repeti√ß√µes) ‚Ä¢ Foco: equil√≠brio + ativa√ß√£o leve do core.",equipamento:"Mini band escolha 1 ou 2",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d12_5",nome:"3. Caminhada Lateral ",instrucao:"Mini band acima dos joelhos ou tornozelos  ‚Ä¢ Flex√£o suave de joelhos ‚Ä¢ D√™ passos laterais curtos e controlados ‚Ä¢ 6‚Äì8 passos para a direita, depois para a esquerda ‚Ä¢ ‚ö†Ô∏è Fa√ßa apenas se estiver com energia m√©dia/boa.",equipamento:"Mini band escolha 1 ou 2",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        
        // Casa / baixa
        {id:"d12_6",nome:"Esteira 3-5 min (opcional)",instrucao:"Caminhe 3 minutos OU elimine a esteira.",equipamento:"Esteira",energia:"baixa",contexto:"casa",categoria:"cardio"},
        {id:"d12_7",nome:"Respira√ß√£o",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"casa",categoria:"respira√ß√£o"},
         {id:"d12_8",nome:"Ponte Simples",instrucao:"Fa√ßa uma ponte mais baixa ‚Ä¢ Aumente a √™nfase no alongamento, n√£o na for√ßa.  ‚Ä¢ Benef√≠cios: ativa gl√∫teos, solta lombar, melhora estabilidade p√©lvica.",equipamento:"Tapete",energia:"baixa",contexto:"casa",categoria:""},
          {id:"d12_9",nome:"Alongamento posterior com faixa",instrucao:"Deite-se de barriga para cima ‚Ä¢ Passe a faixa no p√© direito ‚Ä¢ Estenda a perna para cima e puxe suavemente at√© sentir alongar ‚Ä¢ Segure 20‚Äì25 s ‚Ä¢ Repita com a outra perna ‚Ä¢ Objetivo: soltar posteriores e diminuir tens√£o lombar.",equipamento:"1 Alongamento Final (opcional)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
          {id:"d12_10",nome:"Alongamento Lateral",instrucao:"Sente-se com pernas dobradas para um lado ‚Ä¢ Eleve o bra√ßo oposto ‚Ä¢ Incline o tronco suavemente para o lado das pernas ‚Ä¢ Respire 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: aliviar tens√£o de tronco, cintura e regi√£o intercostal.",equipamento:"1 Alongamento Final (opcional)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
          {id:"d12_11",nome:"Tor√ß√£o Sentada",instrucao:"Sentada na cadeira, coluna ereta, p√©s bem apoiados no ch√£o ‚Ä¢ Mantenha o peso distribu√≠do igualmente nos dois lados do quadril. ‚Ä¢ Inspire crescendo a coluna (como se quisesse ‚Äúalongar‚Äù o topo da cabe√ßa para o teto) ‚Ä¢ Ao expirar, gire suavemente o tronco para a direita ‚Ä¢ Leve a m√£o esquerda em dire√ß√£o √† coxa direita ou √† lateral da cadeira ‚Ä¢ A m√£o direita pode apoiar no encosto ou na lateral da cadeira, sem ‚Äúpuxar‚Äù com for√ßa ‚Ä¢ Mantenha os ombros relaxados, longe das orelhas ‚Ä¢ Segure a posi√ß√£o por 3 a 5 respira√ß√µes suaves ‚Ä¢ Volte devagar ao centro ao inspirar ‚Ä¢ Repita para o outro lado ‚Ä¢ 1 a 2 repeti√ß√µes para cada lado ‚Ä¢ Sustentar 20 a 30 segundos (ou 3 a 5 respira√ß√µes) em cada lado, conforme toler√¢ncia ‚Ä¢ Objetivo: ‚Äúlubrificar‚Äù articula√ß√µes sem esfor√ßo.",equipamento:"1 Alongamento Final (opcional)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        
       
        // Casa dos pais
        {id:"d12_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d12_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d12_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d12_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d12_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        {id:"d12_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d12_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
        
        
      ],
      13: [
        // Casa / alta
        {id:"d13_1",nome:"Remada",instrucao:"Sente-se com pernas estendidas OU flexionadas (como for mais confort√°vel) ‚Ä¢ Passe a faixa nos p√©s e segure as pontas ‚Ä¢ Coluna ereta, ombros abaixados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, puxe os cotovelos para tr√°s, aproximando as esc√°pulas ‚Ä¢ Mantenha os cotovelos pr√≥ximos ao corpo ‚Ä¢ Inspire retornando devagar ‚Ä¢ Repita 8‚Äì12 vezes ‚Ä¢ Erros a evitar: Ombros encolhidos ‚Ä¢ Tranco na faixa ‚Ä¢ Curvar as costas ‚Ä¢  Benef√≠cios: fortalece dorsais, melhora postura e reduz dor entre omoplatas.",equipamento:"Faixa",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d13_2",nome:"Compress√£o de Aro",instrucao:"Sente-se com coluna ereta ‚Ä¢ Segure o aro com as m√£os na altura do peito ‚Ä¢ Cotovelos suavemente flexionados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, pressione o aro com intensidade leve a moderada ‚Ä¢ Segure 1‚Äì2 segundos ‚Ä¢ Inspire relaxando devagar ‚Ä¢ Repita 8‚Äì10 vezes ‚Ä¢ Erros a evitar: For√ßa excessiva (tremor) ‚Ä¢ Empurrar a cabe√ßa para frente ‚Ä¢ Ombros elevados ‚Ä¢ Benef√≠cios: ativa peitoral, tr√≠ceps e estabilizadores dos ombros sem impacto.",equipamento:"Aro",energia:"alta",contexto:"casa",categoria:"for√ßa"},
        {id:"d13_3",nome:"Equil√≠brio no disco",instrucao:"Coloque o disco no ch√£o pr√≥ximo a uma parede, mesa ou cadeira firme. Suba no disco com um p√© de cada vez, mantendo joelhos levemente flexionados. Segure no apoio at√© sentir seguran√ßa. Quando estiver est√°vel, solte o apoio somente se se sentir confiante. Mantendo abd√¥men levemente ativado, tente permanecer est√°vel por 20‚Äì30 segundos. Des√ßa devagar segurando no apoio ‚Ä¢ Varia√ß√£o mais leve: Fique apenas com um p√© no disco e outro no ch√£o. Ou sente-se sobre o disco para ativar o core de forma mais suave ‚Ä¢ Benef√≠cios: melhora equil√≠brio, propriocep√ß√£o e estabilidade das articula√ß√µes.",equipamento:"Disco",energia:"alta",contexto:"casa",categoria:"Equil√≠brio"},
       
        
        // Casa / baixa
        {id:"d13_7",nome:"Ramada",instrucao:"Sente-se com pernas estendidas OU flexionadas (como for mais confort√°vel) ‚Ä¢ Passe a faixa nos p√©s e segure as pontas ‚Ä¢ Coluna ereta, ombros abaixados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, puxe os cotovelos para tr√°s, aproximando as esc√°pulas ‚Ä¢ Mantenha os cotovelos pr√≥ximos ao corpo ‚Ä¢Inspire retornando devagar ‚Ä¢ Repita 8‚Äì12 vezes ‚Ä¢ Erros a evitar: Ombros encolhidos ‚Ä¢ Tranco na faixa ‚Ä¢ Curvar as costas ‚Ä¢ Benef√≠cios: fortalece dorsais, melhora postura e reduz dor entre omoplatas.",equipamento:"Alongamento (remada ou aro)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
         {id:"d13_8",nome:"Compress√£o de Aro",instrucao:"Sente-se com coluna ereta ‚Ä¢ Segure o aro com as m√£os na altura do peito ‚Ä¢ Cotovelos suavemente flexionados ‚Ä¢ Inspire ‚Ä¢ Ao expirar, pressione o aro com intensidade leve a moderada ‚Ä¢ Segure 1‚Äì2 segundos ‚Ä¢ Inspire relaxando devagar ‚Ä¢ Repita 8‚Äì10 vezes ‚Ä¢ Erros a evitar: For√ßa excessiva (tremor) ‚Ä¢ Empurrar a cabe√ßa para frente ‚Ä¢ Ombros elevados ‚Ä¢ Benef√≠cios: ativa peitoral, tr√≠ceps e estabilizadores dos ombros sem impacto.",equipamento:"Alongamento (remada ou aro)",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
         {id:"d13_5",nome:"Respira√ß√£o e mobilidade",instrucao:"Inspire profundamente expandindo as costelas ‚Ä¢ Expire devagar relaxando ombros ‚Ä¢ Fa√ßa c√≠rculos de ombros (10x) ‚Ä¢ Pesco√ßo: inclina√ß√µes leves e giros suaves ‚Ä¢ Tornozelos: c√≠rculos para ativar circula√ß√£o.",equipamento:"",energia:"baixa",contexto:"casa",categoria:"Respira√ß√£o"},
         {id:"d13_5",nome:"Equil√≠brio sentado no disco",instrucao:"Coloque o disco no ch√£o pr√≥ximo a uma parede, mesa ou cadeira firme. Suba no disco com um p√© de cada vez, mantendo joelhos levemente flexionados. Segure no apoio at√© sentir seguran√ßa. Quando estiver est√°vel, solte o apoio somente se se sentir confiante. Mantendo abd√¥men levemente ativado, tente permanecer est√°vel por 20‚Äì30 segundos. Des√ßa devagar segurando no apoio ‚Ä¢ Varia√ß√£o mais leve: Fique apenas com um p√© no disco e outro no ch√£o. Ou sente-se sobre o disco para ativar o core de forma mais suave ‚Ä¢ Benef√≠cios: melhora equil√≠brio, propriocep√ß√£o e estabilidade das articula√ß√µes.",equipamento:"Disco (opcional)",energia:"baixa",contexto:"casa",categoria:"Equil√≠brio"},
        
       
        // Casa dos pais
        {id:"d13_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d13_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d13_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d13_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d13_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        {id:"d13_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d13_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
       
      ],
      14: [
        // Casa / alta
        {id:"d14_1",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.‚úî Vers√£o leve: Caminhar 3‚Äì5 min OU N√£o caminhar e focar apenas nos alongamentos.",equipamento:"Sem equipamento",energia:"alta",contexto:"casa",categoria:"cardio"},
        {id:"d14_2",nome:"1. Alongamento de Pesco√ßo ",instrucao:"Incline a cabe√ßa para a direita, segurando 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Em seguida, traga o queixo ao peito por 15 s ‚Ä¢ Objetivo: aliviar dores cervicais e tens√£o acumulada.",equipamento:"Alongamento curto (1 ou 2 exerc√≠cios)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d14_3",nome:"2. Alongamento Lateral ",instrucao:"Sente-se com pernas dobradas para um lado ‚Ä¢ Eleve o bra√ßo oposto ‚Ä¢ Incline o tronco suavemente para o lado das pernas ‚Ä¢ Respire 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Objetivo: aliviar tens√£o de tronco, cintura e regi√£o intercostal.",equipamento:"Sess√£o de alongamentos (4 a 6)",equipamento:"Alongamento curto (1 ou 2 exerc√≠cios)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        {id:"d14_4",nome:"3. Alongamento da coluna ",instrucao:"Sente-se com pernas estendidas ‚Ä¢ Inspire crescendo a coluna ‚Ä¢ Ao expirar, flexione o tronco para frente desenrolando a coluna ‚Ä¢ Volte devagar inspirando ‚Ä¢ Repita 3‚Äì5 vezes ‚Ä¢ Objetivo: soltar coluna, lombar e cadeia posterior.",equipamento:"Sess√£o de alongamentos (4 a 6)",equipamento:"Alongamento curto (1 ou 2 exerc√≠cios)",energia:"alta",contexto:"casa",categoria:"Alongamento"},
        
        // Casa / baixa
        {id:"d14_5",nome:"Respira√ß√£o suave",instrucao:"Sente-se ou deite-se em posi√ß√£o confort√°vel ‚Ä¢ Inspire pelo nariz por 3‚Äì4 segundos‚Ä¢ Expire pela boca devagar por 4‚Äì6 segundos ‚Ä¢ Deixe ombros, mand√≠bula e pesco√ßo relaxarem‚Ä¢ Continue at√© perceber o corpo ‚Äúdesligando‚Äù ‚Ä¢ Benef√≠cios: regula o sistema nervoso, reduz dor e rigidez t√≠pica da fibromialgia.",equipamento:"Sem equipamento",energia:"baixa",contexto:"casa",categoria:"respira√ß√£o"},
        {id:"d14_6",nome:"1. Pernas elevadas ",instrucao:"Deite-se perto de uma parede e apoie as pernas verticalmente ‚Ä¢ Respire profundamente 1‚Äì2 min.",equipamento:"Relaxamento com ou sem bola",energia:"baixa",contexto:"casa",categoria:"recupera√ß√£o"},
        {id:"d14_7",nome:"2. Costas apoiadas na bola (opcional)",instrucao:"Deite-se sobre a bola com apoio nos p√©s ‚Ä¢ Deixe a cabe√ßa e bra√ßos relaxarem ‚Ä¢ Respire devagar.",equipamento:"Relaxamento com ou sem bola",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d14_8",nome:"1. Alongamento de Pesco√ßo",instrucao:"Incline a cabe√ßa para a direita, segurando 15‚Äì20 s ‚Ä¢ Troque o lado ‚Ä¢ Em seguida, traga o queixo ao peito por 15 s ‚Ä¢ Objetivo: aliviar dores cervicais e tens√£o acumulada.",equipamento:"1 Alongamento Final",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
        {id:"d14_9",nome:"3. Alongamento da coluna ",instrucao:"Sente-se com pernas estendidas ‚Ä¢ Inspire crescendo a coluna ‚Ä¢ Ao expirar, flexione o tronco para frente desenrolando a coluna ‚Ä¢ Volte devagar inspirando ‚Ä¢ Repita 3‚Äì5 vezes ‚Ä¢ Objetivo: soltar coluna, lombar e cadeia posterior.",equipamento:"Sess√£o de alongamentos (4 a 6)",equipamento:"1 Alongamento Final",energia:"baixa",contexto:"casa",categoria:"Alongamento"},
       
        // Casa dos pais
        {id:"d14_pais_caminhada",nome:"Caminhada leve 10‚Äì20 min",instrucao:"Ritmo confort√°vel, podendo conversar.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"cardio"},
        {id:"d14_pais_along_sem",nome:"Alongamento em p√©",instrucao:"Alongar pesco√ßo, ombros, pernas, sem equipamento.",equipamento:"Sem equipamento",energia:"alta",contexto:"pais",categoria:"mobilidade"},
        {id:"d14_pais_resp",nome:"Respira√ß√£o + alongamento sentado",instrucao:"Respira√ß√£o profunda e alongamentos leves sentado.",equipamento:"Sem equipamento",energia:"baixa",contexto:"pais",categoria:"respiracao"},
        
        // Viagem
        {id:"d14_viagem_resp",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"respiracao"},
        {id:"d14_viagem_along_cama",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"baixa",contexto:"viagem",categoria:"mobilidade"},
        {id:"d14_viagem_resp2",nome:"Respira√ß√£o na cama",instrucao:"Deitada, respira√ß√£o diafragm√°tica por 3‚Äì5 min.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"respiracao"},
        {id:"d14_viagem_along_cama2",nome:"Alongamento na cama",instrucao:"Esticar pernas e bra√ßos, movimentos suaves.",equipamento:"Sem equipamento",energia:"alta",contexto:"viagem",categoria:"mobilidade"},
        
      ]
        
    };

function normalizeExCategoria(cat) {
  if (!cat) return "outros";
  const c = cat.toString().toLowerCase();

  if (c.startsWith("for√ß") || c === "forca") return "forca";
  if (c.startsWith("mob")) return "mobilidade";
  if (c.startsWith("card")) return "cardio";
  if (c.startsWith("resp")) return "respiracao";
  if (c.startsWith("along")) return "alongamento";
  if (c.startsWith("equil")) return "equilibrio";
  if (c.startsWith("recup")) return "recuperacao";
  if (c.startsWith("estab")) return "estabilidade";

  return "outros";
}

function buildExerciseMetaIndex() {
  const meta = {};
  const src = state.exOptionsState || baseExOptions;

  Object.keys(src || {}).forEach((dayKey) => {
    const arr = src[dayKey] || [];
    arr.forEach((ex) => {
      if (!ex || !ex.id) return;
      if (!meta[ex.id]) {
        meta[ex.id] = {
          categoria: ex.categoria || "outros",
          energia: ex.energia || "alta",
        };
      }
    });
  });

  return meta;
}


    function ensureExOptionsState() {
  if (!state.exOptionsState) {
    state.exOptionsState = {};
    for (let d = 1; d <= 14; d++) {
      // usa o bloco espec√≠fico do dia, se existir;
      // se n√£o existir, cai para array vazio
      const base = baseExOptions[d] || [];
      state.exOptionsState[d] = JSON.parse(JSON.stringify(base));
    }
    persistState();
  }
  return state.exOptionsState;
}

    function getExDayList(day){
      const st=ensureExOptionsState();
      if(!st[day]) st[day]=[];
      return st[day];
    }
    function getExDayState(day){
      if(!state.exState[day]) state.exState[day]={};
      return state.exState[day];
    }
    function toggleExerciseDone(day,exId){
      const dState=getExDayState(day);
      dState[exId]=!dState[exId];
      persistState(); renderExercises(); renderExerciseStats();
    }

    function addExerciseToDay(day,contexto,energia,nome,instrucao,equipamento,categoria){
      const exList=getExDayList(day);
      const id="ex_custom_"+Date.now();
      exList.push({id,nome,instrucao,equipamento,energia,contexto,categoria});
      persistState(); renderExercises();
    }
    
    function editExercise(day, exId) {
  const exList = getExDayList(day);
  const ex = exList.find((e) => e.id === exId);
  if (!ex) return;

  currentExEdit = { day, exId };

  editExName.value = ex.nome || "";
  editExInstr.value = ex.instrucao || "";
  editExEquip.value = ex.equipamento || "";
  editExEnergia.value = ex.energia || "alta";
  editExContexto.value = ex.contexto || "casa";
  editExCategoria.value = ex.categoria || "outros";

  editExerciseModal.style.display = "flex";
}

// Bot√µes do modal de Exerc√≠cios
if (editExCancelBtn) {
  editExCancelBtn.addEventListener("click", () => {
    editExerciseModal.style.display = "none";
    currentExEdit = null;
  });
}

if (editExSaveBtn) {
  editExSaveBtn.addEventListener("click", () => {
    if (!currentExEdit) return;

    const { day, exId } = currentExEdit;
    const exList = getExDayList(day);
    const ex = exList.find((e) => e.id === exId);
    if (!ex) return;

    const novoNome = editExName.value.trim();
    if (!novoNome) {
      alert("Digite o nome do exerc√≠cio.");
      return;
    }

    ex.nome = novoNome;
    ex.instrucao = editExInstr.value.trim();
    ex.equipamento = (editExEquip.value.trim() || "Sem equipamento");
    ex.energia = editExEnergia.value || "alta";
    ex.contexto = editExContexto.value || "casa";
    ex.categoria = editExCategoria.value || "outros";

    persistState();
    editExerciseModal.style.display = "none";
    currentExEdit = null;
    renderExercises();
    renderExerciseStats();
  });
}

// Fecha modal de exerc√≠cios clicando fora
if (editExerciseModal) {
  editExerciseModal.addEventListener("click", (e) => {
    if (e.target === editExerciseModal) {
      editExerciseModal.style.display = "none";
      currentExEdit = null;
    }
  });
}




    
    function deleteExercise(day,exId){
      const exList=getExDayList(day);
      const idx=exList.findIndex(e=>e.id===exId); if(idx===-1) return;
      if(!confirm("Excluir este exerc√≠cio?")) return;
      exList.splice(idx,1);
      const dState=getExDayState(day);
      if(dState[exId]!=null) delete dState[exId];
      persistState(); renderExercises(); renderExerciseStats();
    }

    function renderExercises(){
      const day=getSelectedDay();
      const ctx=getDayContext(day);
      const energy=getDayEnergy(day);
      const weekday=getWeekdayLabel(day);
      badgeExDia.textContent=`${weekday} ‚Ä¢ Dia ${day}`;
      const ctxLabel=ctx==="casa"?"Casa":ctx==="pais"?"Casa dos pais":ctx==="viagem"?"Viagem":"Pausa";
      exContextLabel.textContent=`Contexto: ${ctxLabel} ‚Ä¢ Energia: ${energy==="alta"?"vers√£o completa":"vers√£o leve"}`;

      exerciseContent.innerHTML="";
      const exList=getExDayList(day);
      const dState=getExDayState(day);

      // filtrar por contexto+energia
      let filtered=exList.filter(e=>e.contexto===ctx && e.energia===energy);
      // se for pausa, √© tudo opcional
      if(ctx==="pausa" && filtered.length===0){
        exerciseContent.innerHTML='<div class="empty-message">Dia de pausa: nenhum exerc√≠cio obrigat√≥rio. Respira√ß√£o e alongamento contam como cuidado, n√£o como cobran√ßa. üíô</div>';
      }

      if(filtered.length){
        // agrupar por equipamento com ordem especial: Esteira, Sem equipamento, outros
        const grupos={};
        filtered.forEach(ex=>{
          const eq=ex.equipamento||"Sem equipamento";
          if(!grupos[eq]) grupos[eq]=[];
          grupos[eq].push(ex);
        });
        const ordemEquip=["Esteira","Sem equipamento"];
        const outros=Object.keys(grupos).filter(k=>!ordemEquip.includes(k)).sort();
        const ordem=[...ordemEquip,...outros.filter(k=>grupos[k])];

        ordem.forEach(eq=>{
          if(!grupos[eq]) return;
          const bloco=document.createElement("div");
          bloco.className="exercise-block";
          const title=document.createElement("div");
          title.className="exercise-title";
          title.innerHTML=`<span>üèãÔ∏è‚Äç‚ôÄÔ∏è</span><span>${eq}</span>`;
          bloco.appendChild(title);

          const list=document.createElement("ul");
          list.className="exercise-list";
          grupos[eq].forEach(ex=>{
            const li=document.createElement("li");
            li.className="exercise-item";
            const cb=document.createElement("input");
            cb.type="checkbox";
            cb.checked=!!dState[ex.id];
            cb.onchange=()=>toggleExerciseDone(day,ex.id);

            const label=document.createElement("label");
            label.textContent=ex.nome;

            const btns=document.createElement("div");
            btns.className="meal-option-buttons";

            const btnPlus=document.createElement("button");
            btnPlus.type="button";
            btnPlus.className="btn-icon";
            btnPlus.textContent="+";
            btnPlus.title="Ver instru√ß√µes";

            const btnEdit=document.createElement("button");
            btnEdit.type="button";
            btnEdit.className="btn-icon";
            btnEdit.textContent="‚úé";
            btnEdit.title="Editar";
            btnEdit.onclick=()=>editExercise(day,ex.id);

            const btnDel=document.createElement("button");
            btnDel.type="button";
            btnDel.className="btn-icon";
            btnDel.textContent="üóë";
            btnDel.title="Excluir";
            btnDel.onclick=()=>deleteExercise(day,ex.id);

            btns.appendChild(btnPlus);
            btns.appendChild(btnEdit);
            btns.appendChild(btnDel);

            const note=document.createElement("div");
            note.className="exercise-note";
            note.textContent=ex.instrucao||"";
            btnPlus.onclick=()=>{
              const vis=note.style.display==="block";
              note.style.display=vis?"none":"block";
              btnPlus.textContent=vis?"+":"‚àí";
            };

            li.appendChild(cb);
            li.appendChild(label);
            li.appendChild(btns);
            list.appendChild(li);
            list.appendChild(note);
          });
          bloco.appendChild(list);
          exerciseContent.appendChild(bloco);
        });
      }

      // √°rea adicionar exerc√≠cio
      const addArea=document.createElement("div");
      addArea.className="meal-add-area";
      const btnToggle=document.createElement("button");
      btnToggle.type="button";
      btnToggle.textContent="‚ûï Adicionar exerc√≠cio";
      const formDiv=document.createElement("div");
      formDiv.style.display="none";

      const lbl=document.createElement("label");
      lbl.textContent="Novo exerc√≠cio para o dia/contexto selecionados:";
      const inpNome=document.createElement("input");
      inpNome.type="text"; inpNome.placeholder="Nome do exerc√≠cio";
      const inpInstr=document.createElement("textarea");
      inpInstr.placeholder="Instru√ß√µes (opcional)";
      const inpEquip=document.createElement("input");
      inpEquip.type="text"; inpEquip.placeholder="Equipamento (ex.: Esteira, Bola...)";
      const selEner=document.createElement("select");
      ["alta","baixa"].forEach(v=>{
        const o=document.createElement("option");
        o.value=v; o.textContent=v==="alta"?"Energia alta (completa)":"Energia baixa (leve)";
        selEner.appendChild(o);
      });
      selEner.value=getDayEnergy(day);

      const selCtx=document.createElement("select");
      [
        {v:"casa",t:"Casa"},
        {v:"pais",t:"Casa dos pais"},
        {v:"viagem",t:"Viagem"},
        {v:"pausa",t:"Pausa"}
      ].forEach(c=>{
        const o=document.createElement("option");
        o.value=c.v; o.textContent=c.t;
        selCtx.appendChild(o);
      });
      selCtx.value=getDayContext(day);

      const inpCat=document.createElement("input");
      inpCat.type="text";
      inpCat.placeholder="Categoria (for√ßa, mobilidade, cardio, respira√ß√£o...)";

      const btnAdd=document.createElement("button");
      btnAdd.type="button";
      btnAdd.textContent="Salvar exerc√≠cio";

      btnToggle.onclick=()=>{
        const vis=formDiv.style.display==="block";
        formDiv.style.display=vis?"none":"block";
      };
      btnAdd.onclick=()=>{
        const nome=inpNome.value.trim();
        if(!nome){ alert("Digite o nome do exerc√≠cio."); return; }
        addExerciseToDay(day,selCtx.value,selEner.value,nome,inpInstr.value.trim(),inpEquip.value.trim()||"Sem equipamento",inpCat.value.trim()||"outros");
        inpNome.value=""; inpInstr.value=""; inpEquip.value=""; inpCat.value="";
      };

      formDiv.appendChild(lbl);
      formDiv.appendChild(inpNome);
      formDiv.appendChild(inpInstr);
      formDiv.appendChild(inpEquip);
      formDiv.appendChild(selEner);
      formDiv.appendChild(selCtx);
      formDiv.appendChild(inpCat);
      formDiv.appendChild(btnAdd);

      addArea.appendChild(btnToggle);
      addArea.appendChild(formDiv);
      exerciseContent.appendChild(addArea);

      renderExerciseStats();
    }

 function renderExerciseStats() {
  const exDoneAll = state.exState || {};
  const exMetaIndex = buildExerciseMetaIndex();
  const totalDias = 14;

  let diasComMov = 0;
  let maiorSequenciaSem = 0;
  let seqSem = 0;
  let versaoAlta = 0;
  let versaoBaixa = 0;
  let totalSessoes = 0;

  const categorias = {
    forca: 0,
    mobilidade: 0,
    cardio: 0,
    respiracao: 0,
    alongamento: 0,
    equilibrio: 0,
    recuperacao: 0,
    estabilidade: 0,
    outros: 0,
  };

  for (let d = 1; d <= 14; d++) {
    const dayEx = exDoneAll[d] || exDoneAll[String(d)];

    const exIdsFeitos = dayEx
      ? Object.keys(dayEx).filter((id) => !!dayEx[id])
      : [];

    if (exIdsFeitos.length === 0) {
      // dia sem movimento
      seqSem++;
      if (seqSem > maiorSequenciaSem) maiorSequenciaSem = seqSem;
      continue;
    }

    // dia com movimento
    diasComMov++;
    seqSem = 0;

    const energiaDia = state.energyMeta[d] || "alta";
    if (energiaDia === "alta") versaoAlta++;
    else if (energiaDia === "baixa") versaoBaixa++;

    exIdsFeitos.forEach((exId) => {
      totalSessoes++;
      const meta = exMetaIndex[exId] || {};
      const cat = normalizeExCategoria(meta.categoria);
      categorias[cat] = (categorias[cat] || 0) + 1;
    });
  }

  const percDiasMov = totalDias
    ? Math.round((diasComMov / totalDias) * 100)
    : 0;

  // Badge no cabe√ßalho da se√ß√£o
  if (diasComMov === 0) {
    badgeExResumo.textContent =
      "Ainda sem exerc√≠cios registrados no ciclo 14 dias";
  } else {
    badgeExResumo.textContent =
      `${diasComMov}/${totalDias} dias com movimento (${percDiasMov}%)`;
  }

  // Limpa √°rea de stats
  exerciseStats.innerHTML = "";

  // --- 1) Infos textuais principais ---
  const resumoTop = document.createElement("div");
  resumoTop.className = "stats-row";
  resumoTop.innerHTML = `
    <span class="stats-chip">Dias com movimento: ${diasComMov}/${totalDias} (${percDiasMov}%)</span>
    <span class="stats-chip">Maior sequ√™ncia sem exerc√≠cio: ${maiorSequenciaSem} dia(s)</span>
    <span class="stats-chip">Vers√£o completa (alta energia): ${versaoAlta} dia(s)</span>
    <span class="stats-chip">Vers√£o leve (baixa energia): ${versaoBaixa} dia(s)</span>
    <span class="stats-chip">Total de sess√µes (exerc√≠cios feitos): ${totalSessoes}</span>
  `;
  exerciseStats.appendChild(resumoTop);

  // --- 2) Barras por categoria ---
  const bars = document.createElement("div");
  bars.className = "bar-group";

  const ordemCategorias = [
    ["forca", "For√ßa"],
    ["mobilidade", "Mobilidade"],
    ["cardio", "Cardio"],
    ["respiracao", "Respira√ß√£o"],
    ["alongamento", "Alongamento"],
    ["equilibrio", "Equil√≠brio"],
    ["recuperacao", "Recupera√ß√£o"],
    ["estabilidade", "Estabilidade"],
    ["outros", "Outros"],
  ];

  ordemCategorias.forEach(([key, label]) => {
    const qtd = categorias[key] || 0;
    const perc = totalSessoes
      ? Math.round((qtd / totalSessoes) * 100)
      : 0;

    const block = document.createElement("div");
    block.innerHTML = `
      <div class="bar-label">${label}: ${perc}% (${qtd} sess√£o(√µes))</div>
      <div class="bar"><div class="bar-fill" style="width:${perc}%;"></div></div>
    `;
    bars.appendChild(block);
  });

  exerciseStats.appendChild(bars);

  // --- 3) Mensagem motivacional homog√™nea ---
  const mini = document.createElement("div");
  mini.className = "mini-text";
  mini.textContent =
    "Qualquer movimento conta. Use essas estat√≠sticas para celebrar o que voc√™ conseguiu, n√£o para se cobrar. üíô";
  exerciseStats.appendChild(mini);
}


    function downloadExerciseSummary(){
      const exState=state.exState||{};
      const exOptions=ensureExOptionsState();
      const lines=[];
      const now=new Date();
      lines.push("Resumo de exerc√≠cios ‚Äì ciclo 14 dias");
      lines.push(`Gerado em: ${now.toLocaleDateString("pt-BR")} ${now.toLocaleTimeString("pt-BR")}`);
      lines.push("");

      for(let d=1;d<=14;d++){
        const dState=exState[d]||{};
        const options=exOptions[d]||[];
        const doneIds=Object.keys(dState).filter(k=>dState[k]);
        if(doneIds.length===0){
          lines.push(`Dia ${d}: nenhum exerc√≠cio registrado.`);
        }else{
          lines.push(`Dia ${d}:`);
          doneIds.forEach(id=>{
            const ex=options.find(e=>e.id===id);
            const nome=ex?ex.nome:id;
            const ctx=ex?ex.contexto:"";
            const energia=ex?ex.energia:"";
            lines.push(`  - ${nome} [${ctx}, ${energia}]`);
          });
        }
      }
      const blob=new Blob([lines.join("\n")],{type:"text/plain;charset=utf-8"});
      const url=URL.createObjectURL(blob);
      const a=document.createElement("a");
      a.href=url; a.download="resumo_exercicios_14_dias.txt";
      document.body.appendChild(a); a.click();
      document.body.removeChild(a); URL.revokeObjectURL(url);
    }
    if(btnDownloadExResumo){
      btnDownloadExResumo.addEventListener("click",downloadExerciseSummary);
    }

    /* ================= CASA ================= */

    const domesticRoutine = {
      1:{
        indispensavel:[
          {id:"d1_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar."},
          {id:"d1_2",label:"üåø Regar",instrucao:"Maranta e Ant√∫rio (se secos)"},
          {id:"d1_3",label:"üßΩ Trocar esponja ‚Ä¢ perfex ‚Ä¢ bate-m√£o ‚Ä¢ pano de prato",instrucao:"Se for necess√°rio"},
          {id:"d1_4",label:"Repor ess√™ncia / aromatizador",instrucao:"Encher portinhos."},
          {id:"d1_5",label:"üß∫ Recolocar s√≥ o essencial nas superf√≠cies",instrucao:"Em mesas e bancadas."},
          {id:"d1_6",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"},
          {id:"d1_7",label:"‚òï Autocuidado",instrucao:"Descansar + beber √°gua + alongar 2 minutos + pausa."},
        ],
        desejavel:[
          {id:"d1_8",label:"üõí Mercado",instrucao:"Despensa ‚Äì itens de base"},
          {id:"d1_9",label:"üõã Trocar manta da sala",instrucao:"Se necess√°rio."},
          {id:"d1_10",label:"üßä Geladeira",instrucao:"Revisar 1 prateleira da geladeira (limpeza r√°pida)."},
          {id:"d1_11",label:"üìù Conferir freezer",instrucao:"O que entrou/saiu."},
          {id:"d1_12",label:"üç≤ PR√â-PREPARO ",instrucao:"ü•¨ Lavar e porcionar 1 tipo de verdura (ex.: r√∫cula ou alface) ‚Ä¢ ü•£ Separar 4‚Äì5 potinhos vazios para usar no pr√©-preparo do fim de semana."}
        ]
      },
      2:{
        indispensavel:[
          {id:"d2_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d2_2",label:"üóë Lixo",instrucao:"Tirar ‚Üí levar ‚Üí colocar saco novo."},
          {id:"d2_3",label:"ü™¥Plantas",instrucao:"Checar solo e regar s√≥ as secas."},
          {id:"d2_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d2_5",label:"üî• Fog√£o r√°pido",instrucao:"Limpeza r√°pida do tampo e da boca principal."},
          {id:"d2_6",label:"Lavanderia",instrucao:"Usar apenas se realmente precisar (reserva)."},
          {id:"d2_7",label:"üßπ Cesta 5 min na √°rea de servi√ßo",instrucao:"Guardar o que est√° fora do lugar, sem faxina completa."},
          {id:"d2_8",label:"üìù Organizar sacola de retorno",instrucao:"Lista curta do que est√° faltando em casa."},
          {id:"d2_9",label:"ü•ò PR√â-PREPARO",instrucao:"Conferir se tem os ingredientes principais ‚Ä¢ Anotar o que falta comprar."}
        ]
      },
      3:{
        indispensavel:[
          {id:"d3_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d3_2",label:"üóë Lixeira do banheiro",instrucao:"Tirar ‚Üí levar ‚Üí colocar saco novo."},
          {id:"d3_3",label:"üõÅ Espelho do banheiro." ,instrucao: "Pano r√°pido." },
          {id:"d3_5",label:"üëñ Tirar da corda (se houver)", instrucao:"Dobrar e guardar." },
          {id:"d3_6",label:"üßª Trocar pano bate-m√£o.", instrucao: ""},
          {id:"d3_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"},
        ],
        desejavel:[
          {id:"d3_6",label: "üëï Lavanderia", instrucao: "Len√ßol + toalha + panos de ch√£o" },
          {id:"d3_7",label:"‚ôªÔ∏è Recicl√°veis", instrucao: "separar/organizar para descarte." },
          {id:"d3_8",label:"üìù Triagem da inbox 10‚Äô", instrucao: "Descartar/arquivar/a√ß√£o r√°pida." },
          {id:"d3_9",label:"üõè Quarto & cosm√©ticos",
        instrucao: "1 gaveta OU separar 5 itens para doa√ß√£o/descarte."
      },

          {id:"d3_10",label:"üç≤ PR√â-PREPARO PESADO ‚Äì BLOCO 1",
        instrucao: "üçó Cozinhar frango e desfiar (2 por√ß√µes para congelar) ‚Ä¢ ü•© Refogar carne mo√≠da simples (3 por√ß√µes) ‚Ä¢ ü•í Congelar legumes: ab√≥bora + cenoura (em cubos, por√ß√µes). "}

                  ]
      },
      4:{
        indispensavel:[
          {id:"d4_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d4_2",label:"üóÉ Mesa de trabalho 5 min", instrucao: "organizar ‚Üí passar pano." },
          {id:"d4_3",label:"üëñ Tirar da corda (se houver).", instrucao: "Dobrar e guardar" }, 
          {id:"d4_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d4_5",label:"üëï Lavanderia", instrucao: "roupa do dia a dia" },
          {id:"d4_6",label: "üöΩ Banheiro manuten√ß√£o", instrucao: "pia + vaso r√°pidos" },
          {id:"d4_7",label:"PR√â-PREPARO PESADO", instrucao: "ü´õ Cozinhar lentilha (2 por√ß√µes) ‚Ä¢ Cozinhar gr√£o-de-bico (2 por√ß√µes) ‚Ä¢ ü•£ Separar potinhos e congelar prote√≠nas (frango, carne, lentilha/gr√£o-de-bico)."},      
       
        ]
      },
      5:{
        indispensavel:[
          {id:"d5_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d5_2",label:"üåø Regar e adubar", instrucao: "Maranta, ant√∫rio, jib√≥ia, dracena" },
          {id:"d5_3",label:"üßª Trocar pano bate-m√£o.", instrucao: ""},
          {id:"d5_4",label:"üõ∑ Mesa de jantar", instrucao: "multiuso ‚Üí pano" },
          {id:"d5_5",label:"ü§ñ Rodar 2 c√¥modos", instrucao: "Sala + Escrit√≥rio." },
          {id:"d5_6",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d5_7",label:"üëôLavanderia", instrucao: "Roupa √≠ntima" },
          {id:"d5_8",label:"ü§ñ Rodar 4 c√¥modos ou completo", instrucao: " Sala + Escrit√≥rio + Quarto principal + Banheiro da su√≠te ‚Ä¢ Completo: + passar pano no Banheiro da su√≠te." },
          {id:"d5_9",label:"üßπ √Årea de servi√ßo", instrucao: "Bancada A ‚Üí pano  ‚Ä¢ Completo: bancada B ‚Üí pano" },
          {id:"d5_10",label:"üëñ Tirar da corda (se houver)", instrucao: "dobrar/guardar" },
          {id:"d5_11",label:"ü•ò PR√â-PREPARO", instrucao: "ü•ò Cozinhar arroz para a semana ‚Ä¢ üç≥ Cozinhar frango e desfiar (2 por√ß√µes) ‚Ä¢ ü•ò Refogar carne mo√≠da simples (3 por√ß√µes) ‚Ä¢ üç≥ Congelar legumes: ab√≥bora + cenoura (se tiver) ‚Ä¢ üìù Registrar 1‚Äì2 itens no freezer/geladeira." }
        ]
      },
      6:{
        indispensavel:[
          {id:"d6_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d6_2",label:"üöΩ Pia + vaso r√°pido", instrucao: " desinfetante ‚Üí pano/escova ‚Üí descarga." },
          {id:"d6_3",label:"ü™¥ Plantas", instrucao: "checar solo ‚Üí regar secas" },
          {id:"d6_4",label:"ü§ñ 3 c√¥modos", instrucao: " Cozinha + √Årea de servi√ßo + Corredor ‚Ä¢ + Quarto de h√≥spede + Banheiro social (se usados na semana)‚Ä¢  Completo: + passar pano no Banheiro social (se usados na semana)." },
          {id:"d6_5",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d6_12",label: "üëñ Tirar da corda (se houver)", instrucao: "Dobrar e guardar." },
          {id:"d6_6",label:"üõÅ Espelho + bancada", instrucao: "Pano √∫mido ‚Üí seco." },
          {id:"d6_7",label:"üóëLixeira do banheiro", instrucao: "Tirar ‚Üí levar ‚Üí colocar saco novo." },
          {id:"d6_8",label:"üõí Hortifrut/feira", instrucao: "Compra r√°pida (lista curta)." },
          {id:"d6_10",label:"üßªüßº Repor papel e sabonete", instrucao: "" },
           {id:"d6_11",label:"üçâ Hortifrut/feira:", instrucao: "Lavar e porcionar." },
            {id:"d6_13",label:"üç≤ PR√â-PREPARO", instrucao: "ü´ß Higienizar saladas para 3‚Äì4 dias (r√∫cula/alface) ‚Ä¢ üçÖ Deixar tomate e cebola picados para 2‚Äì3 dias em potinhos ‚Ä¢ ü´õCozinhar lentilha (2 por√ß√µes) ‚Ä¢ Cozinhar gr√£o-de-bico (2 por√ß√µes) ‚Ä¢ üßäCongelar em por√ß√µes pequenas."}
        ]
      },
      7:{
        indispensavel:[
          {id:"d7_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d7_2",label:"üßª Trocar pano bate-m√£o ", instrucao: ""}, 
          {id:"d7_3",label:"üåø Checar", instrucao: "Maranta e Dracena." }, 
          {id:"d7_5",label:"üõã Sala", instrucao: "Alinhar manta e almofadas " }, 
          {id:"d7_6",label:"ü™ë Mesa/rack  5 min", instrucao: "Mover tudo p inbox ‚Üí pano ‚Üí voltar s√≥ o essencial" }, 
          {id:"d7_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d7_7",label: "üëñ Tirar da corda", instrucao: "Dobrar e guardar." }, 
          {id:"d7_8",label:"üëï Lavanderia", instrucao: "Roupa do dia a dia." }, 
          {id:"d7_9",label:"üß∫ Triagem inbox 10‚Äô ", instrucao: "Descartar/arquivar/a√ß√£o r√°pida." }, 
          {id:"d7_10",label: "üîå Organizar cabos/chargers", instrucao: ""}, 
          {id:"d7_11",label:"ü™ë Superf√≠cies do escrit√≥rio ", instrucao: "Organizar e guardar." }, ,
          {id:"d7_12",label:"ü•òPR√â-PREPARO", instrucao: "ü•òUsar o que j√° foi cozido  ‚Ä¢ ü•£ Montar 1‚Äì2 potinhos extras (prote√≠na + legume) para deixar a semana mais leve."}
        ]
      },
      8:{
        indispensavel:[
          {id:"d8_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d8_2",label:"üßΩ Trocar esponja + perfex.", instrucao: ""},
          {id:"d8_3",label:"üåµ Rega + adubo", instrucao: "Rosa do Deserto, Cacto, Suculentas, Sarcostemma (rega profunda e espa√ßada)"},
          {id:"d8_5",label:"üî• Bancada + fog√£o r√°pido.", instrucao: ""},
          {id:"d8_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d2_6",label:"‚ôªÔ∏è Recicl√°veis", instrucao: "Tetra Pak/PET/latas ‚Äî enxaguar/achatar." },
          {id:"d2_7",label: "üßº Limpar rob√¥", instrucao: "Reservat√≥rio, filtro*, escovas, sensores/contatos, rodas ‚Ä¢ *Se lavar o filtro, secar 24 h e s√≥ recolocar no dia seguinte."},
          {id:"d2_8",label:"üõí Mercado (despensa)", instrucao: "Guardar tudo" },
          {id:"d2_9",label:"üìù Registrar compras", instrucao: "Atualizar a lista da despensa." },
          {id:"d2_10",label:"üç≤ PR√â-PREPARO", instrucao: "ü•ì Assar picanha su√≠na (1 por√ß√£o ‚Äî usar s√≥ 1x/semana) ‚Ä¢ üßä Congelar em por√ß√µes individuais  ‚Ä¢ Se tiver energia: ü•í Aproveitar forno/tempo para preparar algum legume assado extra (abobrinha, br√≥colis) se estiver com energia ‚Ä¢ ü•¶ Congelar abobrinha e br√≥colis (se ainda n√£o tiver feito)." }
        ]
      },
      9:{
        indispensavel:[
          {id:"d9_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d9_2",label:"üßª Trocar pano bate-m√£o", instrucao: ""},
          {id:"d9_3",label:" üåø Plantas", instrucao: "Checar solo ‚Üí regar secas." },
          {id:"d9_5",label:"üóë Lixo", instrucao: "Tirar ‚Üí levar ‚Üí colocar saco novo." },
          {id:"d9_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d9_6",label:"üëóLavanderia", instrucao: "Reserva (s√≥ se precisar)" },
          {id:"d9_7",label:"üßπ Cesta 5min na √°rea de servi√ßo", instrucao: "Sem limpeza completa." },
          {id:"d9_8",label:"‚ôªÔ∏è Recicl√°veis ", instrucao: "Checar para levar ao ponto (se necess√°rio)." },
          {id:"d9_9",label: "üç≤ PR√â-PREPARO", instrucao: "S√≥ log√≠stica: üßê Definir quais 2 por√ß√µes do freezer ser√£o usadas no FDS."}
        
        ]
      },
      10:{
        indispensavel:[
          {id:"d10_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d10_2",label:"üõ∑ Mesa de jantar", instrucao: "Multiuso ‚Üí pano." }, 
          {id:"d10_3",label:"üßª Trocar pano bate-m√£o", instrucao: ""}, 
          {id:"d10_5",label: "üåøPlantas", instrucao: "Checar solo ‚Üí regar s√≥ as secas." }, 
          {id:"d10_6",label:"‚ùÑÔ∏è Freezer", instrucao: " Separar 2 por√ß√µes para o FDS." },
          {id:"d10_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d10_5",label:"üßï Lavanderia", instrucao: "Len√ßol + toalha + panos de ch√£o " }, 
          {id:"d10_5",label:"üç≤ PR√â-PREPARO PESADO ", instrucao: "ü•î Preparar pur√™ de batata-doce (por√ß√µes para congelar) ‚Ä¢ü•ï Congelar cenoura/abobrinha que eventualmente falte."},
                  ]
      },
      11:{
        indispensavel:[
          {id:"d11_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d11_2",label:"üßπ Cesta 5 min ", instrucao: " Bancada A ‚Üí pano  ‚Ä¢ Completo: bancada B ‚Üí pano" }, 
          {id:"d11_3",label:"‚ôªÔ∏è Recicl√°veis", instrucao: "PET + latas  ‚Üí  enxaguar/achatar." }, 
          {id:"d11_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d11_5",label:"üëï Lavanderia", instrucao: "Roupa do dia a dia." }, 
          {id:"d11_5",label:"üßä Geladeira", instrucao: "1 prateleira (pano √∫mido)."}, 
          {id:"d11_5",label:"üç≤ PR√â-PREPARO PESADO", instrucao: " ü•© Revisar prote√≠nas (frango/carne/lentilha/gr√£o-de-bico) ‚Üí completar por√ß√µes se algo estiver acabando ‚Ä¢ ü•£ Separar potinhos para a segunda semana."},
          
        ]
      },
      12:{
        indispensavel:[
          {id:"d12_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d12_2",label:"üåø Rega leve ", instrucao: "Maranta, ant√∫rio, jib√≥ia, dracena (se secos)." },
          {id:"d12_3",label:"üßª Trocar pano bate-m√£o", instrucao: ""},
          {id:"d12_5",label:"üõ∑ Mesa de jantar", instrucao: " Multiuso ‚Üí pano " },
          {id:"d12_6",label: "ü§ñ Rodar 2 c√¥modos leves ", instrucao: "Sala + Escrit√≥rio ‚Ä¢ Completo: + passar pano no Banheiro da su√≠te (se precisar)." },
          {id:"d12_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d12_7",label:"üëôLavanderia", instrucao: " Roupa √≠ntima (se tiver acumulado)" },
          {id:"d12_8",label:"üßπ √Årea de servi√ßo", instrucao: "Bancada A ‚Üí pano  ‚Ä¢ Completo: bancada B ‚Üí pano" },
          {id:"d12_9",label:"üëñ Tirar da corda (se houver)", instrucao: " Dobrar e guardar " },
          {id:"d12_10",label:"üìù Registrar 1‚Äì2 itens no freezer/geladeira",  instrucao: "O que entrou/saiu ‚Ä¢ Conferir se ainda h√° arroz, frango e carne prontos"},
          {id:"d12_12",label:"üßä Geladeira", instrucao: "Organizar 1 prateleira" },
          {id:"d12_11",label:"üç≤ PR√â-PREPARO", instrucao: "ü•î Preparar pur√™ de batata-doce (por√ß√µes) ‚Ä¢ ü•¶ Fazer 1 legume r√°pido para repor potinhos (couve ou br√≥colis)." }
          
        ]
      },
      13:{
        indispensavel:[
          {id:"d13_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d13_2",label:"üßª Trocar pano bate-m√£o", instrucao: ""},  
          {id:"d13_3",label:"üß∫ Catar roupas", instrucao: "Sujas ‚Üí cesto ‚Ä¢ Limpas ‚Üí guardar" }, 
           {id:"d13_5",label:"üíÑ  Cosm√©ticos 5 min", instrucao: "Descartar vazios ‚Üí limpar tampo ‚Üí agrupar (manh√£/noite/cabelo)." }, 
          {id:"d13_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d13_6",label:"üõí Mercado (hortifrut)", instrucao: ""}, 
          {id:"d13_7",label:"ü§ñ 2 c√¥modos ", instrucao: "Os mais pisados da semana, ex.: Sala + Corredor) " }, 
          {id:"d13_8",label:"üçâ Hortifrut/feira", instrucao: "Lavar/porcionar" },  
          {id:"d13_9",label:"üìù 1 gaveta do arm√°rio", instrucao: "Organizar OU separar 5 itens para doa√ß√£o." }, 
          {id:"d13_10",label: "üç≤  PR√â-PREPARO", instrucao: "ü´ß Higienizar saladas para os pr√≥ximos 3‚Äì4 dias ‚Ä¢ üçÖ Deixar tomate e cebola picados para 2‚Äì3 dias." }
        ]
      },
      14:{
        indispensavel:[
          {id:"d14_1",label:"üçΩ Tirar lou√ßa",instrucao:"Tirar e guardar"},
          {id:"d14_2",label:"üåø Regar Zamioculca", instrucao: "Regar ‚Ä¢ Adubar na 1¬∫ semana de cada m√™s." },
          {id:"d14_3",label:"üåµ Checar suculenta", instrucao: "Suculentas, cacto e rosa do deserto." },
          {id:"d14_5",label:"üßπ Regra da Cesta 5 min", instrucao: " Liberar mesa, pia e bancadas." },
          {id:"d14_6",label:"üõè Roupas de cama ‚Ä¢ toalha ‚Ä¢ pano de ch√£o: ", instrucao: " Separar para troca." },
          {id:"d14_7",label:"üßπ Confirmar material de limpeza ", instrucao: " Sprays desembala: multiuso, desinfetante, desengordurante." },
          {id:"d14_4",label:"üçΩ Lou√ßa na m√°quina",instrucao:"Lavar"}
        ],
        desejavel:[
          {id:"d14_8",label:"üóëLixo", instrucao: "Levar ‚Üí colocar saco novo." },
          {id:"d14_9",label:"üìù Nota de compras curta", instrucao: "P√≥s-faxina." },
          {id:"d14_10",label:"üç≤ PR√â-PREPARO",   instrucao: "üìù Conferir o que ainda tem de prote√≠nas/legumes prontos ‚Ä¢ üìù Anotar no bloco de notas o que funcionou bem e o que sobrou (para ajustar o pr√©-preparo da pr√≥xima quinzena)." }
         
        ]
      }
    };
    const parentsDomesticTasks={
      indispensavel:[
        {id:"pais_cama",label:"Forrar cama",instrucao:"Arrumar a cama que voc√™ usou."}
      ],
      desejavel:[
        {id:"pais_lixo",label:"Tirar lixo do quarto/banheiro",instrucao:"Recolher lixo que voc√™ usou."},
        {id:"pais_varrer",label:"Varrer quarto/banheiro",instrucao:"Passar vassoura r√°pida."}
      ]
    };

    function ensureDomesticCustom(day,ctx){
      if(!state.domesticCustom[day]) state.domesticCustom[day]={};
      if(!state.domesticCustom[day][ctx]) state.domesticCustom[day][ctx]={indispensavel:[],desejavel:[]};
      return state.domesticCustom[day][ctx];
    }
    function ensureObj(obj,key){ if(!obj[key]) obj[key]={}; return obj[key]; }
    // --- Editar / excluir tarefas dom√©sticas personalizadas ---
function isCustomDomesticTask(taskId){
  // Tarefas personalizadas sempre come√ßam com dom_custom_
  return taskId.startsWith("dom_custom_");
}

/* EDITAR QUALQUER TAREFA (fixa ou personalizada) */
function editDomesticTask(day, ctx, tipo, taskId) {
  const customCfg = ensureDomesticCustom(day, ctx);

  let lista = customCfg[tipo] || [];
  let task = lista.find(t => t.id === taskId);

    // Se √© tarefa fixa, promover para custom
  if (!task) {
    // üîπ NOVO: pegar a lista base certa dependendo do contexto
    let baseList = [];
    if (ctx === "pais") {
      // Tarefas da casa dos pais
      baseList = (parentsDomesticTasks[tipo] || []);
    } else {
      // Rotina normal de casa (dia 1, 2, etc.)
      const cfg = getDomesticDayConfig(day);
      baseList = cfg[tipo] || [];
    }

    const original = baseList.find(t => t.id === taskId);
    if (!original) return;

    task = {
      id: "dom_custom_" + ctx + "_" + Date.now(),
      label: original.label,
      instrucao: original.instrucao || ""
    };

    lista.push(task);

    // atualiza estados associados √† tarefa antiga
    const replaceStateKeys = ["domesticDone", "domesticIgnored", "domesticReagendado"];
    replaceStateKeys.forEach(key => {
      if (state[key][day] && state[key][day][taskId]) {
        delete state[key][day][taskId];
        state[key][day][task.id] = true;
      }
    });

    state.flexList = state.flexList.map(t => {
      if (t.id === taskId) return { ...t, id: task.id };
      return t;
    });
  }


  /* Abrir modal preenchido */
  currentEdit = { day, ctx, tipo, task };
  editTaskName.value = task.label;
  editTaskInstr.value = task.instrucao || "";
  editTaskTipo.value = tipo;

  editTaskModal.style.display = "flex";
}

editTaskCancelBtn.addEventListener("click", () => {
  editTaskModal.style.display = "none";
  currentEdit = null;
});

editTaskSaveBtn.addEventListener("click", () => {
  if (!currentEdit) return;

  const { day, ctx, tipo, task } = currentEdit;

  task.label = editTaskName.value.trim();
  task.instrucao = editTaskInstr.value.trim();

  const newTipo = editTaskTipo.value;

  // Se mudou de categoria, mover de lista
  if (newTipo !== tipo) {
    const customCfg = ensureDomesticCustom(day, ctx);
    customCfg[tipo] = customCfg[tipo].filter(t => t.id !== task.id);
    customCfg[newTipo].push(task);
  }

  persistState();
  editTaskModal.style.display = "none";
  currentEdit = null;
  renderCasa();
  renderCasaStats();
 
});


/* EXCLUIR TAREFA CUSTOMIZADA */
function deleteDomesticTask(day, ctx, tipo, taskId){
  const isCustom = isCustomDomesticTask(taskId);

  const msg = isCustom
    ? "Excluir esta tarefa personalizada?"
    : `Excluir esta tarefa fixa deste dia?\n(Ela n√£o aparecer√° mais no Dia ${day} deste ciclo.)`;

  if (!confirm(msg)) return;

  if (isCustom) {
    // Remove da lista personalizada
    const customCfg = ensureDomesticCustom(day, ctx);
    const lista = customCfg[tipo] || [];
    const idx = lista.findIndex(t => t.id === taskId);
    if (idx !== -1) {
      lista.splice(idx, 1);
    }
  } else {
    // Marca como "apagada" para este dia
    if (!state.domesticDeleted[day]) state.domesticDeleted[day] = {};
    state.domesticDeleted[day][taskId] = true;
  }

  // Limpa estados associados
  if (state.domesticDone[day]) delete state.domesticDone[day][taskId];
  if (state.domesticIgnored[day]) delete state.domesticIgnored[day][taskId];
  if (state.domesticReagendado[day]) delete state.domesticReagendado[day][taskId];

  state.flexList = state.flexList.filter(t => t.id !== taskId);
  state.flexHistory = (state.flexHistory || []).filter(t => t.id !== taskId);

  persistState();
  renderCasa();
  renderCasaStats();
}



    function getDomesticDayConfig(day){
      return domesticRoutine[day] || domesticRoutine[1] || {indispensavel:[],desejavel:[]};
    }
    function filterDomesticByContext(day,ctx,config){
      const baseInd=[...(config.indispensavel||[])];
      const baseDes=[...(config.desejavel||[])];
      const custom=state.domesticCustom[day] && state.domesticCustom[day][ctx] ?
        state.domesticCustom[day][ctx] : {indispensavel:[],desejavel:[]};

      if(ctx==="casa"){
        return {indispensavel:[...baseInd,...custom.indispensavel],desejavel:[...baseDes,...custom.desejavel]};
      }
      if(ctx==="pais"){
        return {
          indispensavel:[...(parentsDomesticTasks.indispensavel||[]),...(custom.indispensavel||[])],
          desejavel:[...(parentsDomesticTasks.desejavel||[]),...(custom.desejavel||[])]
        };
      }
      if(ctx==="viagem"||ctx==="pausa"){
        return {indispensavel:[...(custom.indispensavel||[])],desejavel:[...(custom.desejavel||[])]};
      }
      return {indispensavel:[...baseInd,...custom.indispensavel],desejavel:[...baseDes,...custom.desejavel]};
    }

    function toggleDomesticDone(day,taskId){
      const dayDone=ensureObj(state.domesticDone,day);
      dayDone[taskId]=!dayDone[taskId];
      // se estiver na flexList, remove
      state.flexList = state.flexList.filter(t=>t.id!==taskId);
      persistState(); renderCasa(); renderCasaStats();
    }
    function markDomesticIgnored(day,taskId){
      const dayIgn=ensureObj(state.domesticIgnored,day);
      dayIgn[taskId]=!dayIgn[taskId];
      persistState(); renderCasa(); renderCasaStats();
    }
    function sendDomesticToFlex(day,task){
      if(!state.flexList.some(t=>t.id===task.id)){
        state.flexList.push({id:task.id,label:task.label,instrucao:task.instrucao||""});
      }
      ensureObj(state.domesticReagendado,day)[task.id]=true;
      if(state.domesticDone[day]) delete state.domesticDone[day][task.id];
      if(state.domesticIgnored[day]) delete state.domesticIgnored[day][task.id];
      persistState(); renderCasa(); renderCasaStats();
    }
    function markFlexAsDoneToday(taskId){
      const day=getSelectedDay();
      const task=state.flexList.find(t=>t.id===taskId); if(!task) return;
      ensureObj(state.domesticDone,day)[taskId]=true;
      state.flexHistory.push({day,id:task.id,label:task.label,instrucao:task.instrucao||"",tipo:task.tipo||"desejavel"});
      state.flexList=state.flexList.filter(t=>t.id!==taskId);
      persistState(); renderCasa(); renderCasaStats();
    }

    function renderCasa(){
      const day = getSelectedDay();
const ctx = getDayContext(day);
const energy = getDayEnergy(day);
const weekday = getWeekdayLabel(day);
badgeCasaDia.textContent = `${weekday} ‚Ä¢ Dia ${day}`;
const ctxLabel =
  ctx === "casa" ? "Casa" :
  ctx === "pais" ? "Casa dos pais" :
  ctx === "viagem" ? "Viagem" :
  "Pausa";
casaContextLabel.textContent = ctxLabel;

domesticContent.innerHTML = "";

// üëá NOVO: trata o DIA DE PAUSA aqui e j√° sai da fun√ß√£o
if (ctx === "pausa") {
  domesticContent.innerHTML =
    '<div class="empty-message">Dia de pausa: o que voc√™ fizer √© b√¥nus. üíô</div>';
  renderFlexList();      // ainda mostra as tarefas reagendadas, se houver
  renderCasaStats();     // badge j√° mostra a mesma mensagem
  return;
}

const cfg = getDomesticDayConfig(day);
let filtered = filterDomesticByContext(day, ctx, cfg);


      if(ctx==="viagem"){
        domesticContent.innerHTML='<div class="empty-message">Em viagem, tarefas dom√©sticas n√£o entram na conta. Foque em descansar. üß≥</div>';
        renderFlexList(); renderCasaStats(); return;
      }

      function renderGrupo(lista,tituloEmoji,tituloTexto,tipo){
        const bloco=document.createElement("div");
        bloco.className="exercise-block";
        const title=document.createElement("div");
        title.className="exercise-title";
        title.innerHTML=`<span>${tituloEmoji}</span><span>${tituloTexto}</span>`;
        bloco.appendChild(title);

        const ul=document.createElement("ul");
        ul.className="tasks-list";
        lista.forEach(t => {
  // se a tarefa foi "apagada" para este dia, n√£o renderiza
  if (state.domesticDeleted[day] && state.domesticDeleted[day][t.id]) return;

  const li = document.createElement("li");
  li.className = "task-item";

          const done=!!(state.domesticDone[day] && state.domesticDone[day][t.id]);
          const ignored=!!(state.domesticIgnored[day] && state.domesticIgnored[day][t.id]);
          const inFlex=state.flexList.some(f=>f.id===t.id);

          const cb=document.createElement("input");
          cb.type="checkbox";
          cb.checked=done;
          cb.disabled=inFlex;
          cb.onchange=()=>toggleDomesticDone(day,t.id);

          const main=document.createElement("div");
          main.className="task-main";
          const label=document.createElement("div");
          label.className="task-label-main";
          label.textContent=t.label;
          if(ignored || inFlex) label.style.opacity="0.5";
          main.appendChild(label);

          const btns=document.createElement("div");
          btns.className="meal-option-buttons";

          if(t.instrucao && t.instrucao.trim().length){
            const btnPlus=document.createElement("button");
            btnPlus.type="button"; btnPlus.className="btn-icon";
            btnPlus.textContent="+"; btnPlus.title="Ver instru√ß√µes";

            const note=document.createElement("div");
            note.className="task-details";
            note.textContent=t.instrucao;
            note.style.display="none";
            main.appendChild(note);

            btnPlus.onclick=()=>{
              const vis=note.style.display==="block";
              note.style.display=vis?"none":"block";
              btnPlus.textContent=vis?"+":"‚àí";
            };
            btns.appendChild(btnPlus);
          }

          const btnIgnore=document.createElement("button");
          btnIgnore.type="button"; btnIgnore.className="btn-icon";
          btnIgnore.textContent="‚äò";
          btnIgnore.title="N√£o faz sentido hoje";
          btnIgnore.onclick=()=>markDomesticIgnored(day,t.id);
          btns.appendChild(btnIgnore);

          const btnReag=document.createElement("button");
          btnReag.type="button"; btnReag.className="btn-icon";
          btnReag.textContent="‚Ü∫";
          btnReag.title="Reagendar para Tarefas reagendadas";
          btnReag.onclick=()=>sendDomesticToFlex(day,t);
          btns.appendChild(btnReag);

 // üîΩ INSIRA AQUI OS NOVOS BOT√ïES
    const btnEdit = document.createElement("button");
btnEdit.className = "btn-icon";
btnEdit.textContent = "‚úé";
btnEdit.title = "Editar tarefa";
btnEdit.addEventListener("click", () => editDomesticTask(day, ctx, tipo, t.id));

btns.appendChild(btnEdit);


    const btnDel = document.createElement("button");
    btnDel.type = "button";
    btnDel.className = "btn-icon";
    btnDel.textContent = "üóë";
    btnDel.title = "Excluir tarefa (personalizada)";
    btnDel.onclick = () => deleteDomesticTask(day, ctx, tipo, t.id);
    btns.appendChild(btnDel);
    // üîº AT√â AQUI

          li.appendChild(cb);
          li.appendChild(main);
          li.appendChild(btns);
          ul.appendChild(li);
        });
        bloco.appendChild(ul);
        domesticContent.appendChild(bloco);
      }

      renderGrupo(filtered.indispensavel,"üü¢","Indispens√°vel","indispensavel");
      renderGrupo(filtered.desejavel,"üü°","Desej√°vel","desejavel");

      // adicionar tarefa
      const addArea=document.createElement("div");
      addArea.className="meal-add-area";
      const btnToggle=document.createElement("button");
      btnToggle.type="button";
      btnToggle.textContent="‚ûï Adicionar tarefa";
      const formDiv=document.createElement("div");
      formDiv.style.display="none";

      const lbl=document.createElement("label");
      lbl.textContent="Nova tarefa para este dia/contexto:";
      const inpNome=document.createElement("input");
      inpNome.type="text"; inpNome.placeholder="Nome da tarefa";
      const taInstr=document.createElement("textarea");
      taInstr.placeholder="Instru√ß√µes/detalhes (opcional)";
      const selTipo=document.createElement("select");
      const o1=document.createElement("option");
      o1.value="indispensavel"; o1.textContent="Indispens√°vel";
      const o2=document.createElement("option");
      o2.value="desejavel"; o2.textContent="Desej√°vel";
      selTipo.appendChild(o1); selTipo.appendChild(o2);
      selTipo.value="desejavel";

      const btnAdd=document.createElement("button");
      btnAdd.type="button"; btnAdd.textContent="Salvar tarefa";

      btnToggle.onclick=()=>{
        const vis=formDiv.style.display==="block";
        formDiv.style.display=vis?"none":"block";
      };
      btnAdd.onclick=()=>{
        const nome=inpNome.value.trim();
        if(!nome){ alert("Digite o nome da tarefa."); return; }
        const cfgCustom=ensureDomesticCustom(day,ctx);
        const id="dom_custom_"+ctx+"_"+Date.now();
        const nova={id,label:nome,instrucao:taInstr.value.trim()||""};
        const tipo=selTipo.value==="indispensavel"?"indispensavel":"desejavel";
        cfgCustom[tipo].push(nova);
        inpNome.value=""; taInstr.value=""; selTipo.value="desejavel";
        persistState(); renderCasa(); renderCasaStats();
      };

      formDiv.appendChild(lbl);
      formDiv.appendChild(inpNome);
      formDiv.appendChild(taInstr);
      formDiv.appendChild(selTipo);
      formDiv.appendChild(btnAdd);
      addArea.appendChild(btnToggle);
      addArea.appendChild(formDiv);
      domesticContent.appendChild(addArea);

      renderFlexList();
      renderCasaStats();
    }

    function renderFlexList(){
      flexContent.innerHTML="";
      const qtd=state.flexList.length;
      badgeFlexCount.textContent=`${qtd} tarefa(s)`;

      if(!qtd){
        const mini=document.createElement("div");
        mini.className="mini-text";
        mini.textContent="Nenhuma tarefa reagendada ainda. Use ‚Ü∫ para enviar atividades para c√° quando quiser fazer em outro dia.";
        flexContent.appendChild(mini);
        return;
      }

      const ul=document.createElement("ul");
      ul.className="tasks-list";
      state.flexList.forEach(t=>{
        const li=document.createElement("li");
        li.className="task-item";
        const cb=document.createElement("input");
        cb.type="checkbox";
        cb.onchange=()=>{ if(cb.checked) markFlexAsDoneToday(t.id); };
        const main=document.createElement("div");
        main.className="task-main";
        const lbl=document.createElement("div");
        lbl.className="task-label-main";
        lbl.textContent=t.label;
        main.appendChild(lbl);
        if(t.instrucao && t.instrucao.trim().length){
          const note=document.createElement("div");
          note.className="task-details";
          note.textContent=t.instrucao;
          note.style.display="block";
          main.appendChild(note);
        }
        li.appendChild(cb);
        li.appendChild(main);
        ul.appendChild(li);
      });
      flexContent.appendChild(ul);
    }

    function renderCasaStats() {
  const metaIndex = buildDomesticMetaIndex();
  const done = state.domesticDone || {};
  const totalDias = 14;

  let totalTarefas = 0;
  let totalConcluidas = 0;
  let totalIndisp = 0;
  let conclIndisp = 0;
  let totalDesej = 0;
  let conclDesej = 0;

  for (let d = 1; d <= totalDias; d++) {
    const ids = getDomesticTaskIdsForDay(d);

    ids.forEach((id) => {
      const meta = metaIndex[id] || {};
      const tipo = meta.tipo === "desejavel" ? "desejavel" : "indispensavel";

      totalTarefas++;

      const diaDone = done[d] && done[d][id];

      if (tipo === "indispensavel") {
        totalIndisp++;
        if (diaDone) conclIndisp++;
      } else {
        totalDesej++;
        if (diaDone) conclDesej++;
      }

      if (diaDone) totalConcluidas++;
    });
  }

  const percTotal = totalTarefas
    ? Math.round((totalConcluidas / totalTarefas) * 100)
    : 0;
  const percIndisp = totalIndisp
    ? Math.round((conclIndisp / totalIndisp) * 100)
    : 0;
  const percDesej = totalDesej
    ? Math.round((conclDesej / totalDesej) * 100)
    : 0;

  statsContent.innerHTML = "";

  // Atualiza badge da se√ß√£o
  if (totalTarefas === 0) {
    badgeCasaResumo.textContent =
      "Base: ciclo 14 dias ‚Ä¢ nenhuma tarefa registrada ainda";
  } else {
    badgeCasaResumo.textContent =
      `Base: ciclo 14 dias ‚Ä¢ ${percTotal}% das tarefas conclu√≠das`;
  }

  // --- 1) Infos textuais principais ---
  const resumo = document.createElement("div");
  resumo.className = "stats-row";
  resumo.innerHTML = `
    <span class="stats-chip">Atividades conclu√≠das: ${totalConcluidas}/${totalTarefas} (${percTotal}%)</span>
    <span class="stats-chip">Indispens√°veis conclu√≠das: ${conclIndisp}/${totalIndisp || 0} (${percIndisp}%)</span>
    <span class="stats-chip">Desej√°veis conclu√≠das: ${conclDesej}/${totalDesej || 0} (${percDesej}%)</span>
  `;
  statsContent.appendChild(resumo);

  // --- 2) Barras horizontais homog√™neas ---
  const bars = document.createElement("div");
  bars.className = "bar-group";
  bars.innerHTML = `
    <div>
      <div class="bar-label">Total de atividades conclu√≠das: ${percTotal}%</div>
      <div class="bar"><div class="bar-fill" style="width:${percTotal}%;"></div></div>
    </div>
    <div>
      <div class="bar-label">Indispens√°veis conclu√≠das: ${percIndisp}%</div>
      <div class="bar"><div class="bar-fill" style="width:${percIndisp}%;"></div></div>
    </div>
    <div>
      <div class="bar-label">Desej√°veis conclu√≠das: ${percDesej}%</div>
      <div class="bar"><div class="bar-fill" style="width:${percDesej}%;"></div></div>
    </div>
  `;
  statsContent.appendChild(bars);

  // --- 3) Mensagem motivacional homog√™nea ---
  const mini = document.createElement("div");
  mini.className = "mini-text";
  mini.textContent =
    "Casa organizada tamb√©m √© autocuidado. Use esses n√∫meros como b√∫ssola, n√£o como chicote. üíô";
  statsContent.appendChild(mini);

  // --- 4) Bot√£o para baixar resumo da Casa ---
  const btn = document.createElement("button");
  btn.type = "button";
  btn.className = "btn-small";
  btn.style.marginTop = "0.5rem";
  btn.textContent = "‚¨áÔ∏è Baixar resumo da Casa (14 dias)";
  btn.onclick = downloadCasaResumo;
  statsContent.appendChild(btn);
}

    function downloadCasaResumo() {
  const metaIndex = buildDomesticMetaIndex();
  const done = state.domesticDone || {};
  const totalDias = 14;

  let totalTarefas = 0;
  let totalConcluidas = 0;
  let totalIndisp = 0;
  let conclIndisp = 0;
  let totalDesej = 0;
  let conclDesej = 0;

  for (let d = 1; d <= totalDias; d++) {
    const ids = getDomesticTaskIdsForDay(d);

    ids.forEach((id) => {
      const meta = metaIndex[id] || {};
      const tipo = meta.tipo === "desejavel" ? "desejavel" : "indispensavel";

      totalTarefas++;

      const diaDone = done[d] && done[d][id];

      if (tipo === "indispensavel") {
        totalIndisp++;
        if (diaDone) conclIndisp++;
      } else {
        totalDesej++;
        if (diaDone) conclDesej++;
      }

      if (diaDone) totalConcluidas++;
    });
  }

  const percTotal = totalTarefas
    ? Math.round((totalConcluidas / totalTarefas) * 100)
    : 0;
  const percIndisp = totalIndisp
    ? Math.round((conclIndisp / totalIndisp) * 100)
    : 0;
  const percDesej = totalDesej
    ? Math.round((conclDesej / totalDesej) * 100)
    : 0;

  const linhas = [];
  const now = new Date();
  linhas.push("Resumo da Casa ‚Äì ciclo 14 dias");
  linhas.push(
    `Gerado em: ${now.toLocaleDateString("pt-BR")} ${now.toLocaleTimeString(
      "pt-BR"
    )}`
  );
  linhas.push("");
  linhas.push(
    `Atividades conclu√≠das: ${totalConcluidas}/${totalTarefas} (${percTotal}%)`
  );
  linhas.push(
    `Indispens√°veis conclu√≠das: ${conclIndisp}/${totalIndisp} (${percIndisp}%)`
  );
  linhas.push(
    `Desej√°veis conclu√≠das: ${conclDesej}/${totalDesej} (${percDesej}%)`
  );

  const blob = new Blob([linhas.join("\n")], {
    type: "text/plain;charset=utf-8",
  });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "resumo_casa_14_dias.txt";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

    
    function buildDomesticMetaIndex() {
  const meta = {};

  function addFromArray(arr) {
    (arr || []).forEach((t) => {
      if (!t || !t.id) return;
      if (!meta[t.id]) {
        meta[t.id] = {
          tipo: t.tipo || "indispensavel",
        };
      }
    });
  }

  // base fixa da rotina
  if (typeof domesticRoutine !== "undefined" && domesticRoutine) {
    Object.keys(domesticRoutine).forEach((dayKey) => {
      const dia = domesticRoutine[dayKey];
      if (!dia) return;

      if (Array.isArray(dia)) {
        addFromArray(dia);
      } else if (typeof dia === "object") {
        Object.values(dia).forEach((sec) => {
          if (Array.isArray(sec)) addFromArray(sec);
          else if (sec && typeof sec === "object") {
            Object.values(sec).forEach((inner) => {
              if (Array.isArray(inner)) addFromArray(inner);
            });
          }
        });
      }
    });
  }

  // personalizadas
  Object.keys(state.domesticCustom || {}).forEach((dayKey) => {
    const arr = state.domesticCustom[dayKey];
    if (Array.isArray(arr)) addFromArray(arr);
  });

  return meta;
}

function getDomesticTaskIdsForDay(day) {
  const result = new Set();

  function addFromArray(arr) {
    (arr || []).forEach((t) => {
      if (t && t.id) result.add(t.id);
    });
  }

  // base fixa da rotina
  if (typeof domesticRoutine !== "undefined" && domesticRoutine) {
    const dia = domesticRoutine[day];
    if (dia) {
      if (Array.isArray(dia)) {
        addFromArray(dia);
      } else if (typeof dia === "object") {
        Object.values(dia).forEach((sec) => {
          if (Array.isArray(sec)) addFromArray(sec);
          else if (sec && typeof sec === "object") {
            Object.values(sec).forEach((inner) => {
              if (Array.isArray(inner)) addFromArray(inner);
            });
          }
        });
      }
    }
  }

  // tarefas personalizadas do dia
  const customDay = state.domesticCustom && state.domesticCustom[day];
  if (Array.isArray(customDay)) addFromArray(customDay);

  // remover tarefas apagadas no dia
  const delDay = state.domesticDeleted && state.domesticDeleted[day];
  if (delDay && typeof delDay === "object") {
    Object.keys(delDay).forEach((id) => {
      if (delDay[id]) result.delete(id);
    });
  }

  return Array.from(result);
}

    
    function renderCycleHistory() {
  if (!cycleHistoryContent) return;

  const history = state.cycleHistory || [];
  cycleHistoryContent.innerHTML = "";

  if (!history.length) {
    const msg = document.createElement("div");
    msg.className = "mini-text";
    msg.textContent =
      "Nenhum ciclo arquivado ainda. Quando voc√™ usar ‚ÄúReiniciar ciclo‚Äù, o resumo daquele ciclo aparece aqui. üòä";
    cycleHistoryContent.appendChild(msg);
    return;
  }

  // t√≠tulo interno
  const title = document.createElement("div");
  title.className = "section-title";
  title.innerHTML = `<span class="icon">üìà</span><span>Evolu√ß√£o entre ciclos</span>`;
  cycleHistoryContent.appendChild(title);

  // encontrar melhor escala para as barras (sempre 0‚Äì100)
  history.forEach((snap, idx) => {
    const cicloIdx = idx + 1;
    const foodStats = computeCycleFoodStats(snap.foodState || {});
    const exStats = computeCycleExerciseStats(snap.exDone || {});
    const data = new Date(snap.timestamp || Date.now());
    const dataLabel = data.toLocaleDateString("pt-BR");

    const bloco = document.createElement("div");
    bloco.className = "bar-group";
    bloco.style.marginTop = "0.4rem";

    const header = document.createElement("div");
    header.className = "flex-between";
    header.style.fontSize = "0.8rem";
    header.innerHTML = `<strong>Ciclo ${cicloIdx}</strong><span>${dataLabel}</span>`;
    bloco.appendChild(header);

    const foodLine = document.createElement("div");
    foodLine.innerHTML = `
      <div class="bar-label">Alimenta√ß√£o ‚Äì refei√ß√µes dentro do combinado (${foodStats.percDentro}%)</div>
      <div class="bar"><div class="bar-fill" style="width:${foodStats.percDentro}%;"></div></div>
    `;
    bloco.appendChild(foodLine);

    const exLine = document.createElement("div");
    exLine.style.marginTop = "0.2rem";
    exLine.innerHTML = `
      <div class="bar-label">Movimento ‚Äì dias com exerc√≠cio (${exStats.percDiasMov}% dos dias)</div>
      <div class="bar"><div class="bar-fill" style="width:${exStats.percDiasMov}%;"></div></div>
    `;
    bloco.appendChild(exLine);

    cycleHistoryContent.appendChild(bloco);
  });

  const mini = document.createElement("div");
  mini.className = "mini-text";
  mini.style.marginTop = "0.5rem";
  mini.textContent =
    "Use esse hist√≥rico para perceber tend√™ncias: ciclos com mais movimento, mais dias dentro do combinado na alimenta√ß√£o, e ajustes que est√£o funcionando para voc√™ ao longo do tempo. üíô";
  cycleHistoryContent.appendChild(mini);
}


    /* ========== INICIALIZA√á√ÉO ========== */
    loadState();
    // garantir sele√ß√£o inicial
    if(!daySelect.value) daySelect.value="1";

    // sincronizar chips com estado salvo
    (function syncChips(){
      const day=getSelectedDay();
      const e=getDayEnergy(day);
      const c=getDayContext(day);
      energyChips.querySelectorAll(".chip").forEach(ch=>ch.classList.toggle("active",ch.getAttribute("data-energy")===e));
      contextChips.querySelectorAll(".chip").forEach(ch=>ch.classList.toggle("active",ch.getAttribute("data-context")===c));
    })();

   function renderAll() {
  renderFood();
  renderExercises();
  renderCasa();
  renderCycleHistory();
}
    renderAll();
    function downloadCycleHistory() {
  const history = state.cycleHistory || [];
  if (!history.length) {
    alert("Ainda n√£o h√° ciclos arquivados. Use o bot√£o ‚ÄúReiniciar ciclo‚Äù para registrar o primeiro ciclo.");
    return;
  }

  const lines = [];
  const now = new Date();
  lines.push("Hist√≥rico de ciclos ‚Äì Rotina 14 Dias (Fibro)");
  lines.push(`Gerado em: ${now.toLocaleDateString("pt-BR")} ${now.toLocaleTimeString("pt-BR")}`);
  lines.push("");

  history.forEach((snap, idx) => {
    const cicloIdx = idx + 1;
    const data = new Date(snap.timestamp || Date.now());
    const dataLabel = data.toLocaleDateString("pt-BR");
    const foodStats = computeCycleFoodStats(snap.foodState || {});
    const exStats = computeCycleExerciseStats(snap.exDone || {});

    lines.push(`Ciclo ${cicloIdx} ‚Äì arquivado em ${dataLabel}`);
    lines.push(`  Alimenta√ß√£o: ${foodStats.percDentro}% de refei√ß√µes dentro do combinado`);
    lines.push(`  Refei√ß√µes puladas: ${foodStats.percPulado}%`);
    lines.push(`  Refei√ß√µes fora do combinado: ${foodStats.percNao}%`);
    lines.push(`  Movimento: ${exStats.diasComMov}/${exStats.totalDias} dias com exerc√≠cio (${exStats.percDiasMov}%)`);
    lines.push("");
  });

  const content = lines.join("\n");
  const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "historico_ciclos_rotina_14_dias.txt";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
if (btnDownloadCycleHistory) {
  btnDownloadCycleHistory.addEventListener("click", downloadCycleHistory);
}

   if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("sw.js")
          .catch((err) => {
            console.warn("Falha ao registrar service worker:", err);
          });
      });
    }
  </script>
</body>
</html>
